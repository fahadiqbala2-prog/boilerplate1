/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as g}from"@dropins/tools/preact-jsx-runtime.js";import{useState as d,useEffect as q,useCallback as k}from"@dropins/tools/preact-compat.js";import{Slot as j}from"@dropins/tools/lib.js";import{events as h}from"@dropins/tools/event-bus.js";import"@dropins/tools/components.js";/* empty css             */import{S as z}from"../chunks/Swatches.js";import"@dropins/tools/preact.js";import{c as C,l as A,h as G,j as v,p as H}from"../chunks/isProductConfigurationValid.js";import{g as y,s as b}from"../chunks/getProductConfigurationValues.js";import{g as J}from"../chunks/getFetchedProductData.js";import"@dropins/tools/i18n.js";import"../fragments.js";import"@dropins/tools/fetch-graphql.js";const K=({initialData:c={data:null,optionsUIDs:[]},hideSelectedValue:m=!1,slots:i,onValues:p,onErrors:f,children:Q,...O})=>{var S;const[t,B]=d(c.data),[u,T]=d(c.optionsUIDs),[F,M]=d();q(()=>{const o=h.on("pdp/data",B),s=h.on("pdp/values",({optionsUIDs:a})=>{a&&T(a)});return()=>{o==null||o.off(),s==null||s.off()}},[]);const L=k(async o=>{var I,P,U,w;if(!(t!=null&&t.sku))return;const{persistURLParams:s,anchors:a,acdl:R}=C.getConfig()??{};let n=Object.keys(o).map(e=>o[e].value).filter(e=>e!==void 0);if(s&&!(t!=null&&t.isBundle)&&A({optionsUIDs:n.join(",")}),((P=(I=y())==null?void 0:I.optionsUIDs)==null?void 0:P.join("|"))!==(n==null?void 0:n.join("|"))){b(r=>({...r,optionsUIDs:n})),p==null||p(n);const e=await G(t.sku,{optionsUIDs:n??[],isBundle:t==null?void 0:t.isBundle,anchors:a});h.emit("pdp/data",e);let D=(n==null?void 0:n.length)===((U=e==null?void 0:e.options)==null?void 0:U.length);if(a!=null&&a.length){const r=(e==null?void 0:e.optionUIDs)??[];n.every(l=>r.includes(l))||(M(e==null?void 0:e.options),b(l=>({...l,optionsUIDs:r})),D=(r==null?void 0:r.length)===((w=e==null?void 0:e.options)==null?void 0:w.length))}v(()=>D),R&&e&&(e==null?void 0:e.variantSku)!==t.sku&&H(e)}},[t==null?void 0:t.isBundle,t==null?void 0:t.sku,p]),N=k(o=>{Object.keys(o).length!==0&&(v(()=>!1),f==null||f(o))},[f]);return!t||!t.options?null:g(j,{name:"Swatches",slot:i==null?void 0:i.Swatches,context:{data:t,optionsUIDs:u},children:g(z,{...O,options:t.options,selectedUIDs:u,defaultOptions:u,selectionsToUpdate:F,hideSelectedValue:m,disablePreselections:!((S=C.getConfig())!=null&&S.preselectFirstOption),onValues:L,onErrors:N,imageSwatchNode:i!=null&&i.SwatchImage?({imageSwatchContext:o,...s})=>g(j,{name:"SwatchImage",slot:i==null?void 0:i.SwatchImage,slotTag:"span",context:{data:t,optionsUIDs:u,defaultImageProps:s,imageSwatchContext:o}}):void 0})})};K.getInitialData=async function(){var i;const c=await J(),m=((i=y())==null?void 0:i.optionsUIDs)??[];return{data:c,optionsUIDs:m}};export{K as ProductOptions,K as default};
