import{jsx as a,jsxs as G}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as ce,classes as le}from"@dropins/tools/lib.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{g as fe,c as de,a as ge}from"./createCustomerAddress.js";import{useState as y,useEffect as he,useCallback as H}from"@dropins/tools/preact-hooks.js";import{s as ee,b as pe}from"./simplifyTransformAttributesForm.js";import{v as be,u as Fe,a as _e}from"./usePasswordValidationMessage.js";import{a as ye}from"./getCustomerToken.js";import{p as te,E as re}from"./getStoreConfig.js";import{c as I,g as Ne,u as Te,F as Ue,B as ie}from"./UpdatePasswordForm.js";import{c as xe}from"./transform-attributes-form.js";import{Header as Le,InLineAlert as Ee,InputPassword as Pe,Field as X,Checkbox as Y}from"@dropins/tools/components.js";/* empty css                       */import{S as ve}from"./SkeletonLoader.js";import{E as Se}from"./EmailConfirmationForm.js";import{useText as we}from"@dropins/tools/i18n.js";const se=(t,s)=>s!=null&&s.length?t.map(u=>{var r;const e=(r=s.find(({code:m})=>m===u.code))==null?void 0:r.defaultValue;return e?{...u,defaultValue:e}:u}):t,Me=({inputsDefaultValueSet:t,fieldsConfigForApiVersion1:s,apiVersion2:u})=>{const[e,r]=y([]);return he(()=>{(async()=>{if(u){const i=await fe("customer_account_create");if(i!=null&&i.length)if(t!=null&&t.length){const c=se(i,t);r(c)}else r(i)}else{const i=ee(pe),c=ee(s),p=se(i,t);r(s&&s.length?c:p)}})()},[u,s,t]),{fieldsListConfigs:e}},qe=(t,s)=>{const u=["date_of_birth","dob","email","firstname","gender","is_subscribed","lastname","middlename","password","prefix","suffix","taxvat"],e=xe(t,"snakeCase",{firstName:"firstname",lastName:"lastname"});if(!s)return{...e,...e!=null&&e.gender?{gender:Number(e==null?void 0:e.gender)}:{}};const r={},m=[];return Object.keys(e).forEach(i=>{u.includes(i)?r[i]=i.includes("gender")?Number(e[i]):e[i]:m.push({attribute_code:i,value:e[i]})}),m.length>0&&(r.custom_attributes=m),r},Ae=({addressesData:t,translations:s,isEmailConfirmationRequired:u,apiVersion2:e=!0,passwordConfigs:r,isAutoSignInEnabled:m,routeRedirectOnSignIn:i,routeSignIn:c,onErrorCallback:p,onSuccessCallback:n,setActiveComponent:f,handleSetInLineAlertProps:d,routeRedirectOnEmailConfirmationClose:L})=>{const[W,S]=y(""),[b,o]=y(!1),[l,T]=y({userName:"",status:!1}),[w,g]=y(""),[M,q]=y(!1),[$,F]=y(!1),[A,C]=y(!0),E=H(({target:_})=>{C(_.checked)},[]),K=H(()=>{if(I(f)){f("signInForm");return}I(c)&&(window.location.href=c())},[f,c]),V=H(_=>{g(_)},[]),J=H(()=>{d(),g(""),I(L)?window.location.href=L():(o(!1),f==null||f("signInForm"))},[d,L,f]);return{isKeepMeLogged:A,userEmail:W,showEmailConfirmationForm:b,isSuccessful:l,isClickSubmit:M,signUpPasswordValue:w,isLoading:$,onSubmitSignUp:async(_,O)=>{var k,z,D;if(d(),F(!0),!O){q(!0),F(!1);return}const B=e?"createCustomerV2":"createCustomer",N=Ne(_.target),{email:P,password:v,is_subscribed:ae}=N,oe=(r==null?void 0:r.requiredCharacterClasses)||0,ue=(r==null?void 0:r.minLength)||1;if(!be(v,oe)||ue>(v==null?void 0:v.length)){q(!0),F(!1);return}const me=qe({...N,is_subscribed:!!ae||!1},e),{data:U,errors:x}=await de(me,e),j=((z=(k=U==null?void 0:U.createCustomer)==null?void 0:k.customer)==null?void 0:z.firstname)||"";if(x&&(x!=null&&x.length))d==null||d({type:"error",text:x[0].message}),p==null||p(x),te(re.CREATE_ACCOUNT_EVENT,{updateProfile:!1}),S(P);else{const Q={email:"",...U==null?void 0:U[B]};if(te(re.CREATE_ACCOUNT_EVENT,{email:Q==null?void 0:Q.email,updateProfile:!0}),u||!m){if(n==null||n({userName:j,status:!0}),u){(D=_.target)==null||D.reset(),g(""),o(!0),S(P),F(!1);return}if(!m){F(!1),T({userName:j,status:!0});return}}const h=await ye({email:P,password:v,translations:s,handleSetInLineAlertProps:d,onErrorCallback:p});if(h!=null&&h.userName){if(t!=null&&t.length)for(const R of t)try{await ge(R)}catch(ne){console.error(s.failedCreateCustomerAddress,R,ne)}I(i)?window.location.href=i():(n==null||n({userName:h==null?void 0:h.userName,status:!0}),T({userName:h==null?void 0:h.userName,status:!0}))}else n==null||n({userName:j,status:!0}),T({userName:j,status:!0})}F(!1)},signInButton:K,handleSetSignUpPasswordValue:V,onKeepMeLoggedChange:E,handleHideEmailConfirmationForm:J}},ze=({addressesData:t,formSize:s="default",inputsDefaultValueSet:u,fieldsConfigForApiVersion1:e,apiVersion2:r=!0,isAutoSignInEnabled:m=!0,displayTermsOfUseCheckbox:i=!1,displayNewsletterCheckbox:c=!1,hideCloseBtnOnEmailConfirmation:p=!1,routeRedirectOnEmailConfirmationClose:n,routeRedirectOnSignIn:f,routeSignIn:d,onErrorCallback:L,onSuccessCallback:W,setActiveComponent:S,slots:b})=>{const o=we({title:"Auth.SignUpForm.title",buttonPrimary:"Auth.SignUpForm.buttonPrimary",buttonSecondary:"Auth.SignUpForm.buttonSecondary",privacyPolicyDefaultText:"Auth.SignUpForm.privacyPolicyDefaultText",subscribedDefaultText:"Auth.SignUpForm.subscribedDefaultText",keepMeLoggedText:"Auth.SignUpForm.keepMeLoggedText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",failedCreateCustomerAddress:"Auth.SignUpForm.failedCreateCustomerAddress",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError"}),{passwordConfigs:l,isEmailConfirmationRequired:T}=Fe(),{fieldsListConfigs:w}=Me({fieldsConfigForApiVersion1:e,apiVersion2:r,inputsDefaultValueSet:u}),{inLineAlertProps:g,handleSetInLineAlertProps:M}=Te(),{isKeepMeLogged:q,userEmail:$,showEmailConfirmationForm:F,isSuccessful:A,isClickSubmit:C,signUpPasswordValue:E,isLoading:K,onSubmitSignUp:V,signInButton:J,handleSetSignUpPasswordValue:Z,onKeepMeLoggedChange:_,handleHideEmailConfirmationForm:O}=Ae({addressesData:t,translations:o,isEmailConfirmationRequired:T,apiVersion2:r,passwordConfigs:l,isAutoSignInEnabled:m,routeRedirectOnSignIn:f,routeSignIn:d,onErrorCallback:L,onSuccessCallback:W,setActiveComponent:S,handleSetInLineAlertProps:M,routeRedirectOnEmailConfirmationClose:n}),{isValidUniqueSymbols:B,defaultLengthMessage:N}=_e({password:E,isClickSubmit:C,passwordConfigs:l}),P=!T&&(t==null?void 0:t.length);return!w.length&&r?a("div",{className:`auth-sign-up-form auth-sign-up-form--${s} skeleton-loader`,"data-testid":"SignUpForm",children:a(ve,{activeSkeleton:"signUpForm"})}):A.status&&(b!=null&&b.SuccessNotification)?a(ce,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:b==null?void 0:b.SuccessNotification,context:{isSuccessful:A}}):F?a(Se,{formSize:s,userEmail:$,inLineAlertProps:g,hideCloseBtnOnEmailConfirmation:p,handleSetInLineAlertProps:M,onPrimaryButtonClick:O}):G("div",{className:le(["auth-sign-up-form",`auth-sign-up-form--${s}`]),"data-testid":"SignUpForm",children:[a(Le,{title:o.title,divider:!1,className:"auth-sign-up-form__title"}),g.text?a(Ee,{className:"auth-sign-up-form__notification",type:g.type,variant:"secondary",heading:g.text,icon:g.icon}):null,G(Ue,{onSubmit:V,className:"auth-sign-up-form__form",loading:K,name:"signUp_form",fieldsConfig:w,children:[a(Pe,{validateLengthConfig:N,className:"auth-sign-up-form__form__field",autoComplete:"current-password",name:"password",minLength:l==null?void 0:l.minLength,errorMessage:B==="error"||(N==null?void 0:N.status)==="error"||C&&E.length<=0?o.requiredFieldError:void 0,defaultValue:E,uniqueSymbolsStatus:B,requiredCharacterClasses:l==null?void 0:l.requiredCharacterClasses,onValue:Z,placeholder:o.placeholder,floatingLabel:o.floatingLabel,children:P?a("div",{className:"auth-sign-up-form__automatic-login",children:a(X,{children:a(Y,{name:"",placeholder:o.keepMeLoggedText,label:o.keepMeLoggedText,checked:q,onChange:_})})}):null}),c||i?G("div",{className:"auth-sign-up-form__item auth-sign-up-form__checkbox",children:[c?a(X,{children:a(Y,{"data-testid":"isSubscribed",name:"is_subscribed",placeholder:o.subscribedDefaultText,label:o.subscribedDefaultText})}):null,i?a(X,{children:a(Y,{"data-testid":"privacyPolicy",name:"privacyPolicy",placeholder:o.privacyPolicyDefaultText,label:o.privacyPolicyDefaultText})}):null]}):null,G("div",{className:"auth-sign-up-form-buttons",children:[a(ie,{type:"button",variant:"tertiary",style:{padding:0},buttonText:o.buttonSecondary,enableLoader:!1,onClick:J}),a(ie,{type:"submit",buttonText:o.buttonPrimary,variant:"primary",enableLoader:K})]})]}),a("div",{id:"createCustomerV2"})]})};export{ze as S};
