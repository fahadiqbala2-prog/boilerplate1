{"version":3,"mappings":"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","names":["useSlot","context","callback","render","elementRef","useRef","loadedRef","methodsRef","props","_setProps","useState","children","_state","setState","state","useMemo","get","key","set","value","intl","useContext","IntlContext","dictionary","_registerMethod","useCallback","current","push","warn","_htmlElementToVNode","elem","_jsx","tagName","toLowerCase","ref","refElem","appendChild","getSlotElement","element","document","querySelector","prependChild","insertBefore","firstChild","appendSibling","parent","parentNode","nextSibling","prependSibling","onChange","replaceWith","next","vnode","prev","useEffect","error","console","name","forEach","method","JSON","stringify","Slot","slot","slotProps","window","DROPINS","showSlots","sessionStorage","setItem","toString","body","classList","toggle","__vitePreload","getItem"],"ignoreList":[],"sources":["../../src/lib/slot.tsx"],"sourcesContent":["import { RefObject, VNode } from 'preact';\nimport {\n  StateUpdater,\n  useContext,\n  useState,\n  useRef,\n  useEffect,\n  useMemo,\n  useCallback,\n} from 'preact/hooks';\nimport { IntlContext, Lang } from '@adobe/elsie/i18n';\nimport { HTMLAttributes } from 'preact/compat';\n\ntype MutateElement = (elem: HTMLElement) => void;\n\ninterface State {\n  get: (key: string) => void;\n  set: (key: string, value: any) => void;\n}\n\ninterface SlotElement {\n  appendChild: MutateElement;\n  prependChild: MutateElement;\n  appendSibling: MutateElement;\n  prependSibling: MutateElement;\n}\n\ninterface PrivateContext<T> {\n  _setProps: StateUpdater<{}>;\n  _registerMethod: (\n    cb: (next: T & DefaultSlotContext<T>, state: State) => void\n  ) => void;\n  _htmlElementToVNode: (element: HTMLElement) => VNode;\n}\n\ninterface DefaultSlotContext<T> extends PrivateContext<T> {\n  dictionary: Lang;\n  getSlotElement: (key: string) => SlotElement;\n  replaceWith: MutateElement;\n  appendChild: MutateElement;\n  prependChild: MutateElement;\n  appendSibling: MutateElement;\n  prependSibling: MutateElement;\n  onChange: (cb: (next: T & DefaultSlotContext<T>) => void) => void;\n}\n\ntype Context<T> = T & ThisType<DefaultSlotContext<T>>; // NOSONAR\n\nexport type SlotProps<T = any> = (\n  ctx: T & DefaultSlotContext<T>,\n  element: HTMLDivElement | null\n) => void;\n\nexport type SlotMethod<P = any> = (\n  callback: (next: unknown, state: State) => P\n) => void;\n\n// Slot Hook\nexport function useSlot<K, V extends HTMLDivElement>(\n  // @ts-ignore\n  context: Context<K> = {},\n  callback?: SlotProps<K>,\n  render?: Function\n): [RefObject<V>, Record<string, any>] {\n  // HTML Element\n  const elementRef = useRef<V>(null);\n\n  const loadedRef = useRef(false);\n\n  // Methods\n  const methodsRef = useRef<any>([]);\n\n  // Children VNodes\n  const [props, _setProps] = useState<Record<string, any>>({\n    children: [render?.({})],\n  });\n\n  // Attributes\n  const [_state, setState] = useState<any>({});\n\n  const state = useMemo(\n    () => ({\n      get: (key: string) => _state[key],\n      set: (key: string, value: any) => {\n        setState({ ...state, [key]: value });\n      },\n    }),\n    [_state]\n  );\n\n  /** Internationalization */\n  const { intl }: any = useContext(IntlContext);\n\n  // @ts-ignore\n  context.dictionary = intl.dictionary;\n\n  /** Privates */\n  // @ts-ignore\n  context._setProps = _setProps;\n\n  const _registerMethod = useCallback((callback: Function) => {\n    if (typeof callback === 'function') {\n      methodsRef.current.push(callback);\n    } else {\n      console.warn('Skipped: Invalid _registerMethod', callback);\n    }\n  }, []);\n\n  // @ts-ignore\n  context._registerMethod = _registerMethod;\n\n  const _htmlElementToVNode = useCallback((elem: HTMLElement) => {\n    return (\n      <div\n        data-slot-html-element={elem.tagName.toLowerCase()}\n        ref={(refElem) => {\n          refElem?.appendChild(elem);\n        }}\n      />\n    );\n  }, []);\n\n  // @ts-ignore\n  context._htmlElementToVNode = _htmlElementToVNode;\n\n  /** Prebuilt Methods */\n  // @ts-ignore\n  context.getSlotElement = useCallback((key: string) => {\n    const element = document.querySelector(`[data-slot-key=\"${key}\"]`);\n\n    if (!element) return;\n\n    return {\n      appendChild: (elem: HTMLElement) => {\n        element.appendChild(elem);\n      },\n\n      prependChild: (elem: HTMLElement) => {\n        element.insertBefore(elem, element.firstChild);\n      },\n\n      appendSibling: (elem: HTMLElement) => {\n        const parent = element.parentNode;\n        parent?.insertBefore(elem, element.nextSibling);\n      },\n\n      prependSibling: (elem: HTMLElement) => {\n        const parent = element.parentNode;\n        parent?.insertBefore(elem, element);\n      },\n    };\n  }, []);\n\n  // @ts-ignore\n  context.onChange = useCallback((callback: Function) => {\n    methodsRef.current.push(callback);\n  }, []);\n\n  // @ts-ignore\n  context.replaceWith = useCallback(\n    (elem: HTMLElement) => {\n      // @ts-ignore\n      _registerMethod((next) => {\n        // @ts-ignore\n        const children = _htmlElementToVNode(elem);\n\n        next._setProps({ children: [children] });\n      });\n    },\n    [_htmlElementToVNode, _registerMethod]\n  );\n\n  // @ts-ignore\n  context.appendChild = useCallback(\n    (elem: HTMLElement) => {\n      // @ts-ignore\n      _registerMethod((next) => {\n        // @ts-ignore\n        const vnode = _htmlElementToVNode(elem);\n\n        next._setProps((prev: any) => {\n          return {\n            ...prev,\n            children: [...prev.children, vnode],\n          };\n        });\n      });\n    },\n    [_htmlElementToVNode, _registerMethod]\n  );\n\n  // @ts-ignore\n  context.prependChild = useCallback(\n    (elem: HTMLElement) => {\n      // @ts-ignore\n      _registerMethod((next) => {\n        // @ts-ignore\n        const vnode = _htmlElementToVNode(elem);\n\n        next._setProps((prev: any) => {\n          return {\n            ...prev,\n            children: [vnode, ...prev.children],\n          };\n        });\n      });\n    },\n    [_htmlElementToVNode, _registerMethod]\n  );\n\n  // @ts-ignore\n  context.appendSibling = useCallback(\n    (elem: HTMLElement) => {\n      // @ts-ignore\n      _registerMethod(() => {\n        const parent = elementRef.current?.parentNode;\n\n        parent?.insertBefore(elem, elementRef.current?.nextSibling ?? null);\n      });\n    },\n    [_registerMethod]\n  );\n\n  // @ts-ignore\n  context.prependSibling = useCallback(\n    (elem: HTMLElement) => {\n      // @ts-ignore\n      _registerMethod(() => {\n        const parent = elementRef.current?.parentNode;\n\n        parent?.insertBefore(elem, elementRef.current);\n      });\n    },\n    [_registerMethod]\n  );\n\n  // Initialization\n  useEffect(() => {\n    const element = elementRef.current;\n\n    if (!callback || !element) return;\n\n    // Run callback\n    try {\n      callback(context as K & DefaultSlotContext<K>, element);\n    } catch (error) {\n      console.error(`Error in \"${callback.name}\" Slot callback`, error);\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Lifecycles\n  useEffect(() => {\n    // Reset\n    _setProps({ children: [render?.(props)] });\n\n    // Run all registered methods\n    methodsRef.current.forEach((method: any) => {\n      method(context, state);\n    });\n\n    // Required to trigger re-render of render method\n    if (render?.name === 'render' && loadedRef.current === false) {\n      loadedRef.current = true;\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [JSON.stringify(context), JSON.stringify(_state), loadedRef.current]);\n\n  return [elementRef, props];\n}\n\n// Slot Component\ninterface SlotPropsComponent<T>\n  extends Omit<HTMLAttributes<HTMLDivElement>, 'slot'> {\n  name: string;\n  slot?: SlotProps<T>;\n  context?: Context<T>;\n  render?: (props: Record<string, any>) => VNode | VNode[];\n}\n\nexport function Slot<T>({\n  name,\n  slot,\n  context,\n  children,\n  render,\n  ...props\n}: Readonly<SlotPropsComponent<T>>) {\n  const [elementRef, slotProps] = useSlot<T, HTMLDivElement>(\n    context,\n    slot,\n    render ?? (() => children)\n  );\n\n  useEffect(() => {\n    if (!name) console.warn('Slot \"name\" is required');\n  }, [name]);\n\n  return (\n    <div {...props} ref={elementRef} data-slot={name}>\n      {slotProps.children}\n    </div>\n  );\n}\n\n// Debugger\n\n// @ts-ignore\nwindow.DROPINS = window.DROPINS || {};\n\n// @ts-ignore\nwindow.DROPINS.showSlots = async (state) => {\n  // cache state in session storage\n  window.sessionStorage.setItem(\n    'dropin-debugger--show-slots',\n    state.toString()\n  );\n\n  document.body.classList.toggle('dropin-debugger--show-slots', state);\n\n  if (state) {\n    try {\n      await import('@adobe/elsie/components/UIProvider/debugger.css');\n    } catch (error) {}\n  }\n};\n\n// @ts-ignore\nwindow.DROPINS.showSlots(\n  window.sessionStorage.getItem('dropin-debugger--show-slots') === 'true'\n);\n"],"file":"lib/slot.js"}