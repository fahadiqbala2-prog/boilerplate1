{"version":3,"file":"TextSwatch.js","sources":["../../src/components/TextSwatch/TextSwatch.tsx"],"sourcesContent":["import { FunctionComponent } from 'preact';\nimport {\n  HTMLAttributes,\n  useState,\n  useEffect,\n  useRef,\n  useCallback,\n} from 'preact/compat';\nimport { classes } from '@adobe/elsie/lib';\nimport '@adobe/elsie/components/TextSwatch/TextSwatch.css';\nimport { useText } from '@adobe/elsie/i18n';\n\nexport interface TextSwatchProps\n  extends Omit<HTMLAttributes<HTMLInputElement>, 'label'> {\n  name?: string;\n  label: string;\n  groupAriaLabel?: string;\n  value?: string;\n  id: string;\n  disabled?: boolean;\n  selected?: boolean;\n  outOfStock?: boolean;\n  multi?: boolean;\n  onValue?: (value: any) => void;\n  onUpdateError?: (error: Error) => void;\n}\n\nexport const TextSwatch: FunctionComponent<TextSwatchProps> = ({\n  className,\n  name,\n  value,\n  label,\n  groupAriaLabel,\n  id,\n  disabled = false,\n  selected = false,\n  outOfStock = false,\n  multi = false,\n  onValue,\n  onUpdateError,\n  ...props\n}) => {\n  // i18n\n  const outOfStockLabel = useText('Dropin.Swatches.outOfStock.label').label;\n  const selectedLabel = useText('Dropin.Swatches.selected.label').label;\n  const swatchLabel = useText('Dropin.Swatches.swatch.label').label;\n\n  const [isOverflowing, setIsOverflowing] = useState(false);\n  const spanRef = useRef<HTMLLabelElement>(null);\n\n  const onValueHandler = useCallback(\n    async (newValue: any) => {\n      if (onValue) {\n        try {\n          await onValue(newValue);\n        } catch (e) {\n          if (onUpdateError) {\n            onUpdateError(e as Error);\n          }\n        }\n      }\n    },\n    [onValue, onUpdateError]\n  );\n\n  const handleOnValue = (e: Event) => {\n    const input = e.target as HTMLInputElement;\n\n    onValueHandler(input.value);\n  };\n\n  const handleAriaLabel = () => {\n    if (outOfStock) return `${groupAriaLabel}: ${label} ${outOfStockLabel}`;\n    if (selected) return `${groupAriaLabel}: ${label} ${selectedLabel}`;\n    return `${groupAriaLabel}: ${label} ${swatchLabel}`;\n  };\n\n  useEffect(() => {\n    if (\n      spanRef.current &&\n      spanRef.current.scrollWidth > spanRef.current.clientWidth\n    ) {\n      setIsOverflowing(true);\n    }\n  }, [label]);\n\n  return (\n    <div\n      className=\"dropin-text-swatch__container\"\n      {...(isOverflowing ? { 'data-tooltip': label } : {})}\n    >\n      <input\n        type={multi ? 'checkbox' : 'radio'}\n        name={name}\n        id={id}\n        value={value}\n        aria-label={handleAriaLabel()}\n        checked={selected}\n        disabled={disabled}\n        onChange={handleOnValue}\n        {...props}\n        className={classes([\n          'dropin-text-swatch',\n          ['dropin-text-swatch--selected', selected],\n          ['dropin-text-swatch--disabled', disabled],\n          className,\n        ])}\n      />\n      <label\n        htmlFor={id}\n        ref={spanRef}\n        className={classes([\n          'dropin-text-swatch__label',\n          ['dropin-text-swatch__label--out-of-stock', outOfStock],\n          className,\n        ])}\n      >\n        {label}\n      </label>\n    </div>\n  );\n};\n"],"names":["TextSwatch","className","name","value","label","groupAriaLabel","id","disabled","selected","outOfStock","multi","onValue","onUpdateError","props","outOfStockLabel","useText","selectedLabel","swatchLabel","isOverflowing","setIsOverflowing","useState","spanRef","useRef","onValueHandler","useCallback","newValue","e","handleOnValue","input","target","handleAriaLabel","useEffect","current","scrollWidth","clientWidth","_jsxs","children","_jsx","type","checked","onChange","classes","htmlFor","ref"],"mappings":"yXA2BO,MAAMA,EAAiDA,CAAC,CAC7DC,UAAAA,EACAC,KAAAA,EACAC,MAAAA,EACAC,MAAAA,EACAC,eAAAA,EACAC,GAAAA,EACAC,SAAAA,EAAW,GACXC,SAAAA,EAAW,GACXC,WAAAA,EAAa,GACbC,MAAAA,EAAQ,GACRC,QAAAA,EACAC,cAAAA,EACA,GAAGC,CACL,IAAM,CAEEC,MAAAA,EAAkBC,EAAQ,kCAAkC,EAAEX,MAC9DY,EAAgBD,EAAQ,gCAAgC,EAAEX,MAC1Da,EAAcF,EAAQ,8BAA8B,EAAEX,MAEtD,CAACc,EAAeC,CAAgB,EAAIC,EAAS,EAAK,EAClDC,EAAUC,EAAyB,IAAI,EAEvCC,EAAiBC,EACrB,MAAOC,GAAkB,CACvB,GAAId,EACE,GAAA,CACF,MAAMA,EAAQc,CAAQ,QACfC,EAAG,CACNd,GACFA,EAAcc,CAAW,CAE7B,CACF,EAEF,CAACf,EAASC,CAAa,CACzB,EAEMe,EAAiBD,GAAa,CAClC,MAAME,EAAQF,EAAEG,OAEhBN,EAAeK,EAAMzB,KAAK,CAAA,EAGtB2B,EAAkBA,IAClBrB,EAAoB,GAAEJ,CAAe,KAAID,CAAM,IAAGU,CAAgB,GAClEN,EAAkB,GAAEH,CAAe,KAAID,CAAM,IAAGY,CAAc,GAC1D,GAAEX,CAAe,KAAID,CAAM,IAAGa,CAAY,GAGpDc,OAAAA,EAAU,IAAM,CAEZV,EAAQW,SACRX,EAAQW,QAAQC,YAAcZ,EAAQW,QAAQE,aAE9Cf,EAAiB,EAAI,CACvB,EACC,CAACf,CAAK,CAAC,EAGR+B,EAAA,MAAA,CACElC,UAAU,gCAA+B,GACpCiB,EAAgB,CAAE,eAAgBd,CAAAA,EAAU,CAAC,EAACgC,UAEnDC,EAAA,QAAA,CACEC,KAAM5B,EAAQ,WAAa,QAC3BR,KAAAA,EACAI,GAAAA,EACAH,MAAAA,EACA,aAAY2B,EAAgB,EAC5BS,QAAS/B,EACTD,SAAAA,EACAiC,SAAUb,EAAc,GACpBd,EACJZ,UAAWwC,EAAQ,CACjB,qBACA,CAAC,+BAAgCjC,CAAQ,EACzC,CAAC,+BAAgCD,CAAQ,EACzCN,CAAS,CACV,CAAA,CACF,EACDoC,EAAA,QAAA,CACEK,QAASpC,EACTqC,IAAKtB,EACLpB,UAAWwC,EAAQ,CACjB,4BACA,CAAC,0CAA2ChC,CAAU,EACtDR,CAAS,CACV,EAAEmC,SAEFhC,CAAAA,CACI,CAAC,CAAA,CACL,CAET"}