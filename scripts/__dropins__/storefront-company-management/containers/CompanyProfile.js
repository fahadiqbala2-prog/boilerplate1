/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as d,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import{classes as k,Slot as H}from"@dropins/tools/lib.js";import{Card as x,Button as b,Header as F,InLineAlert as z,Field as y,Input as C,Skeleton as L,SkeletonRow as _}from"@dropins/tools/components.js";import{useState as h,useCallback as w,useEffect as S}from"@dropins/tools/preact-hooks.js";import{g as M,u as P}from"../chunks/updateCompany.js";import*as s from"@dropins/tools/preact-compat.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/fetch-graphql.js";const Z=({company:e,slots:t,showEditForm:r,handleShowEditForm:n})=>{var o,p;if(!e)return a(x,{variant:"secondary",className:"account-company-profile-card",children:a("div",{className:"account-company-profile-card__wrapper",children:a("div",{className:"account-company-profile-card__content",children:a("p",{children:"Company profile not available. Please contact your administrator."})})})});const m=[{name:"name",label:"Company Name",value:e.name||""},{name:"email",label:"Email",value:e.email||""},{name:"legal_name",label:"Legal Name",value:e.legal_name||""},{name:"vat_tax_id",label:"VAT/Tax ID",value:e.vat_tax_id||""},{name:"reseller_id",label:"Reseller ID",value:e.reseller_id||""}];return a(x,{variant:"secondary",className:k(["account-company-profile-card",["account-company-profile-card-short",r]]),children:d("div",{className:"account-company-profile-card__wrapper",children:[a("div",{className:"account-company-profile-card__actions",children:e.canEdit&&a(b,{type:"button",variant:"tertiary",onClick:n,children:"Edit"})}),a("div",{className:"account-company-profile-card__content",children:t!=null&&t.CompanyData?a(H,{name:"CompanyData",slot:t==null?void 0:t.CompanyData,context:{companyData:m}}):d(N,{children:[m.map((i,l)=>{if(!i.value)return null;const u=i.label?`${i.label}: ${i.value}`:i.value;return a("p",{"data-testid":`${i.name}_${l}`,children:u},`${i.name}_${l}`)}),e.legal_address&&d(N,{children:[a("p",{children:a("strong",{children:"Legal Address:"})}),(o=e.legal_address.street)==null?void 0:o.map((i,l)=>a("p",{children:i},l)),d("p",{children:[e.legal_address.city,", ",(p=e.legal_address.region)==null?void 0:p.region," ",e.legal_address.postcode]}),a("p",{children:e.legal_address.countryCode}),e.legal_address.telephone&&d("p",{children:["Phone: ",e.legal_address.telephone]})]})]})})]})})},R=({inLineAlertProps:e,company:t,loading:r=!1,onSubmit:n,onCancel:m})=>{const[o,p]=h({name:(t==null?void 0:t.name)||"",email:(t==null?void 0:t.email)||"",legal_name:(t==null?void 0:t.legal_name)||"",vat_tax_id:(t==null?void 0:t.vat_tax_id)||"",reseller_id:(t==null?void 0:t.reseller_id)||""}),i=async u=>{u.preventDefault(),n&&await n(o)},l=u=>f=>{p(g=>({...g,[u]:f}))};return d(x,{variant:"secondary",className:"account-edit-company-profile",children:[a(F,{title:"Edit Company Profile",divider:!1,className:"account-edit-company-profile__title"}),e!=null&&e.text?a(z,{className:"account-edit-company-profile__notification",type:e.type,variant:"secondary",heading:e.text,icon:e.icon,"data-testid":"editCompanyInLineAlert"}):null,d("form",{className:"account-edit-company-profile-form",onSubmit:i,children:[a(y,{label:"Company Name",required:!0,children:a(C,{name:"name",type:"text",value:o.name,onValue:l("name"),disabled:r,variant:"primary",size:"medium"})}),a(y,{label:"Email",required:!0,children:a(C,{name:"email",type:"email",value:o.email,onValue:l("email"),disabled:r,variant:"primary",size:"medium"})}),a(y,{label:"Legal Name",children:a(C,{name:"legal_name",type:"text",value:o.legal_name,onValue:l("legal_name"),disabled:r,variant:"primary",size:"medium"})}),a(y,{label:"VAT/Tax ID",children:a(C,{name:"vat_tax_id",type:"text",value:o.vat_tax_id,onValue:l("vat_tax_id"),disabled:r,variant:"primary",size:"medium"})}),a(y,{label:"Reseller ID",children:a(C,{name:"reseller_id",type:"text",value:o.reseller_id,onValue:l("reseller_id"),disabled:r,variant:"primary",size:"medium"})}),d("div",{className:"account-edit-company-profile__actions",children:[a(b,{disabled:r,type:"button",variant:"secondary",onClick:m,children:"Cancel"}),a(b,{disabled:r,type:"submit",variant:"primary",children:r?"Saving...":"Save Changes"})]})]})]})},V=({testId:e,withCard:t=!0})=>{const r=d(L,{rowGap:"medium","data-testid":e,children:[d("div",{className:"company-card-loader__header",children:[a(_,{size:"large",variant:"heading"}),a(_,{size:"small",variant:"row"})]}),d("div",{className:"company-card-loader__content",children:[d("div",{className:"company-card-loader__section",children:[a(_,{size:"medium",variant:"heading"}),a(_,{size:"medium",lines:5,multilineGap:"small"})]}),d("div",{className:"company-card-loader__section",children:[a(_,{size:"medium",variant:"heading"}),a(_,{size:"medium",lines:3,multilineGap:"small"})]})]})]});return t?a(x,{variant:"primary",className:"company-card-loader",children:r}):r},$=({handleSetInLineAlert:e})=>{const[t,r]=h(null),[n,m]=h(!0),[o,p]=h(!1),[i,l]=h(!1),u=w(async()=>{try{m(!0);const c=await M();r(c)}catch(c){console.error("Failed to load company:",c),e&&e({type:"error",text:"Failed to load company profile"})}finally{m(!1)}},[e]);S(()=>{u()},[u]);const f=w(()=>{l(!0),e&&e()},[e]),g=w(()=>{l(!1)},[]),D=w(async c=>{try{p(!0);const v={};c.name!==void 0&&(v.company_name=c.name),c.email!==void 0&&(v.company_email=c.email),c.legal_name!==void 0&&(v.legal_name=c.legal_name),c.vat_tax_id!==void 0&&(v.vat_tax_id=c.vat_tax_id),c.reseller_id!==void 0&&(v.reseller_id=c.reseller_id);const E=await P(v);t&&(E.canEdit=t.canEdit,E.customerRole=t.customerRole,E.customerStatus=t.customerStatus),r(E),l(!1),e&&e({type:"success",text:"Company profile updated successfully"})}catch(v){console.error("Failed to update company:",v),e&&e({type:"error",text:"Failed to update company profile"})}finally{p(!1)}},[t,e]);return{company:t,loading:n,saving:o,showEditForm:i,handleShowEditForm:f,handleHideEditForm:g,handleUpdateCompany:D}},B=e=>s.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("g",{clipPath:"url(#clip0_841_1324)"},s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),s.createElement("defs",null,s.createElement("clipPath",{id:"clip0_841_1324"},s.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)"})))),W=e=>s.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),j=e=>s.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),s.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),T={success:a(W,{}),warning:a(B,{}),error:a(j,{})},G=()=>{const[e,t]=h({}),r=w(n=>{if(!(n!=null&&n.type)){t({});return}const m=T[n.type];t({...n,icon:m})},[]);return{inLineAlertProps:e,handleSetInLineAlert:r}},X=({className:e,withHeader:t=!0,slots:r})=>{const{inLineAlertProps:n,handleSetInLineAlert:m}=G(),{company:o,loading:p,saving:i,showEditForm:l,handleShowEditForm:u,handleHideEditForm:f,handleUpdateCompany:g}=$({handleSetInLineAlert:m});return p?a("div",{"data-testid":"companyProfileLoader",children:a(V,{withCard:!0})}):d("div",{className:k(["account-company-profile",e]),children:[t?a(F,{title:"Company Profile",divider:!1,className:"company-profile__title"}):null,a(Z,{company:o,slots:r,showEditForm:l,handleShowEditForm:u}),l?a(R,{inLineAlertProps:n,company:o,loading:i,onSubmit:g,onCancel:f}):null]})};export{X as CompanyProfile,X as default};
//# sourceMappingURL=CompanyProfile.js.map
