/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as m,Fragment as V}from"@dropins/tools/preact-jsx-runtime.js";import{classes as b,Slot as H}from"@dropins/tools/lib.js";import{Card as N,Button as E,Header as F,InLineAlert as I,Field as g,Input as C,Skeleton as M,SkeletonRow as w}from"@dropins/tools/components.js";import{useState as h,useCallback as x,useEffect as D}from"@dropins/tools/preact-hooks.js";import{g as T,u as S}from"../chunks/updateCompany.js";import*as c from"@dropins/tools/preact-compat.js";import{useText as k}from"@dropins/tools/i18n.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/fetch-graphql.js";const z=({company:e,slots:t,showEditForm:r,handleShowEditForm:d})=>{var s,u;const l=k({editButton:"Company.shared.buttons.edit",noDataMessage:"Company.CompanyProfileCard.noDataMessage",companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",legalAddress:"Company.shared.fields.legalAddress"});if(!e)return a(N,{variant:"secondary",className:"account-company-profile-card",children:a("div",{className:"account-company-profile-card__wrapper",children:a("div",{className:"account-company-profile-card__content",children:a("div",{className:"account-company-profile-card__no-data",children:a("p",{children:l.noDataMessage})})})})});const i=[{name:"name",label:l.companyName,value:e.name||""},{name:"email",label:l.email,value:e.email||""},{name:"legal_name",label:l.legalName,value:e.legal_name||""},{name:"vat_tax_id",label:l.vatTaxId,value:e.vat_tax_id||""},{name:"reseller_id",label:l.resellerId,value:e.reseller_id||""}];return a(N,{variant:"secondary",className:b(["account-company-profile-card",["account-company-profile-card-short",r]]),children:m("div",{className:"account-company-profile-card__wrapper",children:[a("div",{className:"account-company-profile-card__actions",children:e.canEdit&&a(E,{type:"button",variant:"tertiary",onClick:d,children:l.editButton})}),a("div",{className:"account-company-profile-card__content",children:t!=null&&t.CompanyData?a(H,{name:"CompanyData",slot:t==null?void 0:t.CompanyData,context:{companyData:i}}):m(V,{children:[i.map((n,o)=>{if(!n.value)return null;const p=n.label?`${n.label}: ${n.value}`:n.value;return a("p",{"data-testid":`${n.name}_${o}`,children:p},`${n.name}_${o}`)}),e.legal_address&&m("div",{className:"company-legal-address",children:[a("p",{children:m("strong",{children:[l.legalAddress,":"]})}),(s=e.legal_address.street)==null?void 0:s.map((n,o)=>a("p",{children:n},o)),m("p",{children:[e.legal_address.city,", ",(u=e.legal_address.region)==null?void 0:u.region," ",e.legal_address.postcode]}),a("p",{children:e.legal_address.countryCode}),e.legal_address.telephone&&m("p",{children:["Phone: ",e.legal_address.telephone]})]})]})})]})})},L=({inLineAlertProps:e,company:t,loading:r=!1,onSubmit:d,onCancel:l})=>{const i=k({title:"Company.EditCompanyProfile.title",companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",cancel:"Company.shared.buttons.cancel",save:"Company.shared.buttons.save",saving:"Company.shared.buttons.saving"}),[s,u]=h({name:(t==null?void 0:t.name)||"",email:(t==null?void 0:t.email)||"",legal_name:(t==null?void 0:t.legal_name)||"",vat_tax_id:(t==null?void 0:t.vat_tax_id)||"",reseller_id:(t==null?void 0:t.reseller_id)||""}),n=async p=>{p.preventDefault(),d&&await d(s)},o=p=>v=>{u(y=>({...y,[p]:v}))};return m(N,{variant:"secondary",className:"account-edit-company-profile",children:[a(F,{title:i.title,divider:!1,className:"account-edit-company-profile__title"}),e!=null&&e.text?a(I,{className:"account-edit-company-profile__notification",type:e.type,variant:"secondary",heading:e.text,icon:e.icon,"data-testid":"editCompanyInLineAlert"}):null,m("form",{className:"account-edit-company-profile-form",onSubmit:n,children:[a(g,{label:i.companyName,required:!0,className:"account-edit-company-profile-form__field",children:a(C,{name:"name",type:"text",value:s.name,onValue:o("name"),disabled:r,variant:"primary",size:"medium"})}),a(g,{label:i.email,required:!0,className:"account-edit-company-profile-form__field",children:a(C,{name:"email",type:"email",value:s.email,onValue:o("email"),disabled:r,variant:"primary",size:"medium"})}),a(g,{label:i.legalName,className:"account-edit-company-profile-form__field",children:a(C,{name:"legal_name",type:"text",value:s.legal_name,onValue:o("legal_name"),disabled:r,variant:"primary",size:"medium"})}),a(g,{label:i.vatTaxId,className:"account-edit-company-profile-form__field",children:a(C,{name:"vat_tax_id",type:"text",value:s.vat_tax_id,onValue:o("vat_tax_id"),disabled:r,variant:"primary",size:"medium"})}),a(g,{label:i.resellerId,className:"account-edit-company-profile-form__field",children:a(C,{name:"reseller_id",type:"text",value:s.reseller_id,onValue:o("reseller_id"),disabled:r,variant:"primary",size:"medium"})}),m("div",{className:"account-edit-company-profile__actions",children:[a(E,{disabled:r,type:"button",variant:"secondary",onClick:l,children:i.cancel}),a(E,{disabled:r,type:"submit",variant:"primary",children:r?i.saving:i.save})]})]})]})},W=({testId:e,withCard:t=!0})=>{const r=m(M,{"data-testid":e||"companySkeletonLoader",children:[a(w,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),a(w,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),a(w,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]});return t?r:a(N,{variant:"secondary",className:b(["company-company-loaders","company-company-loaders--card-loader"]),children:r})},B=({handleSetInLineAlert:e})=>{const[t,r]=h(null),[d,l]=h(!0),[i,s]=h(!1),[u,n]=h(!1),o=x(()=>{T().then(_=>{r(_),l(!1)}).catch(_=>{console.error("Failed to load company:",_),l(!1),e&&e({type:"error",text:"Failed to load company profile"})})},[e]);D(()=>{o()},[o]);const p=x(()=>{n(!0),e&&e()},[e]),v=x(()=>{n(!1)},[]),y=x(async _=>{try{s(!0);const f=await S(_);t&&(f.canEdit=t.canEdit,f.customerRole=t.customerRole,f.customerStatus=t.customerStatus),r(f),n(!1),e&&e({type:"success",text:"Company profile updated successfully"})}catch(f){console.error("Failed to update company:",f),e&&e({type:"error",text:"Failed to update company profile"})}finally{s(!1)}},[t,e]);return{company:t,loading:d,saving:i,showEditForm:u,handleShowEditForm:p,handleHideEditForm:v,handleUpdateCompany:y}},P=e=>c.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},c.createElement("g",{clipPath:"url(#clip0_841_1324)"},c.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),c.createElement("defs",null,c.createElement("clipPath",{id:"clip0_841_1324"},c.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)"})))),Z=e=>c.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},c.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),c.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),$=e=>c.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},c.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),c.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),j={success:a(Z,{}),warning:a(P,{}),error:a($,{})},R=()=>{const[e,t]=h({}),r=x(d=>{if(!(d!=null&&d.type)){t({});return}const l=j[d.type];t({...d,icon:l})},[]);return{inLineAlertProps:e,handleSetInLineAlert:r}},Y=({className:e,withHeader:t=!0,slots:r})=>{const d=k({containerTitle:"Company.CompanyProfile.containerTitle"}),{inLineAlertProps:l,handleSetInLineAlert:i}=R(),{company:s,loading:u,saving:n,showEditForm:o,handleShowEditForm:p,handleHideEditForm:v,handleUpdateCompany:y}=B({handleSetInLineAlert:i});return u?a("div",{"data-testid":"companyProfileLoader",children:a(W,{withCard:!0})}):m("div",{className:b(["account-company-profile",e]),children:[t?a(F,{title:d.containerTitle,divider:!1,className:"company-profile__title"}):null,a(z,{company:s,slots:r,showEditForm:o,handleShowEditForm:p}),o?a(L,{inLineAlertProps:l,company:s,loading:n,onSubmit:y,onCancel:v}):null]})};export{Y as CompanyProfile,Y as default};
//# sourceMappingURL=CompanyProfile.js.map
