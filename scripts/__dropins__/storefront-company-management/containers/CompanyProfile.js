/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as _,Fragment as _e}from"@dropins/tools/preact-jsx-runtime.js";import{classes as S,Slot as ue}from"@dropins/tools/lib.js";import{Card as T,Button as I,Header as oe,InLineAlert as ge,Field as b,Input as x,Picker as ie,Skeleton as pe,SkeletonRow as D}from"@dropins/tools/components.js";import{useState as N,useEffect as z,useMemo as B,useCallback as R}from"@dropins/tools/preact-hooks.js";import{g as fe,v as he,a as ye,u as ve}from"../chunks/getCountries.js";import*as C from"@dropins/tools/preact-compat.js";import{useText as W}from"@dropins/tools/i18n.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/fetch-graphql.js";const Ce=({company:r,slots:e,showEditForm:o,handleShowEditForm:y})=>{var l,h;const u=W({editButton:"Company.shared.buttons.edit",noDataMessage:"Company.CompanyProfileCard.noDataMessage",companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",legalAddress:"Company.shared.fields.legalAddress",contacts:"Company.CompanyProfileCard.contacts",companyAdministrator:"Company.CompanyProfileCard.companyAdministrator",salesRepresentative:"Company.CompanyProfileCard.salesRepresentative",paymentInformation:"Company.CompanyProfileCard.paymentInformation",availablePaymentMethods:"Company.CompanyProfileCard.availablePaymentMethods"});if(!r)return a(T,{variant:"secondary",className:"account-company-profile-card",children:a("div",{className:"account-company-profile-card__wrapper",children:a("div",{className:"account-company-profile-card__content",children:a("div",{className:"account-company-profile-card__no-data",children:a("p",{children:u.noDataMessage})})})})});const s=[{name:"name",label:u.companyName,value:r.name||""},{name:"email",label:u.email,value:r.email||""},{name:"legal_name",label:u.legalName,value:r.legal_name||""},{name:"vat_tax_id",label:u.vatTaxId,value:r.vat_tax_id||""},{name:"reseller_id",label:u.resellerId,value:r.reseller_id||""}];return a(T,{variant:"secondary",className:S(["account-company-profile-card",["account-company-profile-card-short",o]]),children:_("div",{className:"account-company-profile-card__wrapper",children:[a("div",{className:"account-company-profile-card__actions",children:r.canEdit&&a(I,{type:"button",variant:"tertiary",onClick:y,children:u.editButton})}),a("div",{className:"account-company-profile-card__content",children:e!=null&&e.CompanyData?a(ue,{name:"CompanyData",slot:e==null?void 0:e.CompanyData,context:{companyData:s}}):_(_e,{children:[s.map((i,n)=>{if(!i.value)return null;const g=i.label?`${i.label}: ${i.value}`:i.value;return a("p",{"data-testid":`${i.name}_${n}`,children:g},`${i.name}_${n}`)}),r.legal_address&&_("div",{className:"company-legal-address",children:[a("p",{children:_("strong",{children:[u.legalAddress,":"]})}),(l=r.legal_address.street)==null?void 0:l.map((i,n)=>a("p",{children:i},n)),_("p",{children:[r.legal_address.city,", ",(h=r.legal_address.region)==null?void 0:h.region," ",r.legal_address.postcode]}),a("p",{children:r.legal_address.countryCode}),r.legal_address.telephone&&_("p",{children:["Phone: ",r.legal_address.telephone]})]}),(r.company_admin||r.sales_representative)&&_("div",{className:"company-contacts",children:[a("p",{children:_("strong",{children:[u.contacts,":"]})}),r.company_admin&&_("div",{className:"company-contact",children:[a("p",{children:_("strong",{children:[u.companyAdministrator,":"]})}),_("p",{children:[r.company_admin.firstname," ",r.company_admin.lastname]}),r.company_admin.job_title&&a("p",{children:r.company_admin.job_title}),a("p",{children:r.company_admin.email})]}),r.sales_representative&&_("div",{className:"company-contact",children:[a("p",{children:_("strong",{children:[u.salesRepresentative,":"]})}),_("p",{children:[r.sales_representative.firstname," ",r.sales_representative.lastname]}),a("p",{children:r.sales_representative.email})]})]}),r.payment_methods&&r.payment_methods.length>0&&_("div",{className:"company-payment-methods",children:[a("p",{children:_("strong",{children:[u.paymentInformation,":"]})}),a("p",{children:_("strong",{children:[u.availablePaymentMethods,":"]})}),r.payment_methods.map((i,n)=>a("p",{children:i},`payment_${n}`))]})]})})]})})},be=({inLineAlertProps:r,company:e,loading:o=!1,onSubmit:y,onCancel:u})=>{var Z,j,O,U,G,J,K,Q,X,Y,ee,ae,re;const s=W({title:"Company.EditCompanyProfile.title",companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",legalAddress:"Company.shared.fields.legalAddress",streetAddress:"Company.shared.fields.streetAddress",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",zipPostalCode:"Company.shared.fields.zipPostalCode",phoneNumber:"Company.shared.fields.phoneNumber",cancel:"Company.shared.buttons.cancel",save:"Company.shared.buttons.save",saving:"Company.shared.buttons.saving",required:"Company.shared.validation.required",invalidEmail:"Company.shared.validation.invalidEmail",companyNameRequired:"Company.shared.validation.companyNameRequired",emailRequired:"Company.shared.validation.emailRequired",emailNotAvailable:"Company.shared.validation.emailNotAvailable"}),[l,h]=N({name:(e==null?void 0:e.name)||"",email:(e==null?void 0:e.email)||"",legal_name:(e==null?void 0:e.legal_name)||"",vat_tax_id:(e==null?void 0:e.vat_tax_id)||"",reseller_id:(e==null?void 0:e.reseller_id)||"",legal_address:{street:((j=(Z=e==null?void 0:e.legal_address)==null?void 0:Z.street)==null?void 0:j[0])||"",street_2:((U=(O=e==null?void 0:e.legal_address)==null?void 0:O.street)==null?void 0:U[1])||"",city:((G=e==null?void 0:e.legal_address)==null?void 0:G.city)||"",region:((K=(J=e==null?void 0:e.legal_address)==null?void 0:J.region)==null?void 0:K.region)||"",region_code:((X=(Q=e==null?void 0:e.legal_address)==null?void 0:Q.region)==null?void 0:X.regionCode)||"",country_code:((Y=e==null?void 0:e.legal_address)==null?void 0:Y.countryCode)||"",postcode:((ee=e==null?void 0:e.legal_address)==null?void 0:ee.postcode)||"",telephone:((ae=e==null?void 0:e.legal_address)==null?void 0:ae.telephone)||""}}),[i,n]=N({}),[g,E]=N({}),[p,V]=N(null),[w,H]=N([]),[M,L]=N(!0);z(()=>{fe().then(({availableCountries:t,countriesWithRequiredRegion:d,optionalZipCountries:m})=>{V({availableCountries:t,countriesWithRequiredRegion:d,optionalZipCountries:m}),L(!1)}).catch(t=>{console.error("Failed to load countries:",t),L(!1)})},[]),z(()=>{if(l.legal_address.country_code&&p){const t=p.availableCountries.find(d=>d.value===l.legal_address.country_code);if(t!=null&&t.availableRegions&&t.availableRegions.length>0){const d=t.availableRegions.map(m=>({text:m.name,value:`${m.code},${m.id}`}));H(d)}else H([])}else H([])},[l.legal_address.country_code,p]);const ne=B(()=>(p==null?void 0:p.availableCountries)||[],[p]),F=B(()=>w,[w]),$=B(()=>!l.legal_address.country_code||!p?!1:p.countriesWithRequiredRegion.includes(l.legal_address.country_code),[l.legal_address.country_code,p]),A=B(()=>F.length>0,[F]),k=(t,d)=>{switch(t){case"name":if(!d.trim())return s.companyNameRequired;break;case"email":if(!d.trim())return s.emailRequired;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d))return s.invalidEmail;break;case"legal_address.street":case"legal_address.city":case"legal_address.postcode":case"legal_address.telephone":if(!d.trim())return s.required;break;case"legal_address.country_code":if(!d.trim())return s.required;break;case"legal_address.region":if($&&!d.trim())return s.required;break}return null},ce=()=>{const t={};let d=!0;const m=k("name",l.name);m&&(t.name=m,d=!1);const c=k("email",l.email);c&&(t.email=c,d=!1);const f=k("legal_address.street",l.legal_address.street);f&&(t["legal_address.street"]=f,d=!1);const q=k("legal_address.city",l.legal_address.city);q&&(t["legal_address.city"]=q,d=!1);const le=k("legal_address.postcode",l.legal_address.postcode);le&&(t["legal_address.postcode"]=le,d=!1);const se=k("legal_address.telephone",l.legal_address.telephone);se&&(t["legal_address.telephone"]=se,d=!1);const te=k("legal_address.country_code",l.legal_address.country_code);te&&(t["legal_address.country_code"]=te,d=!1);const de=k("legal_address.region",l.legal_address.region);return de&&(t["legal_address.region"]=de,d=!1),n(t),d},me=async t=>{if(t.preventDefault(),E({name:!0,email:!0,legal_name:!0,vat_tax_id:!0,reseller_id:!0,"legal_address.street":!0,"legal_address.street_2":!0,"legal_address.city":!0,"legal_address.region":!0,"legal_address.region_code":!0,"legal_address.country_code":!0,"legal_address.postcode":!0,"legal_address.telephone":!0}),!!ce()){if(l.email!==(e==null?void 0:e.email)){const d=await he(l.email);if(!d.isValid){n(m=>({...m,email:d.error||s.emailNotAvailable}));return}}if(y){const d={name:l.name,email:l.email,legal_name:l.legal_name,vat_tax_id:l.vat_tax_id,reseller_id:l.reseller_id,legal_address:{street:[l.legal_address.street,l.legal_address.street_2].filter(Boolean),city:l.legal_address.city,region:{region:l.legal_address.region,region_code:l.legal_address.region_code},country_code:l.legal_address.country_code,postcode:l.legal_address.postcode,telephone:l.legal_address.telephone}};await y(d)}}},v=t=>d=>{if(t.startsWith("legal_address.")){const m=t.split(".")[1];m==="country_code"?(h(c=>({...c,legal_address:{...c.legal_address,[m]:d,region:"",region_code:""}})),n(c=>{const f={...c};return delete f["legal_address.region"],delete f["legal_address.region_code"],f}),E(c=>{const f={...c};return delete f["legal_address.region"],delete f["legal_address.region_code"],f})):h(m==="region"?c=>({...c,legal_address:{...c.legal_address,region:d,region_code:A?c.legal_address.region_code:d}}):c=>({...c,legal_address:{...c.legal_address,[m]:d}}))}else h(m=>({...m,[t]:d}));i[t]&&n(m=>{const c={...m};return delete c[t],c})},P=t=>{E(c=>({...c,[t]:!0}));let d="";if(t.startsWith("legal_address.")){const c=t.split(".")[1],f=l.legal_address[c];d=typeof f=="string"?f:""}else{const c=l[t];d=typeof c=="string"?c:""}const m=k(t,d);m&&n(c=>({...c,[t]:m}))};return _(T,{variant:"secondary",className:"account-edit-company-profile",children:[a(oe,{title:s.title,divider:!1,className:"account-edit-company-profile__title"}),r!=null&&r.text?a(ge,{className:"account-edit-company-profile__notification",type:r.type,variant:"secondary",heading:r.text,icon:r.icon,"data-testid":"editCompanyInLineAlert"}):null,_("form",{className:"account-edit-company-profile-form",onSubmit:me,children:[a(b,{label:s.companyName,required:!0,className:"account-edit-company-profile-form__field",error:g.name&&i.name?i.name:void 0,children:a(x,{name:"name",type:"text",value:l.name,onValue:v("name"),onBlur:()=>P("name"),disabled:o,variant:"primary",size:"medium"})}),a(b,{label:s.email,required:!0,className:"account-edit-company-profile-form__field",error:g.email&&i.email?i.email:void 0,children:a(x,{name:"email",type:"email",value:l.email,onValue:v("email"),onBlur:()=>P("email"),disabled:o,variant:"primary",size:"medium"})}),a(b,{label:s.legalName,className:"account-edit-company-profile-form__field",children:a(x,{name:"legal_name",type:"text",value:l.legal_name,onValue:v("legal_name"),disabled:o,variant:"primary",size:"medium"})}),a(b,{label:s.vatTaxId,className:"account-edit-company-profile-form__field",children:a(x,{name:"vat_tax_id",type:"text",value:l.vat_tax_id,onValue:v("vat_tax_id"),disabled:o,variant:"primary",size:"medium"})}),a(b,{label:s.resellerId,className:"account-edit-company-profile-form__field",children:a(x,{name:"reseller_id",type:"text",value:l.reseller_id,onValue:v("reseller_id"),disabled:o,variant:"primary",size:"medium"})}),_("div",{className:"account-edit-company-profile-form__section",children:[a("h3",{className:"account-edit-company-profile-form__section-title",children:s.legalAddress}),a(b,{label:s.streetAddress,required:!0,className:"account-edit-company-profile-form__field",error:g["legal_address.street"]&&i["legal_address.street"]?i["legal_address.street"]:void 0,children:a(x,{name:"legal_address_street",type:"text",value:l.legal_address.street,onValue:v("legal_address.street"),onBlur:()=>P("legal_address.street"),disabled:o,variant:"primary",size:"medium"})}),a(b,{label:s.streetAddress+" 2",className:"account-edit-company-profile-form__field",children:a(x,{name:"legal_address_street_2",type:"text",value:l.legal_address.street_2,onValue:v("legal_address.street_2"),disabled:o,variant:"primary",size:"medium"})}),a(b,{label:s.city,required:!0,className:"account-edit-company-profile-form__field",error:g["legal_address.city"]&&i["legal_address.city"]?i["legal_address.city"]:void 0,children:a(x,{name:"legal_address_city",type:"text",value:l.legal_address.city,onValue:v("legal_address.city"),onBlur:()=>P("legal_address.city"),disabled:o,variant:"primary",size:"medium"})}),a(b,{label:s.country,required:!0,className:"account-edit-company-profile-form__field",error:g["legal_address.country_code"]&&i["legal_address.country_code"]?i["legal_address.country_code"]:void 0,children:a(ie,{name:"legal_address_country_code",floatingLabel:`${s.country} *`,placeholder:s.country,options:ne,value:l.legal_address.country_code,handleSelect:t=>{const d=t.target;v("legal_address.country_code")(d.value)},onBlur:()=>P("legal_address.country_code"),disabled:o||M})}),a(b,{label:s.stateProvince,required:$,className:"account-edit-company-profile-form__field",error:g["legal_address.region"]&&i["legal_address.region"]?i["legal_address.region"]:void 0,children:A?a(ie,{name:"legal_address_region",floatingLabel:`${s.stateProvince} ${$?"*":""}`,placeholder:s.stateProvince,options:F,value:l.legal_address.region_code&&((re=F.find(t=>t.value.split(",")[0]===l.legal_address.region_code))==null?void 0:re.value)||"",handleSelect:t=>{var f;const d=t.target,[m]=d.value.split(","),c=((f=F.find(q=>q.value===d.value))==null?void 0:f.text)||"";v("legal_address.region")(c),h(q=>({...q,legal_address:{...q.legal_address,region:c,region_code:m}}))},onBlur:()=>P("legal_address.region"),disabled:o||M},`region_picker_${l.legal_address.country_code}`):a(x,{name:"legal_address_region",type:"text",value:l.legal_address.region,onValue:v("legal_address.region"),onBlur:()=>P("legal_address.region"),disabled:o||M,variant:"primary",size:"medium"},`region_input_${l.legal_address.country_code}`)}),a(b,{label:s.zipPostalCode,required:!0,className:"account-edit-company-profile-form__field",error:g["legal_address.postcode"]&&i["legal_address.postcode"]?i["legal_address.postcode"]:void 0,children:a(x,{name:"legal_address_postcode",type:"text",value:l.legal_address.postcode,onValue:v("legal_address.postcode"),onBlur:()=>P("legal_address.postcode"),disabled:o,variant:"primary",size:"medium"})}),a(b,{label:s.phoneNumber,required:!0,className:"account-edit-company-profile-form__field",error:g["legal_address.telephone"]&&i["legal_address.telephone"]?i["legal_address.telephone"]:void 0,children:a(x,{name:"legal_address_telephone",type:"tel",value:l.legal_address.telephone,onValue:v("legal_address.telephone"),onBlur:()=>P("legal_address.telephone"),disabled:o,variant:"primary",size:"medium"})})]}),_("div",{className:"account-edit-company-profile__actions",children:[a(I,{disabled:o,type:"button",variant:"secondary",onClick:u,children:s.cancel}),a(I,{disabled:o,type:"submit",variant:"primary",children:o?s.saving:s.save})]})]})]})},Ne=({testId:r,withCard:e=!0})=>{const o=_(pe,{"data-testid":r||"companySkeletonLoader",children:[a(D,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),a(D,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),a(D,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]});return e?o:a(T,{variant:"secondary",className:S(["company-company-loaders","company-company-loaders--card-loader"]),children:o})},xe=({handleSetInLineAlert:r})=>{const[e,o]=N(null),[y,u]=N(!0),[s,l]=N(!1),[h,i]=N(!1),n=R(()=>{ye().then(V=>{o(V),u(!1)}).catch(V=>{console.error("Failed to load company:",V),u(!1),r&&r({type:"error",text:"Failed to load company profile"})})},[r]);z(()=>{n()},[n]);const g=R(()=>{i(!0),r&&r()},[r]),E=R(()=>{i(!1)},[]),p=R(async V=>{try{l(!0);const w=await ve(V);e&&(w.canEdit=e.canEdit,w.customerRole=e.customerRole,w.customerStatus=e.customerStatus),o(w),i(!1),r&&r({type:"success",text:"Company profile updated successfully"})}catch(w){console.error("Failed to update company:",w),r&&r({type:"error",text:"Failed to update company profile"})}finally{l(!1)}},[e,r]);return{company:e,loading:y,saving:s,showEditForm:h,handleShowEditForm:g,handleHideEditForm:E,handleUpdateCompany:p}},Ee=r=>C.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},C.createElement("g",{clipPath:"url(#clip0_841_1324)"},C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),C.createElement("defs",null,C.createElement("clipPath",{id:"clip0_841_1324"},C.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)"})))),we=r=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),ke=r=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),Pe={success:a(we,{}),warning:a(Ee,{}),error:a(ke,{})},Re=()=>{const[r,e]=N({}),[o,y]=N(null),u=R(()=>{e({}),o&&(clearTimeout(o),y(null))},[o]),s=R(n=>{if(o&&(clearTimeout(o),y(null)),!(n!=null&&n.type)){e({});return}const g=Pe[n.type];if(e({type:n.type,text:n.text,icon:g}),n.autoHide!==!1){const E=n.autoHideDelay||(n.type==="success"?3e3:5e3),p=setTimeout(()=>{e({}),y(null)},E);y(p)}},[o]),l=R((n,g=!0)=>{s({type:"success",text:n,autoHide:g})},[s]),h=R((n,g=!1)=>{s({type:"warning",text:n,autoHide:g})},[s]),i=R((n,g=!1)=>{s({type:"error",text:n,autoHide:g})},[s]);return z(()=>()=>{o&&clearTimeout(o)},[o]),{inLineAlertProps:r,handleSetInLineAlert:s,clearAlert:u,showSuccess:l,showWarning:h,showError:i}},$e=({className:r,withHeader:e=!0,slots:o})=>{const y=W({containerTitle:"Company.CompanyProfile.containerTitle"}),{inLineAlertProps:u,handleSetInLineAlert:s}=Re(),{company:l,loading:h,saving:i,showEditForm:n,handleShowEditForm:g,handleHideEditForm:E,handleUpdateCompany:p}=xe({handleSetInLineAlert:s});return h?a("div",{"data-testid":"companyProfileLoader",children:a(Ne,{withCard:!0})}):_("div",{className:S(["account-company-profile",r]),children:[e?a(oe,{title:y.containerTitle,divider:!1,className:"company-profile__title"}):null,a(Ce,{company:l,slots:o,showEditForm:n,handleShowEditForm:g}),n?a(be,{inLineAlertProps:u,company:l,loading:i,onSubmit:p,onCancel:E}):null]})};export{$e as CompanyProfile,$e as default};
//# sourceMappingURL=CompanyProfile.js.map
