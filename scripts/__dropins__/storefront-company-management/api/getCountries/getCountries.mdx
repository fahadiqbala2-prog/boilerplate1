# getCountries

## Overview

The `getCountries` API function retrieves the list of available countries and their regions for company address forms. This function supports both fetching all countries and fetching regions for a specific country.

## Usage

```typescript
import { getCountries } from '@adobe-commerce/storefront-company-management/api';

// Get all countries
const countriesData = await getCountries();

// Get regions for a specific country
const regionsData = await getCountries('US');
```

## Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `countryCode` | `string` | No | ISO 2-letter country code to fetch regions for a specific country |

## Return Value

Returns a Promise that resolves to:

```typescript
{
  availableCountries: Country[];
  countriesWithRequiredRegion: string[];
  optionalZipCountries: string[];
  availableRegions?: Array<{ value: string; text: string }>; // Only when countryCode is provided
}
```

### Country Interface

```typescript
interface Country {
  value: string;           // ISO 2-letter country code
  text: string;           // Country display name
  availableRegions?: Array<{
    id: number;
    code: string;
    name: string;
  }>;
}
```

## Examples

### Basic Usage - Get All Countries

```typescript
import { getCountries } from '@adobe-commerce/storefront-company-management/api';

try {
  const data = await getCountries();
  
  console.log('Available countries:', data.availableCountries);
  console.log('Countries requiring regions:', data.countriesWithRequiredRegion);
  console.log('Countries with optional zip codes:', data.optionalZipCountries);
} catch (error) {
  console.error('Failed to fetch countries:', error);
}
```

### Get Regions for Specific Country

```typescript
import { getCountries } from '@adobe-commerce/storefront-company-management/api';

try {
  const data = await getCountries('US');
  
  if (data.availableRegions) {
    console.log('US regions:', data.availableRegions);
    // Example output: [{ value: 'CA,12', text: 'California' }, ...]
  }
} catch (error) {
  console.error('Failed to fetch US regions:', error);
}
```

### Dynamic Country/Region Form

```typescript
import { useState, useEffect } from 'preact/hooks';
import { getCountries } from '@adobe-commerce/storefront-company-management/api';

function AddressForm() {
  const [countries, setCountries] = useState([]);
  const [regions, setRegions] = useState([]);
  const [selectedCountry, setSelectedCountry] = useState('');
  const [countriesWithRequiredRegion, setCountriesWithRequiredRegion] = useState([]);

  // Load countries on mount
  useEffect(() => {
    getCountries().then(data => {
      setCountries(data.availableCountries);
      setCountriesWithRequiredRegion(data.countriesWithRequiredRegion);
    });
  }, []);

  // Load regions when country changes
  useEffect(() => {
    if (selectedCountry) {
      getCountries(selectedCountry).then(data => {
        setRegions(data.availableRegions || []);
      });
    } else {
      setRegions([]);
    }
  }, [selectedCountry]);

  const isRegionRequired = countriesWithRequiredRegion.includes(selectedCountry);
  const hasRegionOptions = regions.length > 0;

  return (
    <form>
      <select 
        value={selectedCountry} 
        onChange={(e) => setSelectedCountry(e.target.value)}
      >
        <option value="">Select Country</option>
        {countries.map(country => (
          <option key={country.value} value={country.value}>
            {country.text}
          </option>
        ))}
      </select>

      {selectedCountry && (
        hasRegionOptions ? (
          <select required={isRegionRequired}>
            <option value="">Select Region</option>
            {regions.map(region => (
              <option key={region.value} value={region.value}>
                {region.text}
              </option>
            ))}
          </select>
        ) : (
          <input 
            type="text" 
            placeholder="Enter region/state"
            required={isRegionRequired}
          />
        )
      )}
    </form>
  );
}
```

## Caching

The function implements session storage caching to improve performance:

- **Cache Key**: `_company_countries`
- **Cache Duration**: Session-based (cleared when browser session ends)
- **Cache Strategy**: First call fetches from GraphQL, subsequent calls use cached data

## GraphQL Query

The function uses the following GraphQL query:

```graphql
query getCountries {
  countries {
    id
    two_letter_abbreviation
    three_letter_abbreviation
    full_name_locale
    full_name_english
    available_regions {
      id
      code
      name
    }
  }
  storeConfig {
    countries_with_required_region
    optional_zip_countries
  }
}
```

## Error Handling

The function handles various error scenarios:

```typescript
try {
  const data = await getCountries();
} catch (error) {
  if (error.networkError) {
    // Handle network connectivity issues
  } else if (error.graphQLErrors) {
    // Handle GraphQL validation/server errors
  } else {
    // Handle other errors (parsing, etc.)
  }
}
```

## Integration with Forms

This API is commonly used with address forms that need dynamic country/region selection:

1. **Load countries** on component mount
2. **Reset region** when country changes
3. **Show dropdown** if regions are available for selected country
4. **Show text input** if no predefined regions exist
5. **Apply required validation** based on `countriesWithRequiredRegion`

## Custom Regions

For countries without predefined regions (like Uganda, many African countries), users can enter custom region names. The API supports this by:

- Returning empty `availableRegions` array for such countries
- UI should render text input instead of dropdown
- Custom regions are saved with `region_id: 0` in the backend

## Related APIs

- [`updateCompany`](../updateCompany/updateCompany.mdx) - Uses country/region data for legal address updates
- [`getCompany`](../getCompany/getCompany.mdx) - Returns company data including legal address with regions

## Notes

- Country codes follow ISO 3166-1 alpha-2 standard (2-letter codes)
- Region codes vary by country and may not follow a standard format
- Some countries may have regions but not require them for addresses
- The `optionalZipCountries` array indicates countries where postal codes are optional