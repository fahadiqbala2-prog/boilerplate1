/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as m,jsx as t}from"@dropins/tools/preact-jsx-runtime.js";import{classes as E,VComponent as f,debounce as Ue,Slot as I}from"@dropins/tools/lib.js";import{Button as Z,Icon as J,Image as De,Price as U,Skeleton as Ee,SkeletonRow as $e}from"@dropins/tools/components.js";/* empty css                */import*as D from"@dropins/tools/preact-compat.js";import{useState as ve,useCallback as Ae,useMemo as We}from"@dropins/tools/preact-compat.js";import{useState as ee,useCallback as ze,useEffect as Ge,useMemo as Qe}from"@dropins/tools/preact-hooks.js";import{useText as ae}from"@dropins/tools/i18n.js";import{events as Ie}from"@dropins/tools/event-bus.js";import{s as Ve}from"./resetCart.js";import{u as Ne}from"./updateProductsFromCart.js";import{g as ke}from"./persisted-data.js";import{a as He}from"./createGuestCart.js";import{S as Xe,a as Be}from"./WarningWithCircle.js";import{S as je}from"./Close.js";const Re=i=>D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",...i},D.createElement("path",{d:"M1 5H23",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),D.createElement("path",{d:"M17.3674 22H6.63446C5.67952 22 4.88992 21.2688 4.8379 20.3338L4 5H20L19.1621 20.3338C19.1119 21.2688 18.3223 22 17.3655 22H17.3674Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),D.createElement("path",{d:"M9.87189 2H14.1281C14.6085 2 15 2.39766 15 2.88889V5H9V2.88889C9 2.39912 9.39006 2 9.87189 2Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),D.createElement("path",{d:"M8.87402 8.58057L9.39348 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10}),D.createElement("path",{d:"M14.6673 8.58057L14.146 17.682",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),Fe=({entries:i,className:u,...a})=>{const n=ae({itemLabel:"Cart.CartSummaryTable.item",priceLabel:"Cart.CartSummaryTable.price",qtyLabel:"Cart.CartSummaryTable.qty",subtotalLabel:"Cart.CartSummaryTable.subtotal",mobilePriceLabel:"Cart.CartSummaryTable.mobilePrice",mobileQtyLabel:"Cart.CartSummaryTable.mobileQty",mobileSubtotalLabel:"Cart.CartSummaryTable.mobileSubtotal"});return m("div",{...a,className:E(["cart-cart-summary-table",u]),children:[m("div",{className:"cart-cart-summary-table__header",children:[t("div",{className:"cart-cart-summary-table__header-item",children:n.itemLabel}),t("div",{className:"cart-cart-summary-table__header-price",children:n.priceLabel}),t("div",{className:"cart-cart-summary-table__header-qty",children:n.qtyLabel}),t("div",{className:"cart-cart-summary-table__header-subtotal",children:n.subtotalLabel})]}),t("div",{className:"cart-cart-summary-table__body",children:i.map(l=>m("div",{className:E(["cart-cart-summary-table__row",["cart-cart-summary-table__row--updating",l.updating],["cart-cart-summary-table__row--error",l.hasError]]),children:[t("div",{className:"cart-cart-summary-table__cell-item",children:t(f,{node:l.item})}),m("div",{className:"cart-cart-summary-table__cell-price",children:[t("span",{className:"cart-cart-summary-table__mobile-label",children:n.mobilePriceLabel}),t(f,{node:l.price})]}),m("div",{className:"cart-cart-summary-table__cell-qty",children:[t("span",{className:"cart-cart-summary-table__mobile-label",children:n.mobileQtyLabel}),t(f,{node:l.quantity})]}),m("div",{className:"cart-cart-summary-table__cell-subtotal",children:[t("span",{className:"cart-cart-summary-table__mobile-label",children:n.mobileSubtotalLabel}),t(f,{node:l.subtotal})]}),t("div",{className:"cart-cart-summary-table__item-footer",children:t(f,{className:"cart-cart-summary-table__item-actions",node:l.actions})})]},l.uid))})]})},Ze=({className:i,productTitle:u,sku:a,image:n,configurations:l,alert:o,warning:b,...g})=>m("div",{...g,className:E(["cart-cart-summary-table__item",i]),children:[n&&t(f,{className:"cart-cart-summary-table__item-image-wrapper",node:n}),m("div",{className:"cart-cart-summary-table__item-details",children:[u&&t(f,{className:"cart-cart-summary-table__item-name",node:u}),a&&t(f,{className:"cart-cart-summary-table__sku",node:a}),o&&t(f,{className:"cart-cart-summary-table__item-quantity-alert-text",node:o}),b&&t(f,{className:"cart-cart-summary-table__item-quantity-warning-text",node:b}),l&&t(f,{className:"cart-cart-summary-table__item-configurations",node:l})]})]}),Je=({dictionary:i,onQuantityUpdate:u,onItemRemove:a})=>{var N,A;const[n,l]=ve(new Map),[o,b]=ve(new Map),g=(A=(N=Ve)==null?void 0:N.config)==null?void 0:A.shoppingCartDisplaySetting,h=(g==null?void 0:g.price)==="INCLUDING_TAX",q=(g==null?void 0:g.price)==="INCLUDING_EXCLUDING_TAX",$=({item:e})=>{const c={...e.bundleOptions,...e.selectedOptions,...e.customizableOptions,...e.recipient?{[i.recipient]:e.recipient}:null,...e.recipientEmail&&e.recipient?{[i.recipient]:`${e.recipient} (${e.recipientEmail})`}:null,...e.sender?{[i.sender]:e.sender}:null,...e.senderEmail&&e.sender?{[i.sender]:`${e.sender} (${e.senderEmail})`}:{},...e.message?{[i.message]:e.message}:null,...e.links&&e.links.count?e.links.count>1?{[i.files.replace("{count}",e.links.count.toString())]:e.links.result}:{[i.file.replace("{count}",e.links.count.toString())]:e.links.result}:null};if(Object.keys(c).length!==0)return c},M=e=>{var c,s,d,p;return h?e.discounted?{amount:e.regularPrice.value,currency:e.regularPrice.currency,"data-testid":"discounted-regular-item-price"}:{amount:(c=e.taxedPrice)==null?void 0:c.value,currency:(s=e.taxedPrice)==null?void 0:s.currency,"data-testid":"taxed-item-price"}:{amount:(d=e.regularPrice)==null?void 0:d.value,currency:(p=e.regularPrice)==null?void 0:p.currency,"data-testid":"regular-item-price"}},w=e=>{var d,p,y,W,z,j,G,Q,V,R;const c={"aria-label":i.regularPrice},s=e.discounted?{}:null;return["INCLUDING_TAX","INCLUDING_EXCLUDING_TAX"].includes(g==null?void 0:g.price)?(c.amount=(d=e.rowTotalIncludingTax)==null?void 0:d.value,c.currency=(p=e.rowTotalIncludingTax)==null?void 0:p.currency,c.variant=e.discounted?"strikethrough":"default",c["data-testid"]="including-tax-item-total",s&&(c.amount=(y=e.total)==null?void 0:y.value,c.currency=(W=e.total)==null?void 0:W.currency,s.amount=(z=e.rowTotalIncludingTax)==null?void 0:z.value,s.currency=(j=e.rowTotalIncludingTax)==null?void 0:j.currency,s.sale=!0,s["aria-label"]=i.discountedPrice,s["data-testid"]="discount-total")):(c.amount=(G=e.total)==null?void 0:G.value,c.currency=(Q=e.total)==null?void 0:Q.currency,c.variant=e.discounted?"strikethrough":"default",c["data-testid"]="regular-item-total",s&&(s.amount=(V=e.discountedTotal)==null?void 0:V.value,s.currency=(R=e.discountedTotal)==null?void 0:R.currency,s.sale=!0,s["aria-label"]=i.regularPrice,s["data-testid"]="discount-total")),{subtotalProps:c,subtotalDiscountProps:s}},O=e=>{var p,y;const c=o.get(e.uid),s=e.insufficientQuantity&&e.stockLevel?e.stockLevel==="noNumber"?i.insufficientQuantityGeneral:i.insufficientQuantity.replace("{inventory}",(p=e.stockLevel)==null?void 0:p.toString()).replace("{count}",e.quantity.toString()):void 0,d=e.lowInventory&&e.onlyXLeftInStock&&i.lowInventory.replace("{count}",(y=e.onlyXLeftInStock)==null?void 0:y.toString());return c||s||d||void 0},x=Ae(async(e,c)=>{const s=(d,p)=>Ne([{uid:d.uid,quantity:p}]);if(!(isNaN(c)||e.quantity===c)){b(new Map);try{l(d=>{const p=new Map(d);return p.set(e.uid,{isUpdating:!0,updatedValue:c}),p}),await s(e,c),c===0?a==null||a(e):u==null||u(e,c)}catch(d){l(p=>{const y=new Map(p);return y.delete(e.uid),y}),b(p=>{const y=new Map(p);return y.set(e.uid,d.message),y})}}},[a,u]),S=We(()=>Ue(x,500),[x]);return{showIncludedTaxPrice:h,showExcludingTaxPrice:q,itemsUpdating:n,itemUpdateErrors:o,getConfiguration:$,getPriceProps:M,getSubtotalProps:w,processQuantityChange:x,debouncedQuantityChange:S,setItemsUpdating:l,getWarningMessage:O,setItemUpdateError:(e,c)=>{b(s=>{const d=new Map(s);return c?d.set(e,c):d.delete(e),d})},handleRemoveItem:e=>(l(c=>{const s=new Map(c);return s.set(e.uid,{isUpdating:!0,updatedValue:0}),s}),Ne([{uid:e.uid,quantity:0}]).then(c=>(a==null||a(e),Promise.resolve(c)))),setItemUpdating:(e,c)=>{l(s=>{const d=new Map(s);return d.set(e,{isUpdating:c,updatedValue:c}),d})}}},Ke=({variant:i="primary",className:u,type:a="warning",additionalActions:n,onDismiss:l,heading:o,description:b,icon:g,itemList:h,actionButtonPosition:q,...$})=>{var w,O,x;const M=ae({dismiss:"Dropin.InlineAlert.dismissLabel"});return m("div",{...$,className:E(["dropin-in-line-alert",`dropin-in-line-alert--${a}`,`dropin-in-line-alert--${i}`,u]),children:[m("div",{className:"dropin-in-line-alert__heading",children:[m("div",{className:"dropin-in-line-alert__title-container",children:[g&&t(f,{node:g,className:"dropin-in-line-alert__icon"}),t("span",{className:"dropin-in-line-alert__title",children:o})]}),m("div",{className:"dropin-in-line-alert__actions-container",children:[n&&(q==="top"||!q&&n.length<=1)&&t(Z,{variant:"tertiary",className:"dropin-in-line-alert__additional-action",onClick:n.length>0?(w=n[0])==null?void 0:w.onClick:void 0,"aria-label":(O=n[0])==null?void 0:O.label,children:(x=n[0])==null?void 0:x.label}),l&&t(Z,{icon:t(J,{source:je,size:"24",stroke:"2"}),className:"dropin-in-line-alert__dismiss-button",variant:"tertiary",onClick:l,"aria-label":M.dismiss})]})]}),b&&t("p",{className:"dropin-in-line-alert__description",children:b}),t("div",{className:"dropin-in-line-alert__item-list-container",children:h&&t(f,{node:h,className:E(["dropin-in-line-alert__item-list"])})}),n&&(q==="bottom"||!q&&n.length>1)&&t("div",{className:"dropin-in-line-alert__additional-actions-container",children:n.map(S=>t(Z,{variant:"tertiary",className:"dropin-in-line-alert__additional-action",onClick:S.onClick,children:S.label},S.label))})]})},Ye=()=>t(Ee,{"data-testid":"cart-summary-table-skeleton",className:"cart-cart-summary-table__skeleton",rowGap:"medium",children:t($e,{variant:"row",size:"xlarge",fullWidth:!0,lines:4,multilineGap:"small"})}),ea=({initialData:i=null,routeProduct:u,slots:a,className:n,allowQuantityUpdates:l=!0,allowRemoveItems:o=!0,onQuantityUpdate:b,onItemRemove:g,undo:h=!1,...q})=>{const[$,M]=ee(!i),[w,O]=ee(i),[x,S]=ee([]),v=ae({file:"Cart.CartItem.file",files:"Cart.CartItem.files",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",discountedPrice:"Cart.CartItem.discountedPrice",sender:"Cart.CartItem.sender",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral",outOfStockHeading:"Cart.OutOfStockMessage.heading",outOfStockDescription:"Cart.OutOfStockMessage.message",outOfStockAlert:"Cart.OutOfStockMessage.alert",removeAction:"Cart.OutOfStockMessage.action",notAvailableMessage:"Cart.CartItem.notAvailableMessage",viewMore:"Cart.Cart.viewMore",viewAll:"Cart.Cart.viewAll",discountPercent:"Cart.CartItem.discountPercentage",savingsAmount:"Cart.CartItem.savingsAmount",includingTax:"Cart.CartItem.includingTax",excludingTax:"Cart.CartItem.excludingTax",remove:"Dropin.CartItem.remove.label",removeDefault:"Dropin.CartItem.removeDefault.label",quantity:"Dropin.CartItem.quantity.label",itemBeingRemoved:"Cart.CartItem.itemBeingRemoved",itemRemoved:"Cart.CartItem.itemRemoved",itemRemovedDescription:"Cart.CartItem.itemRemovedDescription",undoAction:"Cart.CartItem.undoAction",dismissAction:"Cart.CartItem.dismissAction"}),{showIncludedTaxPrice:X,showExcludingTaxPrice:B,itemsUpdating:T,itemUpdateErrors:N,getConfiguration:A,getPriceProps:e,getSubtotalProps:c,debouncedQuantityChange:s,setItemsUpdating:d,getWarningMessage:p,handleRemoveItem:y,setItemUpdating:W,setItemUpdateError:z}=Je({dictionary:v,onQuantityUpdate:b,onItemRemove:g});function j(_){const r=ke(),C=r==null?void 0:r.items.find(k=>k.uid===_);C&&S(k=>{const L=r.items.findIndex(H=>H.uid===_);return L!==-1&&!k.some(H=>H.item.uid===_)?(Ie.emit("cart/product/removed",{item:C,index:L}),[...k,{item:C,index:L,loading:!1,error:void 0}]):k})}const G=aa(x,S),Q=ta(S),V=ze(_=>{h&&j(_.uid),y(_)},[h,y]);Ge(()=>{const _=Ie.on("cart/data",r=>{M(!0),O(r),d(new Map),M(!1)},{eager:!0});return()=>{_==null||_.off()}},[M,O,d]);const R=Qe(()=>{var _;return((_=w==null?void 0:w.items)==null?void 0:_.sort((r,C)=>N.has(r.uid)&&!N.has(C.uid)?-1:!N.has(r.uid)&&N.has(C.uid)?1:r.outOfStock&&!C.outOfStock?-1:!r.outOfStock&&C.outOfStock?1:0).map((r,C)=>{var ue,oe,de,me,pe,be,ge,ye,he,_e,Ce,fe;const k=T.has(r.uid),L=p(r),H=t(I,{name:"ProductTitle",slot:a==null?void 0:a.ProductTitle,context:{item:r},children:u?t("a",{href:u(r),children:r.name}):r.name}),te={src:r.image.src,alt:r.image.alt,width:"300",height:"300",params:{width:300}},re=t(De,{"data-testid":`cart-table-item-image-${r.sku}`,loading:C<4?"eager":"lazy",...te}),xe=t(I,{name:"Thumbnail",slot:a==null?void 0:a.Thumbnail,className:"cart-cart-summary-table__item-image-wrapper",context:{item:r,defaultImageProps:{...te,loading:C<4?"eager":"lazy"},index:C},children:u?t("a",{href:u(r),children:re}):re}),we=t(I,{name:"Sku",slot:a==null?void 0:a.Sku,context:{item:r},children:r.sku}),Se=r.outOfStock||a!=null&&a.ItemAlert?t(I,{name:"ItemAlert",slot:a==null?void 0:a.ItemAlert,context:{item:r},children:r.outOfStock&&m("div",{className:"cart-cart-summary-table__item-quantity-alert-wrapper","data-testid":`cart-table-item-quantity-alert-${r.uid}`,children:[t(J,{className:"cart-cart-summary-table__item-quantity-alert-icon",source:Xe,size:"16"}),t("span",{className:"cart-cart-summary-table__item-quantity-alert-text",children:v.outOfStockAlert})]})}):void 0,Te=L||a!=null&&a.ItemWarning?t(I,{name:"ItemWarning",slot:a==null?void 0:a.ItemWarning,context:{item:r},children:L&&m("div",{className:"cart-cart-summary-table__item-quantity-warning-wrapper","data-testid":`cart-table-item-quantity-warning-${r.uid}`,children:[t(J,{className:"cart-cart-summary-table__item-quantity-warning-icon",source:Be,size:"16"}),t("span",{className:"cart-cart-summary-table__item-quantity-warning-text",children:L})]})}):void 0,K=A({item:r}),Pe=K||a!=null&&a.Configurations?t(I,{name:"Configurations",slot:a==null?void 0:a.Configurations,context:{item:r},children:K&&t("ul",{className:"cart-cart-summary-table__item-configurations","data-testid":`cart-table-item-configurations-${r.sku}`,children:Object.entries(K).map(([P,Y])=>m("li",{className:"cart-cart-summary-table__item-configuration","data-testid":`cart-table-item-configuration-${P}`,children:[m("span",{className:"cart-cart-summary-table__item-configuration-label",children:[P,":"]}),t("span",{className:"cart-cart-summary-table__item-configuration-value",children:Y})]},P))})}):void 0,{subtotalProps:qe,subtotalDiscountProps:ne}=c(r),ie=(ue=T.get(r.uid))==null?void 0:ue.updatedValue,ce=k&&!isNaN(ie)?ie:r.quantity,le=P=>{const Y=P.target,Le=parseInt(Y.value,10);s(r,Le)},Me=T.has(r.uid)&&((oe=T.get(r.uid))==null?void 0:oe.updatedValue)===0,Oe=t(I,{name:"Actions",slot:a==null?void 0:a.Actions,context:{item:r,itemsUpdating:T,setItemUpdating:W,setItemUpdateError:z},children:o&&!Me&&t(Z,{variant:"tertiary",size:"medium",className:"cart-cart-summary-table__item-remove-button","data-testid":`cart-table-item-remove-${r.uid}`,icon:t(J,{source:Re,size:"32"}),onClick:()=>V(r),"aria-label":((de=v.remove)==null?void 0:de.replace("{product}",r.name))||v.removeDefault})}),F=x.find(P=>P.index===C);let se;if(h&&F){const P=T.has(F.item.uid)&&((me=T.get(F.item.uid))==null?void 0:me.updatedValue)===0;se=ra(F,r,P,v,G,Q,a)}return{key:r.uid,uid:r.uid,updating:k,hasError:r.outOfStock||N.has(r.uid),item:t(I,{name:"Item",slot:a==null?void 0:a.Item,context:{item:r},children:t(Ze,{productTitle:H,image:xe,sku:we,configurations:Pe,alert:Se,warning:Te})}),price:m(I,{name:"Price",className:"cart-cart-summary-table__item-price",slot:a==null?void 0:a.Price,context:{item:r},children:[t(U,{...e(r)}),X&&m("span",{className:"cart-cart-summary-table__item-price-tax-label",children:[v.includingTax,": ",t(U,{amount:(pe=r.taxedPrice)==null?void 0:pe.value,currency:(be=r.taxedPrice)==null?void 0:be.currency})]}),B&&m("span",{className:"cart-cart-summary-table__item-price-tax-label",children:[v.excludingTax,": ",t(U,{amount:(ge=r.regularPrice)==null?void 0:ge.value,currency:(ye=r.regularPrice)==null?void 0:ye.currency})]})]}),quantity:t(I,{name:"Quantity",className:"cart-cart-summary-table__item-qty",slot:a==null?void 0:a.Quantity,context:{item:r,isUpdating:k,quantityInputValue:ce,handleInputChange:le,itemUpdateErrors:N},children:l?t("input",{id:`cart-table-item-quantity-${r.uid}`,"data-testid":`cart-table-item-quantity-${r.uid}`,type:"number",min:"1",value:ce,disabled:k,"aria-label":v.quantity,className:E(["cart-cart-summary-table__cell-qty-input","cart-cart-summary-table__cell-qty-updater",["cart-cart-summary-table__cell-qty-updater--disabled",k],["cart-cart-summary-table__cell-qty-updater--error",N.has(r.uid)]]),onChange:le}):t("span",{children:r.quantity})}),subtotal:m(I,{name:"Subtotal",className:"cart-cart-summary-table__item-subtotal",slot:a==null?void 0:a.Subtotal,context:{item:r},children:[t(U,{...qe}),ne&&t(U,{...ne}),X&&m("span",{className:"cart-cart-summary-table__item-subtotal-tax-label",children:[v.includingTax,": ",t(U,{amount:(he=r.rowTotalIncludingTax)==null?void 0:he.value,currency:(_e=r.rowTotalIncludingTax)==null?void 0:_e.currency})]}),B&&m("span",{className:"cart-cart-summary-table__item-subtotal-tax-label",children:[v.excludingTax,": ",t(U,{amount:(Ce=r.rowTotal)==null?void 0:Ce.value,currency:(fe=r.rowTotal)==null?void 0:fe.currency})]})]}),actions:Oe,undoBanner:se}}))||[]},[w,T,l,u,a,N,v,A,o,s,p,e,c,W,z,X,B,x,h,G,Q,V]);return $?t(Ye,{}):t(Fe,{entries:R,className:n,...q})};ea.getInitialData=async function(){return ke()};const aa=(i,u)=>async a=>{u(l=>l.map(o=>o.item.uid===a?{...o,error:void 0}:o));const n=i.find(l=>l.item.uid===a);if(n)try{await He([{sku:n.item.sku,parentSku:n.item.topLevelSku,quantity:n.item.quantity,optionsUIDs:n.item.bundleOptionsUIDs||(n.item.selectedOptionsUIDs?Object.values(n.item.selectedOptionsUIDs):void 0),enteredOptions:n.item.customizableOptions?Object.entries(n.item.customizableOptions).map(([l,o])=>({uid:l,value:o})):void 0}]),u(l=>l.filter(o=>o.item.uid!==a))}catch(l){u(o=>o.map(b=>b.item.uid===a?{...b,error:(l==null?void 0:l.message)||"Failed to restore item."}:b))}},ta=i=>u=>{i(a=>a.filter(n=>n.item.uid!==u))},ra=(i,u,a,n,l,o,b)=>{var g,h;return t(I,{name:"UndoBanner",slot:b==null?void 0:b.UndoBanner,context:{item:i.item,loading:a,error:i.error,onUndo:()=>l(i.item.uid),onDismiss:()=>o(i.item.uid)},children:t(Ke,{type:i.error?"error":"info",heading:a?(g=n.itemBeingRemoved)==null?void 0:g.replace("{product}",u.name):(h=n.itemRemoved)==null?void 0:h.replace("{product}",i.item.name),description:i.error||n.itemRemovedDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:a?[]:[{label:n.undoAction,onClick:()=>l(u.uid),"aria-label":`${n.undoAction} remove ${i.item.name}`},{label:n.dismissAction,onClick:()=>o(u.uid),"aria-label":`${n.dismissAction} undo for ${i.item.name}`}]},`undo-banner-${i.item.uid}`)},`undo-banner-${i.item.uid}`)};export{ea as C,ta as a,ra as b,aa as c};
//# sourceMappingURL=CartSummaryTable2.js.map
