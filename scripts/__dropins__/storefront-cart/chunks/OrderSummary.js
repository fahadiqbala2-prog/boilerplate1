/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as N,jsx as r,Fragment as Ge}from"@dropins/tools/preact-jsx-runtime.js";import*as Ee from"@dropins/tools/preact-compat.js";import{useState as Y,useEffect as ae,useCallback as ze}from"@dropins/tools/preact-compat.js";import{VComponent as O,classes as Oe,Slot as ie}from"@dropins/tools/lib.js";import{events as Ne}from"@dropins/tools/event-bus.js";import{g as Ve}from"./persisted-data.js";import{s as Le}from"./resetCart.js";import{g as Ze}from"./getEstimatedTotals.js";import{p as je}from"./acdl.js";import{Accordion as De,AccordionSection as Be,ProgressSpinner as Ue,Divider as Qe,Price as l,Icon as Xe,Button as $e}from"@dropins/tools/components.js";/* empty css                 */import{O as v}from"./OrderSummaryLine.js";import{S as Ae}from"./ChevronDown.js";import{useText as Fe}from"@dropins/tools/i18n.js";import{S as qe}from"./Coupon.js";const We=L=>Ee.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...L},Ee.createElement("path",{d:"M7.74512 14.132L12.0001 9.87701L16.2551 14.132",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),He=({className:L,children:W,variant:P="primary",heading:u,loading:D=!0,subTotal:h,shipping:m,discounts:g,taxTotal:x,taxesApplied:_,total:e,primaryAction:B,coupons:o,giftCards:I,totalSaved:y,updateLineItems:k=T=>T,...t})=>{const[T,A]=Y(!1),i=Fe({checkout:"Cart.PriceSummary.checkout",discountedPrice:"Cart.CartItem.discountedPrice",download:"Cart.CartItem.download",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",orderSummary:"Cart.PriceSummary.orderSummary",taxesBreakdownTitle:"Cart.PriceSummary.taxes.breakdown",taxTotal:"Cart.PriceSummary.taxes.total",taxEstimated:"Cart.PriceSummary.taxes.estimated",taxTotalOnly:"Cart.PriceSummary.taxes.totalOnly",showTaxBreakdown:"Cart.PriceSummary.taxes.showBreakdown",hideTaxBreakdown:"Cart.PriceSummary.taxes.hideBreakdown",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined",subtotalLabel:"Cart.PriceSummary.subTotal.label",subtotalWithTaxes:"Cart.PriceSummary.subTotal.withTaxes",subtotalWithoutTaxes:"Cart.PriceSummary.subTotal.withoutTaxes",totalEstimated:"Cart.PriceSummary.total.estimated",totalLabel:"Cart.PriceSummary.total.label",totalWithoutTax:"Cart.PriceSummary.total.withoutTax",totalSaved:"Cart.PriceSummary.total.saved",shippingLabel:"Cart.PriceSummary.shipping.label",zipPlaceholder:"Cart.PriceSummary.shipping.zipPlaceholder",editZipAction:"Cart.PriceSummary.shipping.editZipAction",shippingWithTaxes:"Cart.PriceSummary.shipping.withTaxes",shippingWithoutTaxes:"Cart.PriceSummary.shipping.withoutTaxes",shippingEstimated:"Cart.PriceSummary.shipping.estimated",shippingEstimatedByState:"Cart.PriceSummary.shipping.alternateField.state",shippingEstimatedByZip:"Cart.PriceSummary.shipping.alternateField.zip",destinationLinkAriaLabel:"Cart.PriceSummary.shipping.destinationLinkAriaLabel",applyButton:"Cart.PriceSummary.estimatedShippingForm.apply.label",countryField:"Cart.PriceSummary.estimatedShippingForm.country.placeholder",freeShipping:"Cart.PriceSummary.freeShipping",stateField:"Cart.PriceSummary.estimatedShippingForm.state.placeholder",zipField:"Cart.PriceSummary.estimatedShippingForm.zip.placeholder"}),w=h&&N(v,{label:i.subtotalLabel,price:h.price,classSuffixes:["subTotal"],children:[h.taxIncluded&&r("div",{"data-testid":"sub-total-tax-caption",className:"cart-order-summary__caption",children:r("span",{children:i.subtotalWithTaxes})}),h.taxExcluded?r("div",{"data-testid":"sub-total-tax-caption-excluded",className:"cart-order-summary__caption",children:N("span",{children:[h.priceExcludingTax,"Â ",i.subtotalWithoutTaxes]})}):void 0]}),E=g&&g.length>0&&r(Ge,{children:g.map(n=>N(v,{label:n.label,price:n.price,classSuffixes:["discount"],children:[n.coupon&&r(O,{node:n.coupon,className:"cart-order-summary__coupon__code"}),n.caption&&r(O,{node:n.caption,className:"cart-order-summary__caption"})]}))}),S=_&&_.length>0?r(De,{"data-testid":"tax-breakdown",className:"cart-order-summary__taxes",iconOpen:Ae,iconClose:We,children:N(Be,{title:i.taxesBreakdownTitle,secondaryText:!T&&x?r(O,{node:x.price,className:"cart-order-summary__price"}):void 0,renderContentWhenClosed:!1,onStateChange:A,children:[r("div",{className:"cart-order-summary__appliedTaxes",children:_.map(n=>r(v,{label:n.label,price:n.price,classSuffixes:["taxEntry"],labelClassSuffix:"muted"}))}),x&&r(v,{label:i.taxTotal,price:x.price,classSuffixes:["taxTotal"],labelClassSuffix:"muted"})]})}):x&&r(v,{label:x.estimated?i.taxEstimated:i.taxTotalOnly,price:x.price,classSuffixes:["taxTotal"],testId:"tax-total-only"}),d=[{key:"subTotalContent",sortOrder:100,content:w},...m?[{key:"shippingContent",sortOrder:200,content:r(O,{node:m,className:"cart-order-summary__shipping"})}]:[],{key:"discountsContent",sortOrder:300,content:E},{key:"taxContent",sortOrder:400,content:S},...e?[{key:"taxContent",sortOrder:500,content:r(v,{label:e.estimated?i.totalEstimated:i.totalLabel,price:e.price,classSuffixes:["total","total--padded"],testId:"total-content",labelClassSuffix:"bold"})}]:[],...e!=null&&e.priceWithoutTax?[{key:"totalWithoutTaxContent",sortOrder:600,content:r(v,{label:i.totalWithoutTax,price:e.priceWithoutTax,classSuffixes:["totalWithoutTax"],testId:"total-without-tax",labelClassSuffix:"muted"})}]:[],...y?[{key:"totalSavedContent",sortOrder:700,content:r(v,{label:i.totalSaved,price:y,classSuffixes:["saved"],testId:"total-saved",labelClassSuffix:"muted"})}]:[],...B?[{key:"primaryActionContent",sortOrder:800,content:r("div",{className:Oe(["cart-order-summary__entry","cart-order-summary__primaryAction"]),children:B})}]:[],...o?[{key:"couponsContent",sortOrder:900,content:r(O,{node:o,className:"cart-order-summary__coupons"})}]:[],...I?[{key:"giftCardsContent",sortOrder:1e3,content:r(O,{node:I,className:"cart-order-summary__gift-cards"})}]:[]],p=k(d).sort((n,C)=>n.sortOrder-C.sortOrder);return N("div",{...t,className:Oe(["cart-order-summary",["cart-order-summary--loading",D],[`cart-order-summary__${P}`,P],L]),children:[D&&r(Ue,{className:"cart-order-summary__spinner"}),N("div",{className:"cart-order-summary__heading",children:[u&&r(O,{node:u,className:"cart-order-summary__heading-text"}),r(Qe,{variant:"primary",className:"cart-order-summary__divider-primary"})]}),r("div",{className:"cart-order-summary__content",children:p.map(n=>Array.isArray(n.content)?r(De,{className:n.className,actionIconPosition:"right",iconOpen:Ae,iconClose:We,children:r(Be,{defaultOpen:!1,title:n.title,renderContentWhenClosed:!1,children:n.content.map(C=>C.content)})}):n.content)})]})},Re=()=>{const[L,W]=Y(!1),[P,u]=Y();return{handleEstimateTotals:(h,m)=>{W(!0);const{shippingCountry:g,shippingState:x="",shippingStateId:_,shippingZip:e=""}=h,B={countryCode:g,postcode:e,region:{region:x,id:_},shipping_method:{carrier_code:(m==null?void 0:m.carrier_code)||"",method_code:(m==null?void 0:m.method_code)||""}};Ze(B).then(o=>{var I,y,k,t,T,A,i,w,E,S,d,p,n,C,M,ee,F,G,z,V;o&&u({estimatedTaxTotal:{amount:(I=o.totalTax)==null?void 0:I.value,currency:(y=o.totalTax)==null?void 0:y.currency},estimatedSubTotal:{excludingTax:{amount:(t=(k=o.subtotal)==null?void 0:k.excludingTax)==null?void 0:t.value,currency:(A=(T=o.subtotal)==null?void 0:T.excludingTax)==null?void 0:A.currency},includingTax:{amount:(w=(i=o.subtotal)==null?void 0:i.includingTax)==null?void 0:w.value,currency:(S=(E=o.subtotal)==null?void 0:E.includingTax)==null?void 0:S.currency},includingDiscountOnly:{amount:(p=(d=o.subtotal)==null?void 0:d.includingDiscountOnly)==null?void 0:p.value,currency:(C=(n=o.subtotal)==null?void 0:n.includingDiscountOnly)==null?void 0:C.currency}},estimatedGrandTotalPrice:{includingTax:{amount:(M=o.total)==null?void 0:M.includingTax.value,currency:(ee=o.total)==null?void 0:ee.includingTax.currency},excludingTax:{amount:(F=o.total)==null?void 0:F.excludingTax.value,currency:(G=o.total)==null?void 0:G.excludingTax.currency}},estimatedAppliedTaxes:{taxes:(z=o.appliedTaxes)==null?void 0:z.map(s=>{var b,f;return{label:s.label,amount:{value:(b=s.amount)==null?void 0:b.value,currency:(f=s.amount)==null?void 0:f.currency}}})},estimatedItems:{items:(V=o.items)==null?void 0:V.map(s=>{var b,f,Z,j,U,Q,X,$,q,H;return{uid:s.uid,price:{amount:(b=s.price)==null?void 0:b.value,currency:(f=s.price)==null?void 0:f.currency},taxedPrice:{amount:(Z=s.taxedPrice)==null?void 0:Z.value,currency:(j=s.taxedPrice)==null?void 0:j.currency},rowTotal:{amount:(U=s.rowTotal)==null?void 0:U.value,currency:(Q=s.rowTotal)==null?void 0:Q.currency},rowTotalIncludingTax:{amount:(X=s.rowTotalIncludingTax)==null?void 0:X.value,currency:($=s.rowTotalIncludingTax)==null?void 0:$.currency},regularPrice:{amount:(q=s.regularPrice)==null?void 0:q.value,currency:(H=s.regularPrice)==null?void 0:H.currency}}})}})}).finally(()=>{W(!1)})},estimatedTotals:P,setEstimatedTotals:u,loading:L}},Je=({children:L,initialData:W=null,routeCheckout:P,slots:u,errors:D,showTotalSaved:h,enableCoupons:m,enableGiftCards:g,updateLineItems:x=e=>e,..._})=>{var F,G,z,V,s,b,f,Z,j,U,Q,X,$,q,H,ne,ce,oe,ue,se,le,me,de,xe,pe,he,ge,ye,Te,Se,Ce,be,fe,ve,Pe,_e;const[e,B]=Y(W),[o,I]=Y(!1),y=e==null?void 0:e.isVirtual;m=m??!0,g=g??!0;const{handleEstimateTotals:k,estimatedTotals:t,setEstimatedTotals:T,loading:A}=Re(),i=(F=Le.config)==null?void 0:F.shoppingCartDisplaySetting,w=(i==null?void 0:i.subtotal)==="INCLUDING_TAX",E=(i==null?void 0:i.subtotal)==="INCLUDING_EXCLUDING_TAX",S=i==null?void 0:i.zeroTax;ae(()=>{const c=Ne.on("cart/data",a=>{var R,J,K;B(a);const te=(R=a==null?void 0:a.addresses)==null?void 0:R.shipping,re=a==null?void 0:a.isVirtual;(te||re)&&T(null),t==null&&T({estimatedTaxTotal:{amount:(J=a==null?void 0:a.totalTax)==null?void 0:J.value,currency:(K=a==null?void 0:a.totalTax)==null?void 0:K.currency}})},{eager:!0});return()=>{c==null||c.off()}},[]),ae(()=>{I(D)},[D]),ae(()=>{const c=Ne.on("shipping/estimate",a=>{var R,J,K,Ie,ke,we;const te={shippingCountry:(R=a==null?void 0:a.address)==null?void 0:R.countryCode,shippingState:(J=a==null?void 0:a.address)==null?void 0:J.region,shippingStateId:(K=a==null?void 0:a.address)==null?void 0:K.regionId,shippingZip:(Ie=a==null?void 0:a.address)==null?void 0:Ie.postCode},re={carrier_code:((ke=a==null?void 0:a.shippingMethod)==null?void 0:ke.carrierCode)||"",method_code:((we=a==null?void 0:a.shippingMethod)==null?void 0:we.methodCode)||""};k(te,re)});return()=>{c==null||c.off()}},[k]);const d=Fe({checkout:"Cart.PriceSummary.checkout",free:"Cart.PriceSummary.total.free",orderSummary:"Cart.PriceSummary.orderSummary",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined"}),p=(e==null?void 0:e.hasOutOfStockItems)||o,n=ze(()=>{!p&&e&&je(e,Le.locale)},[p,e]),C=!y&&(u!=null&&u.EstimateShipping)?r(ie,{name:"EstimateShipping",slot:u.EstimateShipping},"estimateShippingId"):void 0;if(!Object.keys(e??{}).length||(e==null?void 0:e.totalQuantity)===0)return null;const M=m&&(u!=null&&u.Coupons)?r(ie,{name:"Coupons",slot:u.Coupons},"couponsId"):void 0,ee=g&&(u!=null&&u.GiftCards)?r(ie,{name:"GiftCards",slot:u.GiftCards},"giftCardId"):void 0;return r(He,{..._,"data-testid":"cart-order-summary",heading:r("div",{children:d.orderSummary}),shipping:C,coupons:M,giftCards:ee,loading:A,updateLineItems:x,subTotal:{taxIncluded:w&&!S,taxExcluded:E,zeroTaxSubtotal:S,priceExcludingTax:(G=t==null?void 0:t.estimatedSubTotal)!=null&&G.excludingTax?r(l,{"data-testid":"subtotal",...(z=t==null?void 0:t.estimatedSubTotal)==null?void 0:z.excludingTax}):r(l,{"data-testid":"subtotal",amount:(s=(V=e==null?void 0:e.subtotal)==null?void 0:V.excludingTax)==null?void 0:s.value,currency:(f=(b=e==null?void 0:e.subtotal)==null?void 0:b.excludingTax)==null?void 0:f.currency}),price:!S&&w||!S&&E?(Z=t==null?void 0:t.estimatedSubTotal)!=null&&Z.includingTax?r(l,{"data-testid":"subtotal",...(j=t==null?void 0:t.estimatedSubTotal)==null?void 0:j.includingTax}):r(l,{"data-testid":"subtotal",amount:(U=e==null?void 0:e.subtotal.includingTax)==null?void 0:U.value,currency:(Q=e==null?void 0:e.subtotal.includingTax)==null?void 0:Q.currency}):r(l,{"data-testid":"subtotal",amount:($=(X=e==null?void 0:e.subtotal)==null?void 0:X.excludingTax)==null?void 0:$.value,currency:(H=(q=e==null?void 0:e.subtotal)==null?void 0:q.excludingTax)==null?void 0:H.currency})},discounts:(ne=e==null?void 0:e.appliedDiscounts)==null?void 0:ne.map(c=>{var a;return{label:c.label,price:r(l,{"data-testid":"summary-discount-total",amount:-c.amount.value,currency:c.amount.currency,sale:!0}),coupon:c!=null&&c.coupon?N("span",{children:[r(Xe,{source:qe,size:"16"}),(a=c==null?void 0:c.coupon)==null?void 0:a.code]}):void 0}}),taxTotal:y||t&&t.estimatedTaxTotal==null?{price:r("span",{"data-testid":"tax-total-tbd",children:d.taxToBeDetermined})}:{price:t!=null&&t.estimatedTaxTotal?r(l,{"data-testid":"tax-total-estimated",...t==null?void 0:t.estimatedTaxTotal}):r(l,{"data-testid":"tax-total-actual",amount:(ce=e==null?void 0:e.totalTax)==null?void 0:ce.value,currency:(oe=e==null?void 0:e.totalTax)==null?void 0:oe.currency}),estimated:(!t||!t.estimatedTaxTotal)&&!((ue=e==null?void 0:e.addresses)!=null&&ue.shipping)},taxesApplied:y?void 0:i!=null&&i.fullSummary?(le=((se=t==null?void 0:t.estimatedAppliedTaxes)==null?void 0:se.taxes)||(e==null?void 0:e.appliedTaxes))==null?void 0:le.map(c=>({label:c.label,price:r(l,{"data-testid":"applied-taxes",amount:c.amount.value,currency:c.amount.currency})})):void 0,total:{price:t!=null&&t.estimatedGrandTotalPrice?((de=(me=t==null?void 0:t.estimatedGrandTotalPrice)==null?void 0:me.includingTax)==null?void 0:de.amount)===0?r("span",{"data-testid":"total-including-tax",children:d.free}):r(l,{"data-testid":"total-including-tax-estimated",...(xe=t==null?void 0:t.estimatedGrandTotalPrice)==null?void 0:xe.includingTax}):((pe=e==null?void 0:e.total)==null?void 0:pe.includingTax.value)===0?r("span",{"data-testid":"total-including-tax",children:d.free}):r(l,{"data-testid":"total-including-tax-actual",amount:(he=e==null?void 0:e.total)==null?void 0:he.includingTax.value,currency:(ge=e==null?void 0:e.total)==null?void 0:ge.includingTax.currency}),estimated:(!t||!!(t!=null&&t.estimatedTaxTotal))&&!((ye=e==null?void 0:e.addresses)!=null&&ye.shipping),priceWithoutTax:i!=null&&i.grandTotal?t!=null&&t.estimatedAppliedTaxes?((Se=(Te=t==null?void 0:t.estimatedGrandTotalPrice)==null?void 0:Te.excludingTax)==null?void 0:Se.amount)===0?r("span",{"data-testid":"total-excluding-tax",children:d.free}):r(l,{"data-testid":"total-excluding-tax",...(Ce=t==null?void 0:t.estimatedGrandTotalPrice)==null?void 0:Ce.excludingTax}):((be=e==null?void 0:e.total)==null?void 0:be.excludingTax.value)===0?r("span",{"data-testid":"total-excluding-tax",children:d.free}):r(l,{"data-testid":"total-excluding-tax",amount:(fe=e==null?void 0:e.total)==null?void 0:fe.excludingTax.value,currency:(ve=e==null?void 0:e.total)==null?void 0:ve.excludingTax.currency}):void 0},primaryAction:P&&r($e,{"data-testid":"checkout-button",variant:"primary",disabled:p,"aria-disabled":p,href:p?void 0:P({cartId:e.id}),onClick:n,children:d.checkout}),totalSaved:h?r(l,{amount:(Pe=e==null?void 0:e.discount)==null?void 0:Pe.value,currency:(_e=e==null?void 0:e.total)==null?void 0:_e.includingTax.currency}):void 0})};Je.getInitialData=async function(){return Ve()};export{Je as O};
