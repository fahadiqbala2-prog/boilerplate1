/*! Copyright 2025 Adobe
All Rights Reserved. */
import{FetchGraphQL as i}from"@dropins/tools/fetch-graphql.js";import"@dropins/tools/event-bus.js";import{g as c}from"./persisted-data.js";function u(e){const r=document.cookie.split(";");for(let a=0;a<r.length;a++){const o=r[a].trim();if(o.indexOf(`${e}=`)===0)return o.substring(e.length+1)}return null}const d=(()=>{const e=c();return{cartId:null,authenticated:e?!e.isGuestCart:!1}})(),s=new Proxy(d,{set(e,r,a){var o;if(e[r]=a,r==="cartId"){if(a===s.cartId)return!0;if(a===null)return document.cookie="DROPIN__CART__CART-ID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",!0;const t=(o=s.config)==null?void 0:o.cartExpiresInDays;t||console.warn('Missing "expiresInDays" config. Cookie expiration will default to 30 days.');const n=new Date;n.setDate(n.getDate()+(t??30)),document.cookie=`DROPIN__CART__CART-ID=${a}; expires=${n.toUTCString()}; path=/`}return!0},get(e,r){return r==="cartId"?u("DROPIN__CART__CART-ID"):e[r]}}),{setEndpoint:g,setFetchGraphQlHeader:C,removeFetchGraphQlHeader:_,setFetchGraphQlHeaders:I,fetchGraphQl:m,getConfig:D}=new i().getMethods(),T=e=>{const r=e.findIndex(({extensions:t})=>(t==null?void 0:t.category)==="graphql-authorization")>-1,a=e.findIndex(({path:t,extensions:n})=>(n==null?void 0:n.category)==="graphql-no-such-entity"&&!(t!=null&&t.includes("applyCouponsToCart")))>-1,o=e.map(t=>t.message).join(" ");if(r||a)return h(),["auth_dropin_user_token","auth_dropin_firstname"].forEach(t=>{document.cookie=`${t}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}),console.error(o),null;throw Error(o)},h=()=>(s.cartId=null,s.authenticated=!1,Promise.resolve(null));export{g as a,C as b,I as c,h as d,m as f,D as g,T as h,_ as r,s};
