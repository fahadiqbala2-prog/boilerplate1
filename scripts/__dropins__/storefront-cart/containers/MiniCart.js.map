{"version":3,"file":"MiniCart.js","sources":["../../src/components/MiniCart/MiniCart.tsx","../../src/containers/MiniCart/MiniCart.tsx"],"sourcesContent":["import { FunctionComponent, VNode } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\nimport { VComponent, classes } from '@adobe/elsie/lib';\nimport { Divider } from '@adobe/elsie/components';\nimport { useText } from '@adobe/elsie/i18n';\n\nimport '@/cart/components/MiniCart/MiniCart.css';\n\nexport interface MiniCartProps extends HTMLAttributes<HTMLDivElement> {\n  emptyCart: VNode;\n  heading?: VNode;\n  products?: VNode;\n  estimatedTotal?: VNode;\n  ctas?: VNode;\n}\n\nexport const MiniCart: FunctionComponent<MiniCartProps> = ({\n  className,\n  children,\n  emptyCart,\n  heading,\n  products,\n  estimatedTotal,\n  ctas,\n  ...props\n}) => {\n  const dictionary = useText({\n    estimatedTotal: 'Cart.MiniCart.estimatedTotal',\n  });\n\n  return (\n    <div {...props} className={classes(['cart-mini-cart', className])}>\n      {/* Heading */}\n      {products && heading && (\n        <div className=\"cart-mini-cart__heading\">\n          <VComponent node={heading} className=\"cart-mini-cart__heading-text\" />\n\n          <Divider\n            variant=\"primary\"\n            className=\"cart-mini-cart__heading-divider\"\n          />\n        </div>\n      )}\n\n      {/* Content */}\n      {products ? (\n        <>\n          <div className=\"cart-mini-cart__products\">{products}</div>\n\n          <div className=\"cart-mini-cart__footer\">\n            {estimatedTotal && (\n              <div className=\"cart-mini-cart__footer__estimated-total\">\n                {dictionary.estimatedTotal}\n                <VComponent node={estimatedTotal} />\n              </div>\n            )}\n\n            {ctas && (\n              <VComponent\n                node={ctas}\n                className=\"cart-mini-cart__footer__ctas\"\n              />\n            )}\n          </div>\n        </>\n      ) : (\n        <VComponent node={emptyCart} className=\"cart-mini-cart__empty-cart\" />\n      )}\n    </div>\n  );\n};\n","import { HTMLAttributes, useEffect, useState } from 'preact/compat';\nimport { Container } from '@adobe/elsie/lib';\nimport { CartModel } from '@/cart/data/models';\nimport { getPersistedData } from '@/cart/lib/persisted-data';\nimport { events } from '@adobe/event-bus';\nimport { EmptyCart, MiniCart as MiniCartComponent } from '@/cart/components';\nimport { useText } from '@adobe/elsie/i18n';\nimport {\n  Button,\n  CartItem,\n  CartList,\n  Image,\n  Price,\n} from '@adobe/elsie/components';\nimport { updateProductsFromCart } from '@/cart/api';\nimport { publishShoppingCartViewEvent } from '@/cart/lib/acdl';\nimport { state } from '@/cart/lib/state';\n\nexport interface MiniCartProps extends HTMLAttributes<HTMLDivElement> {\n  routeProduct?: (item: CartModel['items'][0]) => string;\n  routeCart?: () => string;\n  routeCheckout?: () => string;\n  routeEmptyCartCTA?: () => string;\n}\n\nexport const MiniCart: Container<MiniCartProps, CartModel | null> = ({\n  children,\n  initialData = null,\n  routeProduct,\n  routeCart,\n  routeCheckout,\n  routeEmptyCartCTA,\n  ...props\n}) => {\n  const [data, setData] = useState<CartModel | null>(initialData);\n  const [itemsLoading, setItemLoading] = useState<Set<string>>(new Set());\n\n  const handleItemsLoading = (state: boolean, uid: string) => {\n    setItemLoading((prev) => {\n      state ? prev.add(uid) : prev.delete(uid);\n      return new Set(prev);\n    });\n  };\n\n  useEffect(() => {\n    const event = events.on(\n      'cart/data',\n      (payload) => {\n        setData(payload);\n      },\n      { eager: true }\n    );\n\n    return () => {\n      event?.off();\n    };\n  }, []);\n\n  const dictionary = useText({\n    cartLink: 'Cart.MiniCart.cartLink',\n    checkoutLink: 'Cart.MiniCart.checkoutLink',\n    discountedPrice: 'Cart.CartItem.discountedPrice',\n    heading: 'Cart.MiniCart.heading',\n    message: 'Cart.CartItem.message',\n    recipient: 'Cart.CartItem.recipient',\n    regularPrice: 'Cart.CartItem.regularPrice',\n    sender: 'Cart.CartItem.sender',\n    file: 'Cart.CartItem.file',\n    files: 'Cart.CartItem.files',\n  });\n\n  const handleItemQuantityUpdate = (uid: string, quantity: number) => {\n    handleItemsLoading(true, uid);\n\n    updateProductsFromCart([{ uid, quantity }]).finally(() => {\n      handleItemsLoading(false, uid);\n    });\n  };\n\n  // Publish shopping cart view event only once when the component is mounted and initialData is available\n  useEffect(() => {\n    if (initialData && Object.keys(initialData).length > 0) {\n      publishShoppingCartViewEvent(initialData, state.locale || 'en-US');\n    }\n  }, [initialData]);\n\n  return (\n    <MiniCartComponent\n      {...props}\n      heading={\n        <div>\n          {dictionary.heading.replace(\n            '{count}',\n            (data?.totalQuantity ?? 0).toString()\n          )}\n        </div>\n      }\n      emptyCart={<EmptyCart ctaLinkURL={routeEmptyCartCTA?.()} />}\n      estimatedTotal={\n        data?.total && (\n          <Price\n            amount={data?.total.value}\n            currency={data?.total.currency}\n            style={{ font: 'inherit' }}\n          />\n        )\n      }\n      ctas={\n        <div>\n          {routeCheckout && (\n            <Button variant=\"primary\" href={routeCheckout()}>\n              {dictionary.checkoutLink}\n            </Button>\n          )}\n          {routeCart && (\n            <Button variant=\"tertiary\" href={routeCart()}>\n              {dictionary.cartLink}\n            </Button>\n          )}\n        </div>\n      }\n      products={\n        data?.totalQuantity ?? 0 ? (\n          <CartList>\n            {data?.miniCartMaxItems?.map((item, index) => {\n              const isLoading = itemsLoading.has(item.uid);\n\n              const configurations = {\n                ...(item.selectedOptions ?? {}),\n                ...(item.recipient\n                  ? { [dictionary.recipient]: item.recipient }\n                  : {}),\n                ...(item.recipientEmail && item.recipient\n                  ? {\n                      [dictionary.recipient]: `${item.recipient} (${item.recipientEmail})`,\n                    }\n                  : {}),\n                ...(item.sender ? { [dictionary.sender]: item.sender } : {}),\n                ...(item.senderEmail && item.sender\n                  ? {\n                      [dictionary.sender]: `${item.sender} (${item.senderEmail})`,\n                    }\n                  : {}),\n                ...(item.message ? { [dictionary.message]: item.message } : {}),\n                ...(item.links && item.links.count\n                  ? item.links.count > 1\n                    ? {\n                        [dictionary.files.replace(\n                          '{count}',\n                          item.links.count.toString()\n                        )]: item.links.result,\n                      }\n                    : {\n                        [dictionary.file.replace(\n                          '{count}',\n                          item.links.count.toString()\n                        )]: item.links.result,\n                      }\n                  : {}),\n              };\n\n              return (\n                <CartItem\n                  data-testid=\"cart-item\"\n                  key={item.uid}\n                  updating={isLoading}\n                  image={\n                    routeProduct ? (\n                      <a href={routeProduct(item)}>\n                        <Image\n                          loading={index < 4 ? 'eager' : 'lazy'}\n                          src={item.image.src}\n                          alt={item.image.alt}\n                          width=\"300\"\n                          height=\"300\"\n                          params={{ width: 300 }}\n                        />\n                      </a>\n                    ) : (\n                      <Image\n                        loading={index < 4 ? 'eager' : 'lazy'}\n                        src={item.image.src}\n                        alt={item.image.alt}\n                        width=\"300\"\n                        height=\"300\"\n                        params={{ width: 300 }}\n                      />\n                    )\n                  }\n                  title={\n                    <span>\n                      {routeProduct ? (\n                        <a href={routeProduct(item)}>{item.name}</a>\n                      ) : (\n                        item.name\n                      )}\n                    </span>\n                  }\n                  sku={<span>{item.sku}</span>}\n                  configurations={\n                    Object.keys(configurations).length > 0\n                      ? configurations\n                      : undefined\n                  }\n                  quantity={item.quantity}\n                  price={\n                    <Price\n                      amount={item.regularPrice?.value}\n                      currency={item.regularPrice?.currency}\n                      weight=\"normal\"\n                    />\n                  }\n                  total={\n                    <>\n                      <Price\n                        amount={item.total.value}\n                        currency={item.total.currency}\n                        variant={item.discounted ? 'strikethrough' : 'default'}\n                        data-testid=\"regular-total\"\n                        aria-label={dictionary.regularPrice}\n                      />\n\n                      {item.discounted && (\n                        <Price\n                          amount={item.discountedTotal?.value}\n                          currency={item.discountedTotal?.currency}\n                          sale={item.discounted}\n                          data-testid=\"discount-total\"\n                          aria-label={dictionary.discountedPrice}\n                        />\n                      )}\n                    </>\n                  }\n                  onRemove={() => {\n                    handleItemQuantityUpdate(item.uid, 0);\n                  }}\n                />\n              );\n            })}\n          </CartList>\n        ) : undefined\n      }\n    />\n  );\n};\n\nMiniCart.getInitialData = async function () {\n  return getPersistedData();\n};\n"],"names":["MiniCart","className","children","emptyCart","heading","products","estimatedTotal","ctas","props","dictionary","useText","_jsxs","classes","_jsx","VComponent","node","Divider","variant","_Fragment","initialData","routeProduct","routeCart","routeCheckout","routeEmptyCartCTA","data","setData","useState","itemsLoading","setItemLoading","Set","handleItemsLoading","state","uid","prev","add","delete","useEffect","event","events","on","payload","eager","off","cartLink","checkoutLink","discountedPrice","message","recipient","regularPrice","sender","file","files","handleItemQuantityUpdate","quantity","updateProductsFromCart","finally","Object","keys","length","locale","MiniCartComponent","replace","totalQuantity","toString","EmptyCart","ctaLinkURL","total","Price","amount","value","currency","style","font","Button","href","CartList","miniCartMaxItems","map","item","index","isLoading","has","configurations","selectedOptions","recipientEmail","senderEmail","links","count","result","CartItem","updating","image","Image","loading","src","alt","width","height","params","title","name","sku","undefined","price","weight","discounted","discountedTotal","sale","onRemove","getInitialData","getPersistedData"],"mappings":"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"}