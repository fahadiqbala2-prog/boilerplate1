import{useState as N,useEffect as P}from"@dropins/tools/preact-compat.js";import{s as E,n as O}from"../chunks/getStoreConfig__DjEej2Iar8.js";import{events as Q}from"@dropins/tools/event-bus.js";import{D as U,E as V,P as g,B as w,C as q,e as z,I as S}from"../chunks/MiniCart__DhyeGlECaM.js";import{jsxs as i,jsx as a,Fragment as M}from"@dropins/tools/preact-jsx-runtime.js";import{u as b,c as B,V as m}from"../chunks/UIProvider__KplsarDn2b.js";import{b as F,u as R}from"../chunks/updateProductsFromCart__BYHNUQqslq.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact-hooks.js";import"@dropins/tools/components/Icon.js";import"@dropins/tools/preact.js";const T=({className:f,children:c,emptyCart:s,heading:d,products:l,estimatedTotal:o,ctas:h,...r})=>{const p=b({estimatedTotal:"Cart.MiniCart.estimatedTotal"});return i("div",{...r,className:B(["cart-mini-cart",f]),children:[l&&d&&i("div",{className:"cart-mini-cart__heading",children:[a(m,{node:d,className:"cart-mini-cart__heading-text"}),a(U,{variant:"primary",className:"cart-mini-cart__heading-divider"})]}),l?i(M,{children:[a("div",{className:"cart-mini-cart__products",children:l}),i("div",{className:"cart-mini-cart__footer",children:[o&&i("div",{className:"cart-mini-cart__footer__estimated-total",children:[p.estimatedTotal,a(m,{node:o})]}),h&&a(m,{node:h,className:"cart-mini-cart__footer__ctas"})]})]}):a(m,{node:s,className:"cart-mini-cart__empty-cart"})]})},D=({children:f,initialData:c=null,routeProduct:s,routeCart:d,routeCheckout:l,routeEmptyCartCTA:o,...h})=>{var C;const[r,p]=N(c),[x,$]=N(new Set),y=(e,n)=>{$(u=>(e?u.add(n):u.delete(n),new Set(u)))};P(()=>{const e=Q.on("cart/data",n=>{p(n)},{eager:!0});return()=>{e==null||e.off()}},[]);const t=b({cartLink:"Cart.MiniCart.cartLink",checkoutLink:"Cart.MiniCart.checkoutLink",discountedPrice:"Cart.CartItem.discountedPrice",heading:"Cart.MiniCart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files"}),j=(e,n)=>{y(!0,e),R([{uid:e,quantity:n}]).finally(()=>{y(!1,e)})};return P(()=>{c&&Object.keys(c).length>0&&F(c,E.locale||"en-US")},[c]),a(T,{...h,heading:a("div",{children:t.heading.replace("{count}",((r==null?void 0:r.totalQuantity)??0).toString())}),emptyCart:a(V,{ctaLinkURL:o==null?void 0:o()}),estimatedTotal:(r==null?void 0:r.total)&&a(g,{amount:r==null?void 0:r.total.value,currency:r==null?void 0:r.total.currency,style:{font:"inherit"}}),ctas:i("div",{children:[l&&a(w,{variant:"primary",href:l(),children:t.checkoutLink}),d&&a(w,{variant:"tertiary",href:d(),children:t.cartLink})]}),products:(r==null?void 0:r.totalQuantity)??0?a(q,{children:(C=r==null?void 0:r.miniCartMaxItems)==null?void 0:C.map((e,n)=>{var _,v,I,L;const u=x.has(e.uid),k={...e.selectedOptions??{},...e.recipient?{[t.recipient]:e.recipient}:{},...e.recipientEmail&&e.recipient?{[t.recipient]:`${e.recipient} (${e.recipientEmail})`}:{},...e.sender?{[t.sender]:e.sender}:{},...e.senderEmail&&e.sender?{[t.sender]:`${e.sender} (${e.senderEmail})`}:{},...e.message?{[t.message]:e.message}:{},...e.links&&e.links.count?e.links.count>1?{[t.files.replace("{count}",e.links.count.toString())]:e.links.result}:{[t.file.replace("{count}",e.links.count.toString())]:e.links.result}:{}};return a(z,{"data-testid":"cart-item",updating:u,image:s?a("a",{href:s(e),children:a(S,{loading:n<4?"eager":"lazy",src:e.image.src,alt:e.image.alt,width:"300",height:"300",params:{width:300}})}):a(S,{loading:n<4?"eager":"lazy",src:e.image.src,alt:e.image.alt,width:"300",height:"300",params:{width:300}}),title:a("span",{children:s?a("a",{href:s(e),children:e.name}):e.name}),sku:a("span",{children:e.sku}),configurations:Object.keys(k).length>0?k:void 0,quantity:e.quantity,price:a(g,{amount:(_=e.regularPrice)==null?void 0:_.value,currency:(v=e.regularPrice)==null?void 0:v.currency,weight:"normal"}),total:i(M,{children:[a(g,{amount:e.total.value,currency:e.total.currency,variant:e.discounted?"strikethrough":"default","data-testid":"regular-total","aria-label":t.regularPrice}),e.discounted&&a(g,{amount:(I=e.discountedTotal)==null?void 0:I.value,currency:(L=e.discountedTotal)==null?void 0:L.currency,sale:e.discounted,"data-testid":"discount-total","aria-label":t.discountedPrice})]}),onRemove:()=>{j(e.uid,0)}},e.uid)})}):void 0})};D.getInitialData=async function(){return O()};export{D as MiniCart,D as default};
//# sourceMappingURL=MiniCart.js.map
