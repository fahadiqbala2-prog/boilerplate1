/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as G,jsx as a}from"@dropins/tools/preact-jsx-runtime.js";import*as f from"@dropins/tools/preact-compat.js";import{useState as p,useEffect as u}from"@dropins/tools/preact-compat.js";import"@dropins/tools/lib.js";import{Tag as L,Icon as b,Input as M,Button as x}from"@dropins/tools/components.js";/* empty css                         */import{S as E,C as A}from"../chunks/Coupons.js";import"../chunks/resetCart.js";import{events as P}from"@dropins/tools/event-bus.js";import{a as T,r as B}from"../chunks/removeGiftCardFromCart.js";import{useText as R}from"@dropins/tools/i18n.js";import"../chunks/Coupon.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/persisted-data.js";import"../chunks/refreshCart.js";import"../fragments.js";import"../chunks/acdl.js";const V=m=>f.createElement("svg",{width:24,height:16,viewBox:"0 0 24 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...m},f.createElement("path",{d:"M22.5364 9.8598V2.1658C22.5364 1.63583 22.099 1.20996 21.576 1.20996H2.42337C1.89083 1.20996 1.46289 1.64529 1.46289 2.1658V9.8598M22.5364 9.8598H1.46289M22.5364 9.8598V13.844C22.5364 14.3645 22.1085 14.7999 21.576 14.7999H2.42337C1.90034 14.7999 1.46289 14.374 1.46289 13.844V9.8598M3.9164 12.5191L7.5396 9.8598M7.5396 9.8598L11.1628 12.5191M7.5396 9.8598C7.5396 9.8598 6.96902 7.26674 6.40795 6.70838C5.84687 6.15002 4.93394 6.15002 4.37287 6.70838C3.81179 7.26674 3.81179 8.17526 4.37287 8.73362C4.93394 9.29198 7.5396 9.8598 7.5396 9.8598ZM7.5396 9.8598C7.5396 9.8598 10.1643 9.27305 10.7254 8.71469C11.2864 8.15633 11.2864 7.24782 10.7254 6.68946C10.1643 6.1311 9.25135 6.1311 8.69028 6.68946C8.12921 7.24782 7.5396 9.8598 7.5396 9.8598ZM7.5396 14.7904V1.20996",stroke:"currentColor",strokeLinecap:"round"})),U=({children:m,...g})=>{const[l,d]=p(new Set),[s,C]=p([]),[c,o]=p(new Set),i=R({giftCardTitle:"Cart.PriceSummary.giftCard.title",applyButton:"Cart.PriceSummary.giftCard.applyAction",placeholder:"Cart.PriceSummary.giftCard.placeholder",ariaLabel:"Cart.PriceSummary.giftCard.ariaLabel",ariaLabelRemove:"Cart.PriceSummary.giftCard.ariaLabelRemove",empty:"Cart.PriceSummary.giftCard.errors.empty"}),S=async r=>{const e=r==null?void 0:r.giftCardCode;if(e==="")return o(new Set([i.empty])),!0;const t=new Set(l);t.add(e),o(new Set),T(e).then(n=>{if(n===null)throw new Error("Error adding gift card code");d(t)}).catch(n=>{console.warn(n),o(new Set([n.message]))})},w=r=>{const e=new Set(l);e.delete(r),o(new Set),B(r).then(t=>{if(t===null)throw new Error("Error removing gift card code");d(e)}).catch(t=>{console.warn(t),o(new Set([t.message]))})};u(()=>{const r=P.on("cart/data",e=>{const t=e==null?void 0:e.appliedGiftCards;if(!t){C([]),o(new Set);return}const n=t.map(({code:v})=>v);C(n),o(new Set)},{eager:!0});return()=>{r==null||r.off()}},[]),u(()=>{d(new Set(s))},[s]);const h=s.map((r,e)=>G(L,{className:"coupon-code-form__applied-item",children:[a("span",{children:r}),a("button",{"aria-label":`${i.ariaLabelRemove} ${r}`,onClick:()=>w(r),"data-testid":`remove-giftcard-${e+1}`,children:a(b,{source:E,size:"16"})})]},r)),y=c.size>0?a("div",{"data-testid":"giftcard-code-error",children:Array.from(c)[0]}):void 0;return a(A,{...g,className:"cart-gift-cards",accordionSectionTitle:i.giftCardTitle,accordionSectionIcon:V,couponCodeField:a(M,{"aria-label":i.ariaLabel,type:"text",placeholder:i.placeholder,name:"giftCardCode",variant:"primary",value:"","data-testid":"giftcard-code-input",maxLength:50,error:c.size>0}),applyCouponsButton:a(x,{variant:"secondary",children:i.applyButton}),error:y,appliedCoupons:a("div",{children:h}),onApplyCoupon:S})};export{U as GiftCards,U as default};
