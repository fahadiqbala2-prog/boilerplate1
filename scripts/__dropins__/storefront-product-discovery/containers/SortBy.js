/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as p}from"@dropins/tools/preact-jsx-runtime.js";import{useState as c,useEffect as d}from"@dropins/tools/preact-compat.js";import{Picker as h}from"@dropins/tools/components.js";import{events as C}from"@dropins/tools/event-bus.js";import{d as D}from"../chunks/search.js";import{useText as L}from"@dropins/tools/i18n.js";import"@dropins/tools/lib.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const k=({scope:t,onSortChange:e})=>{const a=L({sortLabel:"Search.PLP.SortDropdown.title",relevanceLabel:"Search.PLP.SortDropdown.relevanceLabel",sortASC:"Search.PLP.SortDropdown.sortASC",sortDESC:"Search.PLP.SortDropdown.sortDESC",positionLabel:"Search.PLP.SortDropdown.positionLabel"}),[i,n]=c([]),[r,l]=c("relevance_DESC"),[b,f]=c({});d(()=>{const o=C.on("search/result",s=>{var u;if(f(s.request),(u=s.metadata)!=null&&u.sortableAttributes&&(n([...s.metadata.sortableAttributes]),s.request.sort)){const S=x(s.request.sort);S&&l(S)}},{eager:!0,scope:t});return()=>{o==null||o.off()}},[]);const m=async o=>{e==null||e(o[0]),D({...b,sort:o,currentPage:1},{scope:t})};return p(h,{floatingLabel:a.sortLabel,...P(i,a),value:r,handleSelect:o=>{const{value:s}=o.target,u=v(s);m(u)}})};function P(t,e){const a={text:e.relevanceLabel,value:"relevance_DESC"},i=t.reduce((n,r)=>(r.attribute!=="position"&&r.attribute!=="relevance"&&(r.attribute==="price"?(n.push({text:e.sortASC,value:`${r.attribute}_ASC`}),n.push({text:e.sortDESC,value:`${r.attribute}_DESC`})):n.push({text:r.label,value:`${r.attribute}_DESC`})),n),[]);return i.push(a),{options:i,defaultOption:a}}function v(t){const e=t.indexOf("_");return[{attribute:t.substring(0,e),direction:t.substring(e+1)==="ASC"?"ASC":"DESC"}]}function x(t){return t.length>0&&t[0]?`${t[0].attribute}_${t[0].direction}`:""}export{k as SortBy,k as default};
//# sourceMappingURL=SortBy.js.map
