/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as r,jsxs as P}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as q,useCallback as _,useEffect as k,useMemo as D,useState as f}from"@dropins/tools/preact-compat.js";import{Button as K,Price as O,Image as Q}from"@dropins/tools/components.js";import{VComponent as v,Slot as g}from"@dropins/tools/lib.js";import{events as y}from"@dropins/tools/event-bus.js";/* empty css                   */import{useText as M}from"@dropins/tools/i18n.js";const U=({productList:i,viewAllButton:l,onClose:n,...a})=>{const t=i&&i.length>0,o=q(null),s=_(c=>{o.current&&!o.current.contains(c.target)&&(n==null||n())},[n]),u=_(c=>{c.key==="Escape"&&(n==null||n())},[n]);return k(()=>{if(t)return document.addEventListener("mousedown",s),document.addEventListener("keydown",u),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",u)}},[t,s,u]),t?r("div",{className:"product-discovery--search-bar-results",...a,children:r("div",{className:"product-discovery--search-bar-results__popover",ref:o,role:"region","aria-label":"Search results","aria-live":"polite",children:P("div",{className:"product-discovery--search-bar-results__outer-container",...a,children:[r("div",{className:"product-discovery--search-bar-results__grid",role:"list","aria-label":`${(i==null?void 0:i.length)||0} search results`,children:i==null?void 0:i.map((c,m)=>r("div",{role:"listitem",children:c},m))}),l&&r("div",{className:"product-discovery--search-bar-results__view-all-wrapper",children:r(v,{className:"product-discovery--search-bar-results__view-all-button",node:l})})]})})}):null},V=({productRouteSearch:i=s=>(s==null?void 0:s.url)||"",productItem:l,productImage:n,productName:a,productPrice:t,...o})=>{const s=D(()=>{const{name:u="",sku:c="",url:m=""}=l||{};return{tooltipText:[u,c&&`SKU: ${c}`].filter(Boolean).join(`
`),url:m}},[l]);return P("a",{className:"product-discovery--product-item",href:i(l),target:"_blank",rel:"noopener noreferrer",title:s.tooltipText,...o,children:[r("div",{className:"product-discovery--product-item__image",children:r(v,{node:n})}),P("div",{className:"product-discovery--product-item__details",children:[r(v,{node:a}),r(v,{node:t})]})]})},Z=({products:i=[],productRouteSearch:l=t=>(t==null?void 0:t.url)||"",routeSearch:n=()=>{},slots:a})=>{const[t,o]=f(i),[s,u]=f(""),[c,m]=f(i.length>0),w=M({viewAllButton:"Search.SearchInput.viewAllButton"});k(()=>{const e=y.on("search-input/result",E);return()=>{e==null||e.off()}},[]);const E=({result:e=[],request:h={}})=>{const{phrase:d=""}=h;o(e),u(d),m(e.length>0&&d.length>0)},N=_(()=>{n&&n(s),y.emit("search/request",{phrase:s}),y.emit("search-input/result",{result:[],request:{phrase:""}}),m(!1)},[n,s]),p=e=>{var h,d;return r(g,{name:"ProductImage",slot:a==null?void 0:a.ProductImage,context:{productItem:e},children:r(Q,{src:((d=(h=e==null?void 0:e.images)==null?void 0:h[0])==null?void 0:d.url)||""})})},A=e=>r(g,{name:"ProductName",slot:a==null?void 0:a.ProductName,context:{productItem:e},children:(e==null?void 0:e.name)||""}),T=e=>{var b,x,B,R,S;const{value:h,currency:d}=((x=(b=e==null?void 0:e.price)==null?void 0:b.final)==null?void 0:x.amount)||((S=(R=(B=e==null?void 0:e.priceRange)==null?void 0:B.minimum)==null?void 0:R.final)==null?void 0:S.amount)||{};return r(g,{name:"ProductPrice",slot:a==null?void 0:a.ProductPrice,context:{productItem:e},children:r(O,{amount:typeof h=="number"?h:void 0,currency:d})})},j=e=>r(V,{productRouteSearch:l,productItem:e,productImage:p(e),productName:A(e),productPrice:T(e)}),$=()=>r(K,{variant:"tertiary",onClick:()=>{N()},children:w.viewAllButton});return r("div",{children:t.length>0&&c&&r(U,{productList:t==null?void 0:t.map(e=>j(e)),viewAllButton:$(),onClose:N})})};export{Z as SearchBarResults,Z as default};
//# sourceMappingURL=SearchBarResults.js.map
