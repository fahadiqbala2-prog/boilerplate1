/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as k,jsx as o,Fragment as b}from"@dropins/tools/preact-jsx-runtime.js";import*as u from"@dropins/tools/preact-compat.js";import{useState as C,useEffect as q}from"@dropins/tools/preact-compat.js";import{VComponent as L,classes as z,Slot as R}from"@dropins/tools/lib.js";import{Button as x,Icon as A,ActionButton as H,PriceRange as V,Divider as j,Checkbox as D,RadioButton as P}from"@dropins/tools/components.js";/* empty css                 */import{useText as O}from"@dropins/tools/i18n.js";/* empty css                   *//* empty css                      *//* empty css                   */import{events as N}from"@dropins/tools/event-bus.js";const T=e=>u.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},u.createElement("g",{id:"Large"},u.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),u.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},u.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),u.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),U=e=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 12H21",stroke:"currentColor"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 6H21",stroke:"currentColor"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 18H21",stroke:"currentColor"})),W=e=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),u.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),Y=e=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},u.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),G=({numberOfOptionsConfig:e=5,header:t,buckets:c})=>{const l=O({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),m=e,[h,g]=C(c.length<m),p=h?c.length:m;return k("div",{children:[o(L,{className:"product-discovery-facet__header",node:t}),c.slice(0,p).map((v,F)=>o(L,{className:"product-discovery-facet__bucket",node:v},F)),!h&&c.length>m&&o(x,{variant:"tertiary",icon:o(A,{source:T,size:"24"}),onClick:()=>g(!h),children:l.showMore}),h&&c.length>m&&o(x,{variant:"tertiary",icon:o(A,{source:Y,size:"24"}),onClick:()=>g(!h),children:l.showLess})]})},J=({selectedFacets:e,facets:t})=>{const[c,l]=C(!0),m=()=>{l(!c)};return k("div",{className:"product-discovery-facet-list",children:[o("div",{className:"product-discovery-facet-list__show-filters-button",children:k(H,{onClick:()=>{m()},children:[o(A,{source:U,size:"16"}),o("span",{children:"Filters"})]})}),o(L,{className:"product-discovery-facet-list__selected-filters",node:e}),o(L,{className:z(["product-discovery-facet-list__facet-options",["product-discovery-facet-list__facet-options--hidden",c]]),node:t})]})},K="no",Q="yes",X=e=>{const t=e.buckets.find(c=>c.selected);return t?{attribute:e.attribute,range:{from:t.from,to:t.to}}:null},Z=e=>{const t=e.buckets.reduce((c,l)=>(l.selected&&c.push(l.title),c),[]);return t.length===0?null:{attribute:e.attribute,in:t}},I=e=>{var t;switch((t=e.buckets[0])==null?void 0:t.__typename){case"RangeBucket":return X(e);case"ScalarBucket":case"CategoryView":return Z(e)}},ee=e=>{var c,l,m,h,g,p,v,F,S,_,y;const t=e[0];return(m=(l=(c=t==null?void 0:t.price)==null?void 0:c.regular)==null?void 0:l.amount)!=null&&m.currency?t.price.regular.amount.currency:(v=(p=(g=(h=t==null?void 0:t.priceRange)==null?void 0:h.minimum)==null?void 0:g.regular)==null?void 0:p.amount)!=null&&v.currency?(y=(_=(S=(F=t==null?void 0:t.priceRange)==null?void 0:F.minimum)==null?void 0:S.regular)==null?void 0:_.amount)==null?void 0:y.currency:"USD"},te=(e,t,c)=>(t==null?void 0:t.attribute)==="price"?o(V,{minimumAmount:e.from,maximumAmount:e.to,currency:c||"USD",display:"dash"}):e.title,re=(e,t)=>e.title===K?`Not ${t.title}`:e.title===Q?t.title:e.title,M=(e,t,c)=>{switch(e.__typename){case"RangeBucket":return te(e,t,c);case"ScalarBucket":case"CategoryView":return re(e,t)}},he=({slots:e})=>{const t=O({clearAll:"Search.Facet.clearAll"}),[c,l]=C([]),[m,h]=C(null),g=n=>{if(!n||!n.result.facets&&!n.result.items&&!n.request.filter){l([]);return}const{facets:a,items:d}=n.result;h(ee(d));const r=n.request.filter;if(a){const s=a.map(i=>{const f=i.buckets.map(w=>{w.selected=!1;const E=r==null?void 0:r.find(B=>B.attribute===i.attribute);if(E){const B=E.range;(B&&w.from===B.from&&w.to===B.to||E.in&&E.in.includes(w.title))&&(w.selected=!0)}return w});return i.buckets=f,i});l(s)}},p=n=>{const a=c.map(r=>{const s=n.find(i=>i.attribute===r.attribute);return s||r}),d=a.reduce((r,s)=>{const i=I(s);return i&&r.push(i),r},[]);l(a),N.emit("search/request",{filter:d})},v=(n,a)=>{const d=n.buckets.map(s=>(s.title===a&&(s.selected=!1),s)),r=n;r.buckets=d,p([r])},F=()=>{const n=c.map(a=>{const d=a.buckets.map(r=>(r.selected=!1,r));return a.buckets=d,a});l(n),N.emit("search/request",{filter:[]})},S=(n,a)=>{const d=a.buckets.map(s=>{var i;return((i=a.buckets[0])==null?void 0:i.__typename)==="RangeBucket"&&(s.selected=!1),s.title===n.target.value&&(s.selected=n.target.checked),s}),r=a;r.buckets=d,p([r])},_=n=>{const a=o("span",{children:n.title}),d=n.buckets.map(r=>{var i;const s=M(r,n,m);switch((i=n.buckets[0])==null?void 0:i.__typename){case"RangeBucket":return o(P,{"data-testid":`${r.title}-radio`,label:s,name:n.attribute,value:r.title,checked:r.selected,onChange:f=>{S(f,n)}});case"ScalarBucket":case"CategoryView":return o(D,{"data-testid":`${r.title}-checkbox`,label:`${s} (${r.count})`,name:n.attribute,value:r.title,checked:r.selected,onChange:f=>{S(f,n)}});default:return null}}).filter(r=>r!==null);return o(G,{header:a,buckets:d})},y=()=>o(R,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:c},children:c.map(n=>n.buckets.length>0?k(b,{children:[o(R,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:n},children:_(n)}),o(j,{variant:"secondary"})]}):null)}),$=()=>{const n=c.reduce((r,s)=>(s.buckets.filter(f=>f.selected).length>0&&r.push(s),r),[]),a=n.map(r=>r.buckets.map(s=>{if(s.selected){const i=M(s,r,m);return o(x,{"data-testid":`${s.title}-selected-btn`,variant:"secondary",children:k(b,{children:[o("span",{children:i}),o(A,{source:W,size:"16"})]}),onClick:()=>{v(r,s.title)}})}return null})),d=a.length>0?o(x,{variant:"secondary",onClick:()=>{F()},children:o("span",{children:t.clearAll})}):null;return k(R,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:n},children:[a,d]})};return q(()=>{N.on("search/result",g)},[]),o(J,{selectedFacets:$(),facets:y()})};export{he as Facets,he as default};
//# sourceMappingURL=Facets.js.map
