/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as w,jsx as a,Fragment as b}from"@dropins/tools/preact-jsx-runtime.js";import*as d from"@dropins/tools/preact-compat.js";import{useState as E,useEffect as V}from"@dropins/tools/preact-compat.js";import{VComponent as C,classes as j,Slot as B}from"@dropins/tools/lib.js";import{Button as R,Icon as A,ActionButton as T,PriceRange as N,Divider as W,Checkbox as Y,RadioButton as G}from"@dropins/tools/components.js";/* empty css                 */import{useText as q}from"@dropins/tools/i18n.js";import{events as J}from"@dropins/tools/event-bus.js";import{d as O}from"../chunks/search.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const K=e=>d.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},d.createElement("g",{id:"Large"},d.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),d.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},d.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),d.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),Q=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 12H21",stroke:"currentColor"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 6H21",stroke:"currentColor"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 18H21",stroke:"currentColor"})),X=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),Z=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),I=({numberOfOptionsConfig:e=5,header:c,buckets:t})=>{const g=q({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),l=e,[m,p]=E(t.length<l),F=m?t.length:l;return w("div",{children:[a(C,{className:"product-discovery-facet__header",node:c}),t.slice(0,F).map((f,v)=>a(C,{className:"product-discovery-facet__bucket",node:f},v)),!m&&t.length>l&&a(R,{variant:"tertiary",icon:a(A,{source:K,size:"24"}),onClick:()=>p(!m),children:g.showMore}),m&&t.length>l&&a(R,{variant:"tertiary",icon:a(A,{source:Z,size:"24"}),onClick:()=>p(!m),children:g.showLess})]})},ee=({selectedFacets:e,facets:c})=>{const[t,g]=E(!0),l=()=>{g(!t)};return w("div",{className:"product-discovery-facet-list",children:[a("div",{className:"product-discovery-facet-list__show-filters-button",children:w(T,{onClick:()=>{l()},children:[a(A,{source:Q,size:"16"}),a("span",{children:"Filters"})]})}),a(C,{className:"product-discovery-facet-list__selected-filters",node:e}),a(C,{className:j(["product-discovery-facet-list__facet-options",["product-discovery-facet-list__facet-options--hidden",t]]),node:c})]})},te="no",re="yes",ne=e=>{const c=e.buckets.find(t=>t.selected);return c?{attribute:e.attribute,range:{from:c.from,to:c.to}}:null},ce=e=>{const c=e.buckets.reduce((t,g)=>(g.selected&&t.push(g.title),t),[]);return c.length===0?null:{attribute:e.attribute,in:c}},ae=e=>{var c;switch((c=e.buckets[0])==null?void 0:c.__typename){case"RangeBucket":return ne(e);case"ScalarBucket":case"CategoryView":return ce(e)}},se=e=>{var t,g,l,m,p,F,f,v,k,L,y;const c=e[0];return(l=(g=(t=c==null?void 0:c.price)==null?void 0:t.regular)==null?void 0:g.amount)!=null&&l.currency?c.price.regular.amount.currency:(f=(F=(p=(m=c==null?void 0:c.priceRange)==null?void 0:m.minimum)==null?void 0:p.regular)==null?void 0:F.amount)!=null&&f.currency?(y=(L=(k=(v=c==null?void 0:c.priceRange)==null?void 0:v.minimum)==null?void 0:k.regular)==null?void 0:L.amount)==null?void 0:y.currency:"USD"},ie=(e,c,t)=>(c==null?void 0:c.attribute)==="price"?e.from===0?w("div",{style:"display:flex",children:[a(N,{amount:e.from,currency:t||"USD"}),a("span",{style:"padding: 0 2px",children:"-"}),a(N,{amount:e.to,currency:t||"USD"})]}):a(N,{minimumAmount:e.from,maximumAmount:e.to,currency:t||"USD",display:"dash"}):e.title,oe=(e,c)=>e.title===te?`Not ${c.title}`:e.title===re?c.title:e.title,$=(e,c,t)=>{switch(e.__typename){case"RangeBucket":return ie(e,c,t);case"ScalarBucket":case"CategoryView":return oe(e,c)}},Se=({rootCategory:e,scope:c,slots:t})=>{const g=q({clearAll:"Search.Facet.clearAll"}),[l,m]=E([]),[p,F]=E(null),[f,v]=E(),k=r=>{e?O({...r,filter:[{attribute:"categoryPath",eq:e},...r.filter||[]]},{scope:c}):O(r,{scope:c})},L=r=>{if(!r||!r.result.facets&&!r.result.items&&!r.request.filter){m([]);return}v(r.request);const{facets:i,items:h}=r.result;F(se(h));const n=r.request.filter;if(i){const s=i.map(o=>{const S=o.buckets.map(u=>{u.selected=!1;const x=n==null?void 0:n.find(_=>_.attribute===o.attribute);if(x){const _=x.range;(_&&u.from===_.from&&u.to===_.to||x.in&&x.in.includes(u.title))&&(u.selected=!0)}return u});return o.buckets=S,o});m(s)}},y=r=>{const i=l.map(n=>{const s=r.find(o=>o.attribute===n.attribute);return s||n}),h=i.reduce((n,s)=>{const o=ae(s);return o&&n.push(o),n},[]);m(i),f&&k({...f,filter:h})},D=(r,i)=>{const h=r.buckets.map(s=>(s.title===i&&(s.selected=!1),s)),n=r;n.buckets=h,y([n])},z=()=>{const r=l.map(i=>{const h=i.buckets.map(n=>(n.selected=!1,n));return i.buckets=h,i});m(r),f&&k({...f,filter:[]})},M=(r,i)=>{const h=i.buckets.map(s=>{var o;return((o=i.buckets[0])==null?void 0:o.__typename)==="RangeBucket"&&(s.selected=!1),s.title===r.target.value&&(s.selected=r.target.checked),s}),n=i;n.buckets=h,y([n])},H=r=>{const i=a("span",{children:r.title}),h=r.buckets.map(n=>{var S;const s=$(n,r,p),o=u=>w(B,{name:"FacetBucketLabel",slot:t==null?void 0:t.FacetBucketLabel,context:{data:n},children:[s," ",u?`(${u})`:""]});switch((S=r.buckets[0])==null?void 0:S.__typename){case"RangeBucket":return a(B,{name:"FacetBucket",slot:t==null?void 0:t.FacetBucket,context:{data:n},children:a(G,{"data-testid":`${n.title}-radio`,label:o(),name:r.attribute,value:n.title,checked:n.selected,onChange:u=>{M(u,r)}})});case"ScalarBucket":case"CategoryView":return a(B,{name:"FacetBucket",slot:t==null?void 0:t.FacetBucket,context:{data:n},children:a(Y,{"data-testid":`${n.title}-checkbox`,label:o(n.count),name:r.attribute,value:n.title,checked:n.selected,onChange:u=>{M(u,r)}})});default:return null}}).filter(n=>n!==null);return a(I,{header:i,buckets:h})},P=()=>a(B,{name:"Facets",slot:t==null?void 0:t.Facets,context:{data:l},children:l.map(r=>r.buckets.length>0?w(b,{children:[a(B,{name:"Facet",slot:t==null?void 0:t.Facet,context:{data:r},children:H(r)}),a(W,{variant:"secondary"})]}):null)}),U=()=>{const r=l.reduce((n,s)=>(s.buckets.filter(S=>S.selected).length>0&&n.push(s),n),[]),i=r.map(n=>n.buckets.map(s=>{if(s.selected){const o=$(s,n,p);return a(R,{"data-testid":`${s.title}-selected-btn`,"aria-label":`Remove ${n.title} filter: ${s.title}`,variant:"secondary",children:w(b,{children:[a("span",{children:o}),a(A,{source:X,size:"16"})]}),onClick:()=>{D(n,s.title)}})}return null})),h=i.length>0?a(R,{variant:"secondary",onClick:()=>{z()},children:a("span",{children:g.clearAll})}):null;return w(B,{name:"SelectedFacets",slot:t==null?void 0:t.SelectedFacets,context:{data:r},children:[i,h]})};return V(()=>{const r=J.on("search/result",L,{eager:!0,scope:c});return()=>{r==null||r.off()}},[]),a(ee,{selectedFacets:U(),facets:P()})};export{Se as Facets,Se as default};
//# sourceMappingURL=Facets.js.map
