/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as F,jsx as a,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import*as h from"@dropins/tools/preact-compat.js";import{useState as C,useEffect as z}from"@dropins/tools/preact-compat.js";import{VComponent as E,Slot as B}from"@dropins/tools/lib.js";import{Button as R,Icon as b,PriceRange as A,Divider as T,Checkbox as W,RadioButton as H}from"@dropins/tools/components.js";/* empty css                 */import{useText as q}from"@dropins/tools/i18n.js";import{events as Y}from"@dropins/tools/event-bus.js";import{d as O}from"../chunks/search.js";import"../fragments.js";import"../chunks/acdlEvents.js";import"@dropins/tools/fetch-graphql.js";const G=n=>h.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...n},h.createElement("g",{id:"Large"},h.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),h.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},h.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),h.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),J=n=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},h.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),h.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),K=n=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},h.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),Q=({numberOfOptionsConfig:n=5,header:r,buckets:c})=>{const g=q({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),u=n,[d,p]=C(c.length<u),w=d?c.length:u;return F("div",{children:[a(E,{className:"product-discovery-facet__header",node:r}),c.slice(0,w).map((f,S)=>a(E,{className:"product-discovery-facet__bucket",node:f},S)),!d&&c.length>u&&a(R,{variant:"tertiary",icon:a(b,{source:G,size:"24"}),onClick:()=>p(!d),children:g.showMore}),d&&c.length>u&&a(R,{variant:"tertiary",icon:a(b,{source:K,size:"24"}),onClick:()=>p(!d),children:g.showLess})]})},X=({selectedFacets:n,facets:r})=>F(N,{children:[a(E,{className:"product-discovery-facet-list__selected-filters",node:n}),a(E,{className:"product-discovery-facet-list__facet-options",node:r})]}),Z="no",I="yes",ee=n=>{const r=n.buckets.find(c=>c.selected);return r?{attribute:n.attribute,range:{from:r.from,to:r.to}}:null},te=n=>{const r=n.buckets.reduce((c,g)=>(g.selected&&c.push(g.title),c),[]);return r.length===0?null:{attribute:n.attribute,in:r}},ne=n=>{var r;switch((r=n.buckets[0])==null?void 0:r.__typename){case"RangeBucket":return ee(n);case"ScalarBucket":case"CategoryView":return te(n)}},re=n=>{var c,g,u,d,p,w,f,S,y,_,L;const r=n[0];return(u=(g=(c=r==null?void 0:r.price)==null?void 0:c.regular)==null?void 0:g.amount)!=null&&u.currency?r.price.regular.amount.currency:(f=(w=(p=(d=r==null?void 0:r.priceRange)==null?void 0:d.minimum)==null?void 0:p.regular)==null?void 0:w.amount)!=null&&f.currency?(L=(_=(y=(S=r==null?void 0:r.priceRange)==null?void 0:S.minimum)==null?void 0:y.regular)==null?void 0:_.amount)==null?void 0:L.currency:"USD"},ce=(n,r,c)=>(r==null?void 0:r.attribute)==="price"?n.from===0?F("div",{style:"display:flex",children:[a(A,{amount:n.from,currency:c||"USD"}),a("span",{style:"padding: 0 2px",children:"-"}),a(A,{amount:n.to,currency:c||"USD"})]}):a(A,{minimumAmount:n.from,maximumAmount:n.to,currency:c||"USD",display:"dash"}):n.title,ae=(n,r)=>n.title===Z?`Not ${r.title}`:n.title===I?r.title:n.title,$=(n,r,c)=>{switch(n.__typename){case"RangeBucket":return ce(n,r,c);case"ScalarBucket":case"CategoryView":return ae(n,r)}},Fe=({rootCategory:n,scope:r,slots:c})=>{const g=q({clearAll:"Search.Facet.clearAll"}),[u,d]=C([]),[p,w]=C(null),[f,S]=C(),y=e=>{n?O({...e,filter:[{attribute:"categoryPath",eq:n},...e.filter||[]]},{scope:r}):O(e,{scope:r})},_=e=>{if(!e||!e.result.facets&&!e.result.items&&!e.request.filter){d([]);return}S(e.request);const{facets:s,items:m}=e.result;w(re(m));const t=e.request.filter;if(s){const i=s.map(l=>{const v=l.buckets.map(o=>{o.selected=!1;const x=t==null?void 0:t.find(k=>k.attribute===l.attribute);if(x){const k=x.range;(k&&o.from===k.from&&o.to===k.to||x.in&&x.in.includes(o.title))&&(o.selected=!0)}return o});return l.buckets=v,l});d(i)}},L=e=>{const s=u.map(t=>{const i=e.find(l=>l.attribute===t.attribute);return i||t}),m=s.reduce((t,i)=>{const l=ne(i);return l&&t.push(l),t},[]);d(s),f&&y({...f,filter:m})},D=(e,s)=>{const m=e.buckets.map(i=>(i.title===s&&(i.selected=!1),i)),t=e;t.buckets=m,L([t])},P=()=>{const e=u.map(s=>{const m=s.buckets.map(t=>(t.selected=!1,t));return s.buckets=m,s});d(e),f&&y({...f,filter:[]})},M=(e,s)=>{const m=s.buckets.map(i=>{var l;return((l=s.buckets[0])==null?void 0:l.__typename)==="RangeBucket"&&(i.selected=!1),i.title===e.target.value&&(i.selected=e.target.checked),i}),t=s;t.buckets=m,L([t])},U=e=>{const s=a("span",{children:e.title}),m=e.buckets.map(t=>{var v;const i=$(t,e,p),l=o=>F(B,{name:"FacetBucketLabel",slot:c==null?void 0:c.FacetBucketLabel,context:{data:t},children:[i," ",o?`(${o})`:""]});switch((v=e.buckets[0])==null?void 0:v.__typename){case"RangeBucket":return a(B,{name:"FacetBucket",slot:c==null?void 0:c.FacetBucket,context:{data:t},children:a(H,{"data-testid":`${t.title}-radio`,label:l(),name:e.attribute,value:t.title,checked:t.selected,onChange:o=>{M(o,e)}})});case"ScalarBucket":case"CategoryView":return a(B,{name:"FacetBucket",slot:c==null?void 0:c.FacetBucket,context:{data:t},children:a(W,{"data-testid":`${t.title}-checkbox`,label:l(t.count),name:e.attribute,value:t.title,checked:t.selected,onChange:o=>{M(o,e)}})});default:return null}}).filter(t=>t!==null);return a(Q,{header:s,buckets:m})},V=()=>a(B,{name:"Facets",slot:c==null?void 0:c.Facets,context:{data:u},children:u.map(e=>e.buckets.length>0?F(N,{children:[a(B,{name:"Facet",slot:c==null?void 0:c.Facet,context:{data:e},children:U(e)}),a(T,{variant:"secondary"})]}):null)}),j=()=>{const e=u.reduce((t,i)=>(i.buckets.filter(v=>v.selected).length>0&&t.push(i),t),[]),s=e.map(t=>t.buckets.map(i=>{if(i.selected){const l=$(i,t,p);return a(R,{"data-testid":`${i.title}-selected-btn`,"aria-label":`Remove ${t.title} filter: ${i.title}`,variant:"secondary",children:F(N,{children:[a("span",{children:l}),a(b,{source:J,size:"16"})]}),onClick:()=>{D(t,i.title)}})}return null})),m=s.length>0?a(R,{variant:"secondary",onClick:()=>{P()},children:a("span",{children:g.clearAll})}):null;return F(B,{name:"SelectedFacets",slot:c==null?void 0:c.SelectedFacets,context:{data:e},children:[s,m]})};return z(()=>{const e=Y.on("search/result",_,{eager:!0,scope:r});return()=>{e==null||e.off()}},[]),a(X,{selectedFacets:j(),facets:V()})};export{Fe as Facets,Fe as default};
//# sourceMappingURL=Facets.js.map
