import{P as W}from"../chunks/countries__kOBkhT14HN.js";import{e as T,U as X}from"../chunks/transform-shipping-methods__Cf4nSDpLmb.js";import{events as Y}from"@dropins/tools/event-bus.js";import{p as D,g as ee,a as te}from"../chunks/placeOrder__DVrYd-6Lny.js";import{i as re}from"../chunks/IsBillToShippingSignal__Bk6AE4B7-o.js";import{C as f}from"../chunks/usePreselectedFields__C2LJAdglEo.js";import"@dropins/tools/preact-hooks.js";import"../chunks/BillToShippingAddress__DaEGMXF6uc.js";import{jsx as e,jsxs as E}from"@dropins/tools/preact-jsx-runtime.js";import{I as C}from"../chunks/IllustratedMessage__Bg0MChJYnS.js";import*as o from"@dropins/tools/preact-compat.js";import{useState as k,useCallback as oe,useEffect as P}from"@dropins/tools/preact-compat.js";import{u as g,c as l,T as ne,M as ie}from"../chunks/preact-i18n.esm__AesnfYdPmV.js";import{Icon as L}from"@dropins/tools/components/Icon.js";import{B as O}from"../chunks/Button__Dyj88ihZKB.js";import{S as se}from"../chunks/ShippingMethods__CGtaXO0kiO.js";import{L as ce}from"../chunks/LoginForm__CRb59IO_mZ.js";import{S as ae}from"../chunks/ShippingForm__CI9CMJe4K9.js";import{B as le}from"../chunks/BillToShippingAddress__CfMeosbiqF.js";import{O as me}from"../chunks/OrderSummary__CYrgKS2vhV.js";import{S as d,P as pe}from"../chunks/PaymentMethods__ehmne0q38K.js";import{B as de}from"../chunks/BillingForm__CGIM3J21nt.js";import{P as ue}from"../chunks/PlaceOrder__D19IGrzyqB.js";import{E as he}from"../chunks/ErrorBanner__BKKCpXVYQT.js";import{C as fe}from"../chunks/CartSummary__iH8HbNepAf.js";import"@dropins/tools/preact.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/transform-cart__DgY4t0oRSz.js";import"../chunks/cart-item__CslQ7p973r.js";import"../chunks/estimateShippingMethods__aExd3KlX7Z.js";import"../chunks/vcomponent__B-EAiH6JFM.js";import"../chunks/ProgressSpinner__Bqh6pootSA.js";import"../chunks/SelectedShippingMethodSignal__3rJ8QFAjSs.js";import"../chunks/setShippingMethods__B_jHMqHRHW.js";import"../chunks/Price__DZvul-osZQ.js";import"../chunks/setGuestEmailOnCart__Bzq6DU0i47.js";import"../chunks/constants__CfwVSzXkUQ.js";import"../chunks/setBillingAddress__B-nDRlph1U.js";import"../chunks/setShippingAddress__IsgqIfAAH7.js";import"../chunks/constants__DAOfE85AhJ.js";import"../chunks/Divider__8lDmXqHqNY.js";import"../chunks/setPaymentMethod__R8UrUkFqLt.js";import"../chunks/constants__CI9SypcNWw.js";import"../chunks/UIProvider__krDvY5_bDA.js";import"../chunks/image-params-keymap__Bk3U4q-hHX.js";const ke=s=>o.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},o.createElement("g",{clipPath:"url(#clip0_102_196)"},o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3601 18.16H6.5601L4.8801 3H2.3501M19.6701 19.59C19.6701 20.3687 19.0388 21 18.2601 21C17.4814 21 16.8501 20.3687 16.8501 19.59C16.8501 18.8113 17.4814 18.18 18.2601 18.18C19.0388 18.18 19.6701 18.8113 19.6701 19.59ZM7.42986 19.59C7.42986 20.3687 6.79858 21 6.01986 21C5.24114 21 4.60986 20.3687 4.60986 19.59C4.60986 18.8113 5.24114 18.18 6.01986 18.18C6.79858 18.18 7.42986 18.8113 7.42986 19.59Z",stroke:"currentColor",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.25 6.37L20.89 8.06L20.14 14.8H6.19",stroke:"currentColor",strokeLinejoin:"round"})),o.createElement("defs",null,o.createElement("clipPath",{id:"clip0_102_196"},o.createElement("rect",{vectorEffect:"non-scaling-stroke",width:19.29,height:19.5,fill:"white",transform:"translate(2.3501 2.25)"})))),b=s=>o.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},o.createElement("g",{clipPath:"url(#clip0_4797_15331)"},o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M10.25 20.91L1.5 17.55V6.51996L10.25 9.92996V20.91Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.24023 4.64001L14.9902 8.06001V11.42",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{className:"error-icon",vectorEffect:"non-scaling-stroke",d:"M19 13.31L15.5 19.37H22.5L19 13.31Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{className:"error-icon",vectorEffect:"non-scaling-stroke",d:"M19.0202 17.11H18.9802L18.9502 15.56H19.0502L19.0202 17.11ZM18.9602 18.29V18.06H19.0502V18.29H18.9602Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19 12.16V6.51996L10.25 9.92996V20.91L14.27 19.37L14.4 19.32",stroke:"currentColor",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M1.5 6.51999L10.25 3.04999L19 6.51999L10.25 9.92999L1.5 6.51999Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),o.createElement("defs",null,o.createElement("clipPath",{id:"clip0_4797_15331"},o.createElement("rect",{width:22,height:18.86,fill:"white",transform:"translate(1 2.54999)"})))),ge=({className:s,title:m,routeHome:r,...t})=>{const c=g({Title:"Checkout.EmptyCart.title",Button:"Checkout.EmptyCart.button"});return e(C,{...t,"data-testid":"checkout-empty-cart",className:l(["checkout-empty-cart",s]),heading:m??c.Title,icon:e(L,{className:l(["checkout-empty-cart__icon"]),source:ke}),action:r!=null&&r()?e(O,{className:"checkout-empty-cart__button",size:"medium",variant:"primary",type:"submit",href:r==null?void 0:r(),children:c.Button},"routeHome"):void 0})},Se=({className:s,icon:m,routeCart:r,...t})=>{const c=g({Title:"Checkout.OutOfStock.title",Message:"Checkout.OutOfStock.message"});return E("div",{...t,className:l(["checkout-out-of-stock",s]),"data-testid":"checkout-out-of-stock",children:[e(C,{heading:c.Title,message:e("p",{children:c.Message}),icon:e(L,{source:m??b,className:l(["checkout-out-of-stock__icon"])})}),(r==null?void 0:r())&&e(O,{className:"checkout-out-of-stock__button",size:"medium",variant:"primary",type:"submit",href:r==null?void 0:r(),children:e(ne,{id:"Checkout.OutOfStock.button"})},"routeCart")]})},ve=({className:s,errorMessage:m,contactSupport:r,...t})=>{const{onClick:c}=t,p=g({Title:"Checkout.ServerError.title",Message:"Checkout.ServerError.message",ContactSupport:"Checkout.ServerError.contactSupport",Button:"Checkout.ServerError.button"});return e(C,{"aria-invalid":"true","aria-describedby":"checkout-server-error__message","aria-live":"polite",className:l(["checkout-server-error",s]),"data-testid":"checkout-server-error",heading:m??p.Title,message:E("p",{id:l(["checkout-server-error__message"]),children:[p.Message,e("br",{}),e(ie,{id:"",children:r??p.ContactSupport})]}),icon:e(L,{className:l(["checkout-server-error__icon"]),source:b}),action:e(O,{className:l(["checkout-server-error__button"]),onClick:c,children:p.Button})})},mt="OUT_OF_STOCK",pt=s=>{const{className:m,cartId:r,slots:t,routeHome:c,routeCart:p,preselectedCartData:u,...x}=s,[M,y]=k(""),[N,j]=k(),[S,F]=k(!1),[I,V]=k(!1),U=!!r,{data:i}=T.value,Z=i!==void 0,h=(i==null?void 0:i.virtual)||!1,A=U&&!Z,H=M!=="",_=i==null?void 0:i.items,z=_!==void 0&&_.length>0,K=!A&&!z,R=g({CheckoutUnexpectedError:"Checkout.ServerError.unexpected"}),q=oe(async()=>{i&&(await D(i.id),T.value={pending:!1},F(!0))},[i]),$=n=>{j(()=>n)},G=async()=>{y(""),i&&await v(i.id)},w=n=>{y(n instanceof TypeError||n instanceof X?R.CheckoutUnexpectedError:n.message)},v=async n=>{const a=await ee(n);a!=null&&a.virtual&&(re.value={checked:!1,setByUser:!1})},B=async n=>{const a=await te(n);V(a===W.OutOfStock)};if(P(()=>{!r||S||(v(r),B(r))},[r,S]),P(()=>{const n=Y.on("cart/data",a=>{!r&&a&&(v(a.id),B(a.id))},{eager:!0});return()=>{n==null||n.off()}},[r]),S)return null;if(K)return e(ge,{routeHome:c});if(H)return e(ve,{errorMessage:M,onClick:G});const J=()=>I?e(f.Main,{outOfStock:e(Se,{routeCart:p})}):e(f.Main,{sections:{billingAddress:e(d,{name:"BillingForm",slot:t==null?void 0:t.BillingForm,children:e(de,{})}),billToShippingAddress:h?void 0:e(d,{name:"BillToShipping",slot:t==null?void 0:t.BillToShipping,children:e(le,{})}),login:e(d,{name:"Login",slot:t==null?void 0:t.Login,children:e(ce,{})}),paymentMethods:e(pe,{isShippingInfoRequired:!h,onPlaceOrder:$,handleServerError:w,paymentMethodsSlot:t==null?void 0:t.PaymentMethods}),placeOrder:e(ue,{onClick:N??q,handleServerError:w}),shippingAddress:h?void 0:e(d,{name:"ShippingForm",slot:t==null?void 0:t.ShippingForm,children:e(ae,{preselectedFields:u==null?void 0:u.address})}),shippingMethods:h?void 0:e(d,{name:"ShippingMethods",slot:t==null?void 0:t.ShippingMethods,children:e(se,{preSelectedMethod:u==null?void 0:u.shippingMethod})})}}),Q=()=>e(f.Aside,{sections:{cartSummary:e(d,{name:"CartSummary",slot:t==null?void 0:t.CartSummary,children:e(fe,{routeCart:p})}),orderSummary:e(d,{name:"OrderSummary",slot:t==null?void 0:t.OrderSummary,children:e(me,{})})}});return E(f,{className:m,banner:e(he,{}),...x,children:[Q(),J()]})};export{pt as Checkout,mt as OUT_OF_STOCK,pt as default};
//# sourceMappingURL=Checkout.js.map
