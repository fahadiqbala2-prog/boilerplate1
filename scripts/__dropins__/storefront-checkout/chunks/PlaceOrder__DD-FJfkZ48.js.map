{"version":3,"file":"PlaceOrder__DD-FJfkZ48.js","sources":["../../src/components/PlaceOrder/PlaceOrder.tsx","../../src/containers/PlaceOrder/PlaceOrder.tsx"],"sourcesContent":["import { FunctionComponent } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\nimport { classes } from '@adobe/elsie/lib';\nimport '@/checkout/components/PlaceOrder/PlaceOrder.css';\nimport { Button } from '@adobe/elsie/components';\nimport { Text } from '@adobe/elsie/i18n';\n\nexport interface PlaceOrderProps extends HTMLAttributes<HTMLButtonElement> {\n  onClick?: (e: any) => void;\n  isLoading?: boolean;\n}\n\nexport const PlaceOrder: FunctionComponent<PlaceOrderProps> = ({\n  className,\n  children,\n  ...props\n}) => {\n  const { onClick = () => {}, isLoading } = props;\n\n  return (\n    <div className={classes(['checkout-place-order', className])}>\n      <Button\n        className={classes(['checkout-place-order__button', className])}\n        size=\"medium\"\n        variant=\"primary\"\n        key=\"placeOrder\"\n        type=\"submit\"\n        onClick={onClick}\n        disabled={isLoading}\n      >\n        <Text id=\"Checkout.PlaceOrder.button\" />\n      </Button>\n    </div>\n  );\n};\n","import { HTMLAttributes } from 'preact/compat';\nimport { Container } from '@adobe/elsie/lib';\nimport { PlaceOrder as PlaceOrderComponent } from '@/checkout/components/PlaceOrder/PlaceOrder';\nimport {\n  BILLING_FORM_NAME,\n  LOGIN_FORM_NAME,\n  SHIPPING_FORM_NAME,\n} from '@/checkout/containers';\nimport { cartSignal } from '@/checkout/signals';\n\nexport interface PlaceOrderProps extends HTMLAttributes<HTMLDivElement> {\n  onClick: () => void;\n  handleServerError: (error: any) => void;\n}\n\nconst CHECKOUT_FORMS = [LOGIN_FORM_NAME, SHIPPING_FORM_NAME, BILLING_FORM_NAME];\n\nconst scrollToFirstInvalidField = (form: HTMLFormElement) => {\n  const firstInvalidField = form.querySelector(':invalid') as HTMLElement;\n\n  if (firstInvalidField) {\n    firstInvalidField.scrollIntoView({ behavior: 'smooth' });\n    firstInvalidField.focus();\n  }\n};\n\nconst canPlaceOrder = () => {\n  const formCollection = Array.from(document.forms) || [];\n\n  const invalidForms = formCollection\n    .filter((form) => {\n      return CHECKOUT_FORMS.includes(form.name);\n    })\n    .filter((form) => {\n      // ignore forms that are not visible\n      return form.offsetParent !== null;\n    })\n    .filter((form) => {\n      // this will trigger the validation on all the fields\n      return !form.checkValidity();\n    });\n\n  const canPlaceOrder = invalidForms.length === 0;\n\n  if (!canPlaceOrder) {\n    const firstInvalidForm = invalidForms[0];\n    scrollToFirstInvalidField(firstInvalidForm);\n  }\n\n  return canPlaceOrder;\n};\n\nexport const PlaceOrder: Container<PlaceOrderProps> = (props) => {\n  const { onClick, handleServerError } = props;\n\n  const handleOrderPlace = async () => {\n    if (!canPlaceOrder()) return;\n    try {\n      await onClick();\n    } catch (err) {\n      handleServerError(err);\n    }\n  };\n\n  return (\n    <PlaceOrderComponent\n      onClick={handleOrderPlace}\n      isLoading={cartSignal.value.pending}\n    />\n  );\n};\n"],"names":["PlaceOrder","className","children","props","onClick","isLoading","_jsx","classes","Button","size","variant","type","disabled","Text","id","CHECKOUT_FORMS","LOGIN_FORM_NAME","SHIPPING_FORM_NAME","BILLING_FORM_NAME","scrollToFirstInvalidField","form","firstInvalidField","querySelector","scrollIntoView","behavior","focus","canPlaceOrder","formCollection","Array","from","document","forms","invalidForms","filter","includes","name","offsetParent","checkValidity","length","firstInvalidForm","handleServerError","handleOrderPlace","err","PlaceOrderComponent","cartSignal","value","pending"],"mappings":";;;;;;;;;;;;;;AAYO,MAAMA,eAAiDA,CAAC;AAAA,EAC7DC;AAAAA,EACAC;AAAAA,EACA,GAAGC;AACL,MAAM;AACE,QAAA;AAAA,IAAEC,UAAUA,MAAM;AAAA,IAAC;AAAA,IAAGC;AAAAA,EAAcF,IAAAA;AAE1C,SACEG,IAAA,OAAA;AAAA,IAAKL,WAAWM,QAAQ,CAAC,wBAAwBN,SAAS,CAAC;AAAA,IAAEC,UAC3DI,IAACE,QAAM;AAAA,MACLP,WAAWM,QAAQ,CAAC,gCAAgCN,SAAS,CAAC;AAAA,MAC9DQ,MAAK;AAAA,MACLC,SAAQ;AAAA,MAERC,MAAK;AAAA,MACLP;AAAAA,MACAQ,UAAUP;AAAAA,MAAUH,UAEpBI,IAACO,MAAI;AAAA,QAACC,IAAG;AAAA,MAAA,CAA8B;AAAA,OALnC,YAME;AAAA,EAAA,CACL;AAET;ACnBA,MAAMC,iBAAiB,CAACC,iBAAiBC,oBAAoBC,iBAAiB;AAE9E,MAAMC,4BAA4BA,CAACC,SAA0B;AACrDC,QAAAA,oBAAoBD,KAAKE,cAAc,UAAU;AAEvD,MAAID,mBAAmB;AACrBA,sBAAkBE,eAAe;AAAA,MAAEC,UAAU;AAAA,IAAA,CAAU;AACvDH,sBAAkBI,MAAM;AAAA,EAC1B;AACF;AAEA,MAAMC,gBAAgBA,MAAM;AAC1B,QAAMC,iBAAiBC,MAAMC,KAAKC,SAASC,KAAK,KAAK;AAE/CC,QAAAA,eAAeL,eAClBM,OAAQb,CAAS,SAAA;AACTL,WAAAA,eAAemB,SAASd,KAAKe,IAAI;AAAA,EAAA,CACzC,EACAF,OAAQb,CAAS,SAAA;AAEhB,WAAOA,KAAKgB,iBAAiB;AAAA,EAAA,CAC9B,EACAH,OAAQb,CAAS,SAAA;AAET,WAAA,CAACA,KAAKiB;EAAc,CAC5B;AAEGX,QAAAA,iBAAgBM,aAAaM,WAAW;AAE9C,MAAI,CAACZ,gBAAe;AACZa,UAAAA,mBAAmBP,aAAa,CAAC;AACvCb,8BAA0BoB,gBAAgB;AAAA,EAC5C;AAEOb,SAAAA;AACT;AAEO,MAAM1B,aAA0CG,CAAU,UAAA;AACzD,QAAA;AAAA,IAAEC;AAAAA,IAASoC;AAAAA,EAAsBrC,IAAAA;AAEvC,QAAMsC,mBAAmB,YAAY;AACnC,QAAI,CAACf,cAAc;AAAG;AAClB,QAAA;AACF,YAAMtB,QAAQ;AAAA,aACPsC,KAAK;AACZF,wBAAkBE,GAAG;AAAA,IACvB;AAAA,EAAA;AAGF,SACEpC,IAACqC,cAAmB;AAAA,IAClBvC,SAASqC;AAAAA,IACTpC,WAAWuC,WAAWC,MAAMC;AAAAA,EAAAA,CAC7B;AAEL;"}