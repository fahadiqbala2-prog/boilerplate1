const __vite__fileDeps=["debugger.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import"@dropins/tools/event-bus.js";import{e as q}from"./transform-shipping-methods__Cf4nSDpLmb.js";import"./countries__kOBkhT14HN.js";import{s as J}from"./setPaymentMethod__R8UrUkFqLt.js";import{H as Z}from"./usePreselectedFields__C2LJAdglEo.js";import{useEffect as T,useRef as H,useState as B,useMemo as F,useContext as G,useCallback as _}from"@dropins/tools/preact-hooks.js";import{S as K,a as E}from"./BillToShippingAddress__DaEGMXF6uc.js";import{jsx as d,jsxs as v,Fragment as Q}from"@dropins/tools/preact-jsx-runtime.js";import{a as X,u as Y,c as M}from"./preact-i18n.esm__AesnfYdPmV.js";import{I as ee,R as te}from"./IllustratedMessage__Bg0MChJYnS.js";import*as N from"@dropins/tools/preact-compat.js";import{useRef as ne,useState as R,useCallback as $,useEffect as O}from"@dropins/tools/preact-compat.js";import{Icon as oe}from"@dropins/tools/components/Icon.js";import{P as se}from"./ProgressSpinner__Bqh6pootSA.js";const re="modulepreload",ie=function(t){return"/"+t},W={},ce=function(s,o,c){let r=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.all(o.map(i=>{if(i=ie(i),i in W)return;W[i]=!0;const f=i.endsWith(".css"),y=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${y}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":re,f||(m.as="script",m.crossOrigin=""),m.href=i,l&&m.setAttribute("nonce",l),document.head.appendChild(m),f)return new Promise((C,p)=>{m.addEventListener("load",C),m.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${i}`)))})}))}return r.then(()=>s()).catch(a=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a})};function ae(t={},s,o){const c=H(null),r=H(!1),a=H([]),[l,i]=B({children:[o==null?void 0:o({})]}),[f,y]=B({}),m=F(()=>({get:e=>f[e],set:(e,n)=>{y({...m,[e]:n})}}),[f]),{intl:C}=G(X);t.dictionary=C.dictionary,t._setProps=i;const p=_(e=>{typeof e=="function"?a.current.push(e):console.warn("Skipped: Invalid _registerMethod",e)},[]);t._registerMethod=p;const P=_(e=>d("div",{"data-slot-html-element":e.tagName.toLowerCase(),ref:n=>{n==null||n.appendChild(e)}}),[]);return t._htmlElementToVNode=P,t.getSlotElement=_(e=>{const n=document.querySelector(`[data-slot-key="${e}"]`);if(n)return{appendChild:h=>{n.appendChild(h)},prependChild:h=>{n.insertBefore(h,n.firstChild)},appendSibling:h=>{const u=n.parentNode;u==null||u.insertBefore(h,n.nextSibling)},prependSibling:h=>{const u=n.parentNode;u==null||u.insertBefore(h,n)}}},[]),t.onChange=_(e=>{a.current.push(e)},[]),t.replaceWith=_(e=>{p(n=>{const h=P(e);n._setProps({children:[h]})})},[P,p]),t.appendChild=_(e=>{p(n=>{const h=P(e);n._setProps(u=>({...u,children:[...u.children,h]}))})},[P,p]),t.prependChild=_(e=>{p(n=>{const h=P(e);n._setProps(u=>({...u,children:[h,...u.children]}))})},[P,p]),t.appendSibling=_(e=>{p(()=>{var h,u;const n=(h=c.current)==null?void 0:h.parentNode;n==null||n.insertBefore(e,((u=c.current)==null?void 0:u.nextSibling)??null)})},[p]),t.prependSibling=_(e=>{p(()=>{var h;const n=(h=c.current)==null?void 0:h.parentNode;n==null||n.insertBefore(e,c.current)})},[p]),T(()=>{const e=c.current;if(!(!s||!e))try{s(t,e)}catch(n){console.error(`Error in "${s.name}" Slot callback`,n)}},[]),T(()=>{i({children:[o==null?void 0:o(l)]}),a.current.forEach(e=>{e(t,m)}),(o==null?void 0:o.name)==="render"&&r.current===!1&&(r.current=!0)},[JSON.stringify(t),JSON.stringify(f),r.current]),[c,l]}function V({name:t,slot:s,context:o,children:c,render:r,...a}){const[l,i]=ae(o,s,r??(()=>c));return T(()=>{t||console.warn('Slot "name" is required')},[t]),d("div",{...a,ref:l,"data-slot":t,children:i.children})}window.DROPINS=window.DROPINS||{};window.DROPINS.showSlots=async t=>{if(window.sessionStorage.setItem("dropin-debugger--show-slots",t.toString()),document.body.classList.toggle("dropin-debugger--show-slots",t),t)try{await ce(()=>Promise.resolve({}),__vite__mapDeps([0]))}catch{}};window.DROPINS.showSlots(window.sessionStorage.getItem("dropin-debugger--show-slots")==="true");const le=t=>N.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},N.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),N.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),N.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),de=({code:t,isLoading:s,isSelected:o,onChange:c,title:r})=>d(me,{className:"checkout-payment-methods__method",label:r,name:"payment-method",value:t,selected:o,onChange:c,radioButtonProps:{"aria-busy":s}}),he=({className:t,paymentMethodContent:s,isLoading:o,onChange:c=()=>{},options:r,selection:a})=>{const l=Y({Title:"Checkout.PaymentMethods.title",EmptyState:"Checkout.PaymentMethods.emptyState"});return r===void 0?d(ue,{}):v("div",{className:M(["checkout-payment-methods",t]),children:[d(Z,{level:2,className:"checkout-payment-methods__title",children:l.Title}),!o&&r.length===0&&d(ee,{icon:d(oe,{source:le}),message:d("p",{children:l.EmptyState})}),v("div",{className:M(["checkout-payment-methods__wrapper"]),children:[o&&d(se,{className:"checkout-payment-methods__spinner"}),d("div",{className:M(["checkout-payment-methods__methods",["checkout-payment-methods--loading",o],["checkout-payment-methods--full-width",r.length%2!==0]]),children:r==null?void 0:r.map(i=>d(de,{code:i.code,onChange:c,isSelected:i.code===a,title:i.title},i.code))}),s&&d("div",{className:"checkout-payment-methods__content",children:s})]})]})},ue=()=>v(K,{"data-testid":"payment-methods-skeleton",children:[d(E,{variant:"heading",size:"medium"}),d(E,{variant:"empty",size:"medium"}),d(E,{size:"xlarge",fullWidth:!0}),d(E,{size:"xlarge",fullWidth:!0})]}),me=({label:t,name:s,value:o,icon:c,selected:r,onChange:a,className:l,children:i,radioButtonProps:f,...y})=>d("div",{className:M(["checkout-toggle-button",l,["checkout-toggle-button__selected",r]]),...y,children:v("label",{className:"checkout-toggle-button__actionButton",children:[d(te,{...f,label:"",name:s,value:o,checked:r,onChange:()=>a(o),"aria-label":t,className:M([l,"checkout-toggle-button__radioButton"])}),v("div",{className:"checkout-toggle-button__content",children:[c&&d(c.type,{...c==null?void 0:c.props,className:"checkout-toggle-button__icon"}),t]})]})}),A={free:{render:t=>{const s=document.createElement("div");s.innerText="",t.replaceHTML(s)}},checkmo:{render:t=>{const s=document.createElement("div");s.innerText="",t.replaceHTML(s)}}};function pe(t){var L;const{onPlaceOrder:s,handleServerError:o,paymentMethodsSlot:c,isShippingInfoRequired:r}=t,a=ne(),[l,i]=R(),[f,y]=R(),[m,C]=R(A),[p,P]=R(!0),{data:e}=q.value,n=(e==null?void 0:e.id)??"",h=!!e,u=!!((L=e==null?void 0:e.shippingAddresses)!=null&&L[0]),S=e==null?void 0:e.availablePaymentMethods,k=e==null?void 0:e.selectedPaymentMethod,b=$(async g=>{try{if(i(g),!u&&r)return;const w=g;if(w===a.current)return;a.current=w,await J({cartId:n,paymentMethod:g})}catch(w){console.error("setting payment method failed:",w)}},[n,u,r]);O(()=>{h&&(k!=null&&k.code?(S==null?void 0:S.some(w=>w.code===k.code))?i(k.code):S!=null&&S.length?b(S[0].code):i(void 0):S[0]&&b(f||S[0].code))},[S,h,k,b,f]);const U=async g=>{await b(g),k!=null&&k.code||y(g)},j=$((g,w)=>{if(!g){console.warn("Payment method handler is ignored because it has no code");return}if(!w){console.warn("Payment method handler is ignored because it is empty");return}C(D=>({...D,[g]:w}))},[]),z=c?d(V,{name:"PaymentMethods",slot:c,context:{addPaymentMethodHandler:j,replaceHTML(g){this.replaceWith(g),P(!1)}}}):null,I=l?m[l]:null,x=I?d(V,{name:"PaymentMethodContent",slot:I.render,context:{cartId:n,onPlaceOrder:s,handleServerError:o,replaceHTML(g){this.replaceWith(g)}}},I):void 0;return O(()=>{!p&&m!=A&&console.warn("Payment method handlers you have added are ignored because the default content has been replaced")},[p,m]),{availablePaymentMethods:S,selectedPaymentMethod:l,onPaymentMethodChange:U,paymentMethodContent:x,mainSlotContent:z,isDefaultContentUsed:p}}const Ne=t=>{const{onPlaceOrder:s,handleServerError:o,paymentMethodsSlot:c,isShippingInfoRequired:r=!0}=t,{availablePaymentMethods:a,selectedPaymentMethod:l,onPaymentMethodChange:i,paymentMethodContent:f,mainSlotContent:y,isDefaultContentUsed:m}=pe({onPlaceOrder:s,handleServerError:o,paymentMethodsSlot:c,isShippingInfoRequired:r});return v(Q,{children:[y&&d(y.type,{ref:y.ref,...y.props}),m&&d(he,{options:a,selection:l,onChange:i,paymentMethodContent:f,isLoading:q.value.pending})]})};export{Ne as P,V as S};
//# sourceMappingURL=PaymentMethods__ehmne0q38K.js.map
