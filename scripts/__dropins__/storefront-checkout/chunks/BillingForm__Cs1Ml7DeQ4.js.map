{"version":3,"file":"BillingForm__Cs1Ml7DeQ4.js","sources":["../../src/containers/BillingForm/BillingForm.tsx"],"sourcesContent":["import { prepareAddress, setBillingAddress } from '@/checkout/api';\nimport AddressForm, {\n  AddressFormHandle,\n  SaveAddressCommand,\n} from '@/checkout/components/AddressForm';\nimport { compareAddresses } from '@/checkout/containers/BillToShippingAddress';\nimport { BILLING_FORM_NAME } from '@/checkout/containers/BillingForm';\nimport { useAddressFormFields } from '@/checkout/context/address-form-fields';\nimport { AddressFormTypes } from '@/checkout/data/models';\nimport { cartSignal, isBillToShippingSignal } from '@/checkout/signals';\nimport { Container } from '@adobe/elsie/lib';\nimport { HTMLAttributes, useCallback, useEffect, useRef } from 'preact/compat';\n\nexport interface BillingFormProps extends HTMLAttributes<HTMLDivElement> {}\n\nexport const BillingForm: Container<BillingFormProps> = (props) => {\n  const { fields } = useAddressFormFields();\n\n  const addressFormRef = useRef<AddressFormHandle>(null);\n\n  const { data: cartData } = cartSignal.value;\n  const cartId = cartData?.id || '';\n  const { checked, setByUser } = isBillToShippingSignal.value;\n  const isVisible = !checked;\n\n  const saveAddressHandler = useCallback(\n    (command: SaveAddressCommand) => {\n      return setBillingAddress({\n        signal: command.signal,\n        cartId,\n        input: {\n          address: checked ? undefined : prepareAddress(command.address),\n          same_as_shipping: checked,\n        },\n      });\n    },\n    [cartId, checked]\n  );\n\n  const shouldAutoFillFormHandler = useCallback(() => {\n    const cartData = cartSignal.value.data;\n    return !compareAddresses(\n      fields!,\n      cartData?.billingAddress,\n      cartData?.shippingAddresses?.[0]\n    );\n  }, [fields]);\n\n  useEffect(() => {\n    if (!setByUser) return;\n\n    const controller = new AbortController();\n\n    if (!checked) {\n      addressFormRef.current!.triggerSaveAddress(controller.signal);\n    }\n\n    return () => {\n      controller.abort();\n    };\n  }, [checked, setByUser]);\n\n  return (\n    <AddressForm\n      {...props}\n      addressType={AddressFormTypes.BILLING}\n      data-testid=\"billing-form\"\n      headingId=\"Checkout.BillingAddress.title\"\n      name={BILLING_FORM_NAME}\n      ref={addressFormRef}\n      saveAddressHandler={saveAddressHandler}\n      shouldAutoFillForm={shouldAutoFillFormHandler}\n      style={{ display: isVisible ? 'block' : 'none' }}\n    />\n  );\n};\n"],"names":["BillingForm","props","fields","useAddressFormFields","addressFormRef","useRef","data","cartData","cartSignal","value","cartId","id","checked","setByUser","isBillToShippingSignal","isVisible","saveAddressHandler","useCallback","command","setBillingAddress","signal","input","address","undefined","prepareAddress","same_as_shipping","shouldAutoFillFormHandler","compareAddresses","billingAddress","shippingAddresses","useEffect","controller","AbortController","current","triggerSaveAddress","abort","_jsx","AddressForm","addressType","AddressFormTypes","BILLING","headingId","name","BILLING_FORM_NAME","ref","shouldAutoFillForm","style","display"],"mappings":";;;;;;;;;;;;;AAeO,MAAMA,cAA4CC,CAAU,UAAA;AAC3D,QAAA;AAAA,IAAEC;AAAAA,MAAWC,qBAAqB;AAElCC,QAAAA,iBAAiBC,OAA0B,IAAI;AAE/C,QAAA;AAAA,IAAEC,MAAMC;AAAAA,EAAAA,IAAaC,WAAWC;AAChCC,QAAAA,UAASH,qCAAUI,OAAM;AACzB,QAAA;AAAA,IAAEC;AAAAA,IAASC;AAAAA,EAAAA,IAAcC,uBAAuBL;AACtD,QAAMM,YAAY,CAACH;AAEbI,QAAAA,qBAAqBC,YACzB,CAACC,YAAgC;AAC/B,WAAOC,kBAAkB;AAAA,MACvBC,QAAQF,QAAQE;AAAAA,MAChBV;AAAAA,MACAW,OAAO;AAAA,QACLC,SAASV,UAAUW,SAAYC,eAAeN,QAAQI,OAAO;AAAA,QAC7DG,kBAAkBb;AAAAA,MACpB;AAAA,IAAA,CACD;AAAA,EAAA,GAEH,CAACF,QAAQE,OAAO,CAClB;AAEMc,QAAAA,4BAA4BT,YAAY,MAAM;;AAC5CV,UAAAA,YAAWC,WAAWC,MAAMH;AAC3B,WAAA,CAACqB,iBACNzB,QACAK,uCAAUqB,iBACVrB,4CAAUsB,sBAAVtB,mBAA8B,EAChC;AAAA,EAAA,GACC,CAACL,MAAM,CAAC;AAEX4B,YAAU,MAAM;AACd,QAAI,CAACjB;AAAW;AAEVkB,UAAAA,aAAa,IAAIC;AAEvB,QAAI,CAACpB,SAAS;AACGqB,qBAAAA,QAASC,mBAAmBH,WAAWX,MAAM;AAAA,IAC9D;AAEA,WAAO,MAAM;AACXW,iBAAWI,MAAM;AAAA,IAAA;AAAA,EACnB,GACC,CAACvB,SAASC,SAAS,CAAC;AAEvB,SACEuB,IAACC,aAAW;AAAA,IAAA,GACNpC;AAAAA,IACJqC,aAAaC,iBAAiBC;AAAAA,IAC9B,eAAY;AAAA,IACZC,WAAU;AAAA,IACVC,MAAMC;AAAAA,IACNC,KAAKxC;AAAAA,IACLY;AAAAA,IACA6B,oBAAoBnB;AAAAA,IACpBoB,OAAO;AAAA,MAAEC,SAAShC,YAAY,UAAU;AAAA,IAAO;AAAA,EAAA,CAChD;AAEL;"}