import{jsx as e,jsxs as L,Fragment as w}from"@dropins/tools/preact-jsx-runtime.js";import{classes as b,Slot as E}from"@dropins/tools/lib.js";import{S as I,c as H,E as B,C as F}from"../chunks/AddressFormWrapper.js";import"@dropins/tools/preact-compat.js";import{Card as T,Icon as P,ContentGrid as K,Image as V,Header as q,Picker as J,Pagination as W}from"@dropins/tools/components.js";import{useText as $}from"@dropins/tools/i18n.js";import{useState as v,useEffect as m,useMemo as j,useCallback as k}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{g as G}from"../chunks/getOrderHistoryList.js";import"../chunks/removeCustomerAddress.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact.js";const z={size:"32",stroke:"2"},Y=({minifiedView:c,orderNumber:r,orderToken:t,routeOrdersList:s,routeOrderDetails:n})=>{const i=c?"minifiedView":"fullSizeView",l=$({viewAllOrdersButton:`Account.${i}.OrdersList.viewAllOrdersButton`,ariaLabelLink:`Account.${i}.OrdersList.ariaLabelLink`});return s?e("a",{className:b(["account-orders-list-action",["account-orders-list-action--minifiedView",c]]),"data-testid":"ordersListActionButtonMinifiedView",href:s(),children:e(T,{"data-testid":"ordersListActionMinifiedView",variant:"secondary",children:L("div",{className:"account-orders-list-action__card-wrapper",children:[e("p",{children:l.viewAllOrdersButton}),e(P,{source:I,...z})]})})}):e("a",{"aria-label":`${l.ariaLabelLink} ${r??t}`,href:H(n)?n(r,t):"#",className:"account-orders-list-action","data-testid":"ordersListActionButton",children:e(P,{source:I,...z})})},R=()=>{const[c,r]=v(window.innerWidth<768);return m(()=>{const t=()=>{r(window.innerWidth<768)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[]),c},U=({minifiedView:c,item:r,withThumbnails:t,children:s,slots:n,routeTracking:i,...l})=>{var o,A,d,C,y,N;const u=c?"minifiedView":"fullSizeView",h=$({orderNumber:`Account.${u}.OrdersList.OrdersListCard.orderNumber`,itemsAmount:`Account.${u}.OrdersList.OrdersListCard.itemsAmount`,carrier:`Account.${u}.OrdersList.OrdersListCard.carrier`,deliveryDateText:`Account.${u}.OrdersList.OrdersListCard.orderDate`}),O=R();return L(T,{variant:"secondary",...l,className:b(["account-orders-list-card",["account-orders-list-card--full",((o=r==null?void 0:r.items)==null?void 0:o.length)>6]]),children:[e("div",{className:"account-orders-list-card__content",children:n!=null&&n.OrdersListCard?e(E,{"data-testid":`ordersListCard${r.id}`,name:"OrdersListCard",slot:n==null?void 0:n.OrdersListCard,context:{orderHistoryListItem:r}}):L(w,{children:[e("div",{children:r==null?void 0:r.status}),L("p",{children:[h.deliveryDateText," ",r==null?void 0:r.orderDate]}),L("p",{children:[h.orderNumber," ",r.number]}),(A=r==null?void 0:r.shipments)==null?void 0:A.map(a=>{var p;return(p=a==null?void 0:a.tracking)==null?void 0:p.map(f=>L("p",{"data-testid":f.number,children:[e("span",{children:`${h.carrier} ${f.carrier.toLocaleUpperCase()} `}),e("a",{href:(i==null?void 0:i(f))??"",className:"account-orders-list-card__content--track_number",children:f.number})]},a.id))}),L("p",{children:["$",(d=r==null?void 0:r.total)==null?void 0:d.grandTotal.value]}),L("p",{"data-testid":"itemsAmount",children:[((C=r==null?void 0:r.items)==null?void 0:C.length)??0," ",h.itemsAmount]}),(y=r==null?void 0:r.items)==null?void 0:y.map((a,p)=>{if(p>=0&&p<10)return L("p",{className:"account-orders-list-card__content--product-name",children:[L("span",{className:"account-orders-list-card__content--quantity",children:[(a==null?void 0:a.quantityOrdered)>1?a==null?void 0:a.quantityOrdered:null," "]}),a==null?void 0:a.productName.replaceAll("-"," ")]},`${p}_${a.id}`);if(p===11)return e("p",{children:"..."},"ellipsis")})]})}),t&&((N=r==null?void 0:r.items)!=null&&N.length)?e(K,{maxColumns:O?3:9,emptyGridContent:e(w,{}),className:b(["account-orders-list-card__images",["account-orders-list-card__images-3",O]]),"data-testid":"ordersListCardImages",children:r.items.map((a,p)=>{var _;const f=(_=a==null?void 0:a.product)==null?void 0:_.smallImage.url,g=a==null?void 0:a.productName;return e(V,{src:f,width:65,height:65,alt:g},a.id+p)})}):null,e("div",{className:"account-orders-list-card__actions",children:s})]})},Q=({ordersInMinifiedView:c,minifiedView:r,pageSize:t,selectedDate:s,selectedPage:n,handleSetFirstOrderDate:i})=>{const[l,u]=v([]),[h,O]=v({totalPages:1,currentPage:1,pageSize:1}),[o,A]=v(!1);return m(()=>{A(!0),G(r?c:t,s,n).then(d=>{!d||!d.items||(O(d.pageInfo),u(d.items),i==null||i(d.dateOfFirstOrder))}).finally(()=>{A(!1)})},[i,r,c,t,s,n]),{loading:o,orderHistoryListItems:l,pageInfo:h}},D=(c,r=1)=>{const t=new Date,s=new Date(t);switch(c){case"sixMonthsAgo":{s.setMonth(s.getMonth()-r);break}case"oneYearAgo":{s.setFullYear(s.getFullYear()-r);break}default:return""}return{from:s==null?void 0:s.toISOString().split("T")[0],to:`${t==null?void 0:t.toISOString().split("T")[0]} 23:59:59`}},X=c=>{const r=[],t=new Date().getFullYear();for(let s=c;s<=t-1;s++)r.push({value:`{"from":"${s}-01-01","to":"${s+1}-01-01 23:59:59"}`,text:s.toString()});return r},Z=()=>{const c=$({pastSixMonths:"Account.fullSizeView.OrdersList.OrdersListSelectDate.pastSixMonths",currentYear:"Account.fullSizeView.OrdersList.OrdersListSelectDate.currentYear",viewAll:"Account.fullSizeView.OrdersList.OrdersListSelectDate.viewAll"}),[r,t]=v(),[s,n]=v(JSON.stringify(D("sixMonthsAgo",6))),[i,l]=v(1);m(()=>{window==null||window.scrollTo({top:100,behavior:"smooth"})},[i]);const u=j(()=>{const o=[{value:JSON.stringify(D("sixMonthsAgo",6)),text:c.pastSixMonths},{value:JSON.stringify(D("oneYearAgo",1)),text:c.currentYear},{value:"viewAll",text:c.viewAll}];if(r){const d=new Date(r).getFullYear();o==null||o.splice(2,0,...X(d))}return o},[c,r]),h=k(o=>{t(o)},[]),O=k(o=>{const d=o.target.value;n(d),l(1)},[]);return{selectableDateList:u,selectedDate:s,selectedPage:i,handleSelectDate:O,setSelectedPage:l,handleSetFirstOrderDate:h}},rr=({className:c,withHeader:r=!0,minifiedView:t=!1,withThumbnails:s=!0,withFilter:n=!0,ordersInMinifiedView:i=1,pageSize:l=10,routeOrdersList:u,routeOrderDetails:h,routeTracking:O,slots:o})=>{const d=$({containerTitle:`Account.${t?"minifiedView":"fullSizeView"}.OrdersList.containerTitle`}),{selectableDateList:C,selectedDate:y,handleSelectDate:N,selectedPage:a,setSelectedPage:p,handleSetFirstOrderDate:f}=Z(),{pageInfo:g,loading:_,orderHistoryListItems:x}=Q({minifiedView:t,pageSize:l,ordersInMinifiedView:i,selectedDate:y,selectedPage:a,handleSetFirstOrderDate:f});return L("div",{children:[r?e(q,{"aria-label":d.containerTitle,role:"region",title:d.containerTitle,divider:!t,className:t?"account-orders-list-header":""}):null,L("div",{className:b(["account-orders-list",c]),children:[!t&&n?e("div",{className:"account-orders-list__date-select",children:e(J,{value:y,name:"orderDatePicker",options:C,handleSelect:N})}):null,_?e(w,{children:Array.from(Array(g==null?void 0:g.pageSize).keys()).map(S=>e(F,{testId:"orderSkeletonLoader",withCard:!1},S))}):e(w,{children:x.length?e(w,{children:x.map((S,M)=>e(U,{routeTracking:O,minifiedView:t,item:S,withThumbnails:s,slots:o,children:o!=null&&o.OrdersListAction?e(E,{"data-testid":`ordersListActionSlot_${M}`,name:"OrdersListAction",slot:o==null?void 0:o.OrdersListAction,context:{orderHistoryListItem:S}}):e(Y,{minifiedView:t,orderNumber:S.number,orderToken:S.token,routeOrderDetails:h})},M))}):e(B,{isEmpty:!x.length,typeList:"orders",minifiedView:t})}),!t&&(g==null?void 0:g.totalPages)>1?e(W,{totalPages:g==null?void 0:g.totalPages,currentPage:a,onChange:p}):null,t?e(Y,{minifiedView:t,routeOrdersList:u}):null]})]})},Lr=({className:c,withHeader:r,minifiedView:t,withThumbnails:s,withFilter:n,ordersInMinifiedView:i,pageSize:l,routeOrdersList:u,routeOrderDetails:h,routeTracking:O,slots:o})=>e("div",{className:b(["account-orders-list",c]),"data-testid":"ordersListId",children:e(rr,{className:c,withHeader:r,minifiedView:t,withThumbnails:s,withFilter:n,ordersInMinifiedView:i,pageSize:l,routeOrdersList:u,routeOrderDetails:h,routeTracking:O,slots:o})});export{Lr as OrdersList,Lr as default};
