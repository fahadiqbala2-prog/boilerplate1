import{jsx as t,jsxs as h,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import{classes as C,Slot as q}from"@dropins/tools/lib.js";import{S as T,c as B,E as J,C as K}from"../chunks/CustomerInformationCard.js";import"@dropins/tools/preact-compat.js";import{Card as F,Icon as Y,ContentGrid as V,Image as m,Header as W,Picker as j,Pagination as G}from"@dropins/tools/components.js";import{useText as M}from"@dropins/tools/i18n.js";import{useState as v,useEffect as P,useMemo as U,useCallback as D}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{g as Q}from"../chunks/getOrderHistoryList.js";import"../chunks/removeCustomerAddress.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact.js";const E={size:"32",stroke:"2"},H=({minifiedView:c,orderNumber:r,orderToken:e,routeOrdersList:a,routeOrderDetails:i})=>{const l=c?"minifiedView":"fullSizeView",u=M({viewAllOrdersButton:`Account.${l}.OrdersList.viewAllOrdersButton`,ariaLabelLink:`Account.${l}.OrdersList.ariaLabelLink`});return a?t("a",{className:C(["account-orders-list-action",["account-orders-list-action--minifiedView",c]]),"data-testid":"ordersListActionButtonMinifiedView",href:a(),children:t(F,{"data-testid":"ordersListActionMinifiedView",variant:"secondary",children:h("div",{className:"account-orders-list-action__card-wrapper",children:[t("p",{children:u.viewAllOrdersButton}),t(Y,{source:T,...E})]})})}):t("a",{"aria-label":`${u.ariaLabelLink} ${r??e}`,href:B(i)?i(r,e):"#",className:"account-orders-list-action","data-testid":"ordersListActionButton",children:t(Y,{source:T,...E})})},R=()=>{const[c,r]=v(window.innerWidth<768);return P(()=>{const e=()=>{r(window.innerWidth<768)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),c},X=({minifiedView:c,item:r,withThumbnails:e,children:a,slots:i,routeTracking:l,routeOrderProduct:u,routeReturnDetails:g,...f})=>{var S,y,$,_,k,w,x;const L=c?"minifiedView":"fullSizeView",d=M({orderNumber:`Account.${L}.OrdersList.OrdersListCard.orderNumber`,itemsAmount:`Account.${L}.OrdersList.OrdersListCard.itemsAmount`,carrier:`Account.${L}.OrdersList.OrdersListCard.carrier`,returnsText:`Account.${L}.OrdersList.OrdersListCard.returns`,deliveryDateText:`Account.${L}.OrdersList.OrdersListCard.orderDate`}),O=R(),o=B(u);return h(F,{variant:"secondary",...f,className:C(["account-orders-list-card",["account-orders-list-card--full",((S=r==null?void 0:r.items)==null?void 0:S.length)>6]]),children:[t("div",{className:"account-orders-list-card__content",children:i!=null&&i.OrdersListCard?t(q,{"data-testid":`ordersListCard${r.id}`,name:"OrdersListCard",slot:i==null?void 0:i.OrdersListCard,context:{orderHistoryListItem:r}}):h(N,{children:[t("div",{children:r==null?void 0:r.status}),h("p",{children:[d.deliveryDateText," ",r==null?void 0:r.orderDate]}),h("p",{children:[d.orderNumber," ",r.number]}),(y=r==null?void 0:r.shipments)==null?void 0:y.map(s=>{var n;return(n=s==null?void 0:s.tracking)==null?void 0:n.map(p=>{const A=l==null?void 0:l(p);return h("p",{"data-testid":p.number,children:[t("span",{children:`${d.carrier} ${p.carrier.toLocaleUpperCase()} `}),A?t("a",{href:A,target:"_blank",className:"account-orders-list-card__content--track_number",rel:"noreferrer",children:p.number}):t("span",{className:"account-orders-list-card__content--track_number",children:p.number})]},s.id)})}),r!=null&&r.returns&&(($=r.returns)!=null&&$.length)?h("p",{"data-testid":r.number,children:[h("span",{children:[d.returnsText," "]}),(_=r==null?void 0:r.returns)==null?void 0:_.map(s=>t("span",{"data-testid":s.number,children:h("a",{href:(g==null?void 0:g({orderNumber:r.number,orderToken:r.token,returnNumber:s.number}))??"#",className:"account-orders-list-card__content--return_number",children:[s.number," "]})},s.uid))]},r.id):null,h("p",{children:["$",(k=r==null?void 0:r.total)==null?void 0:k.grandTotal.value]}),h("p",{"data-testid":"itemsAmount",children:[r.items.reduce((s,n)=>{const p=(n==null?void 0:n.quantityOrdered)||0;return s+p},0)," ",d.itemsAmount]}),(w=r==null?void 0:r.items)==null?void 0:w.map((s,n)=>{if(n>=0&&n<10)return h("p",{className:"account-orders-list-card__content--product-name",children:[h("span",{className:"account-orders-list-card__content--quantity",children:[(s==null?void 0:s.quantityOrdered)>1?s==null?void 0:s.quantityOrdered:null," "]}),s==null?void 0:s.productName.replaceAll("-"," ")]},`${n}_${s.id}`);if(n===11)return t("p",{children:"..."},"ellipsis")})]})}),e&&((x=r==null?void 0:r.items)!=null&&x.length)?t(V,{maxColumns:O?3:9,emptyGridContent:t(N,{}),className:C(["account-orders-list-card__images",["account-orders-list-card__images-3",O]]),"data-testid":"ordersListCardImages",children:r.items.map((s,n)=>{var b;const p=(b=s==null?void 0:s.product)==null?void 0:b.smallImage.url,A=s==null?void 0:s.productName;return o?t("a",{href:u==null?void 0:u(s),target:"_blank",rel:"noreferrer",children:t(m,{src:p,width:65,height:65,alt:A})},s.id+n):t(m,{src:p,width:65,height:65,alt:A},s.id+n)})}):null,t("div",{className:"account-orders-list-card__actions",children:a})]})},Z=({ordersInMinifiedView:c,minifiedView:r,pageSize:e,selectedDate:a,selectedPage:i,handleSetFirstOrderDate:l})=>{const[u,g]=v([]),[f,L]=v({totalPages:1,currentPage:1,pageSize:1}),[d,O]=v(!1);return P(()=>{O(!0),Q(r?c:e,a,i).then(o=>{!o||!o.items||(L(o.pageInfo),g(o.items),l==null||l(o.dateOfFirstOrder))}).finally(()=>{O(!1)})},[l,r,c,e,a,i]),{loading:d,orderHistoryListItems:u,pageInfo:f}},I=(c,r=1)=>{const e=new Date,a=new Date(e);switch(c){case"sixMonthsAgo":{a.setMonth(a.getMonth()-r);break}case"oneYearAgo":{a.setFullYear(a.getFullYear()-r);break}default:return""}return{from:a==null?void 0:a.toISOString().split("T")[0],to:`${e==null?void 0:e.toISOString().split("T")[0]} 23:59:59`}},rr=c=>{const r=[],e=new Date().getFullYear();for(let a=c;a<=e-1;a++)r.push({value:`{"from":"${a}-01-01","to":"${a+1}-01-01 23:59:59"}`,text:a.toString()});return r},tr=()=>{const c=M({pastSixMonths:"Account.fullSizeView.OrdersList.OrdersListSelectDate.pastSixMonths",currentYear:"Account.fullSizeView.OrdersList.OrdersListSelectDate.currentYear",viewAll:"Account.fullSizeView.OrdersList.OrdersListSelectDate.viewAll"}),[r,e]=v(),[a,i]=v(JSON.stringify(I("sixMonthsAgo",6))),[l,u]=v(1);P(()=>{window==null||window.scrollTo({top:100,behavior:"smooth"})},[l]);const g=U(()=>{const d=[{value:JSON.stringify(I("sixMonthsAgo",6)),text:c.pastSixMonths},{value:JSON.stringify(I("oneYearAgo",1)),text:c.currentYear},{value:"viewAll",text:c.viewAll}];if(r){const o=new Date(r).getFullYear();d==null||d.splice(2,0,...rr(o))}return d},[c,r]),f=D(d=>{e(d)},[]),L=D(d=>{const o=d.target.value;i(o),u(1)},[]);return{selectableDateList:g,selectedDate:a,selectedPage:l,handleSelectDate:L,setSelectedPage:u,handleSetFirstOrderDate:f}},sr=({className:c,withHeader:r=!0,minifiedView:e=!1,withThumbnails:a=!0,withFilter:i=!0,ordersInMinifiedView:l=1,pageSize:u=10,routeOrdersList:g,routeOrderDetails:f,routeReturnDetails:L,routeTracking:d,routeOrderProduct:O,slots:o})=>{const S=e?"minifiedView":"fullSizeView",y=M({containerTitle:`Account.${S}.OrdersList.containerTitle`,dateOrderPlaced:`Account.${S}.OrdersList.dateOrderPlaced`}),{selectableDateList:$,selectedDate:_,handleSelectDate:k,selectedPage:w,setSelectedPage:x,handleSetFirstOrderDate:s}=tr(),{pageInfo:n,loading:p,orderHistoryListItems:A}=Z({minifiedView:e,pageSize:u,ordersInMinifiedView:l,selectedDate:_,selectedPage:w,handleSetFirstOrderDate:s});return h("div",{children:[r?t(W,{"aria-label":y.containerTitle,role:"region",title:y.containerTitle,divider:!e,className:e?"account-orders-list-header":""}):null,h("div",{className:C(["account-orders-list",c]),children:[!e&&i?h("div",{className:"account-orders-list__date-select",children:[t("span",{children:y.dateOrderPlaced}),t(j,{value:_,name:"orderDatePicker",options:$,handleSelect:k})]}):null,p?t(N,{children:Array.from(Array(n==null?void 0:n.pageSize).keys()).map(b=>t(K,{testId:"orderSkeletonLoader",withCard:!1},b))}):t(N,{children:A.length?t(N,{children:A.map((b,z)=>t(X,{routeTracking:d,routeOrderProduct:O,routeReturnDetails:L,minifiedView:e,item:b,withThumbnails:a,slots:o,children:o!=null&&o.OrdersListAction?t(q,{"data-testid":`ordersListActionSlot_${z}`,name:"OrdersListAction",slot:o==null?void 0:o.OrdersListAction,context:{orderHistoryListItem:b}}):t(H,{minifiedView:e,orderNumber:b.number,orderToken:b.token,routeOrderDetails:f})},z))}):t(J,{isEmpty:!A.length,typeList:"orders",minifiedView:e})}),!e&&(n==null?void 0:n.totalPages)>1?t(G,{totalPages:n==null?void 0:n.totalPages,currentPage:w,onChange:x}):null,e?t(H,{minifiedView:e,routeOrdersList:g}):null]})]})},gr=({className:c,withHeader:r,minifiedView:e,withThumbnails:a,withFilter:i,ordersInMinifiedView:l,pageSize:u,routeOrdersList:g,routeOrderDetails:f,routeReturnDetails:L,routeTracking:d,routeOrderProduct:O,slots:o})=>t("div",{className:C(["account-orders-list",c]),"data-testid":"ordersListId",children:t(sr,{className:c,withHeader:r,minifiedView:e,withThumbnails:a,withFilter:i,ordersInMinifiedView:l,pageSize:u,routeOrdersList:g,routeOrderDetails:f,routeReturnDetails:L,routeTracking:d,routeOrderProduct:O,slots:o})});export{gr as OrdersList,gr as default};
