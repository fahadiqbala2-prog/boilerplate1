import{jsxs as A,jsx as c,Fragment as ue}from"@dropins/tools/preact-jsx-runtime.js";import{classes as ee,Slot as me}from"@dropins/tools/lib.js";import{F as he,d as fe,g as we,n as Y,C as ge}from"../chunks/CustomerInformationCard.js";import*as V from"@dropins/tools/preact-compat.js";import{Card as K,Header as Q,InLineAlert as re,InputPassword as j,Button as H}from"@dropins/tools/components.js";import{useState as f,useEffect as B,useCallback as C,useMemo as G}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{a as Ce,c as Pe,g as pe,b as D,u as be}from"../chunks/updateCustomerV2.js";import{useText as N}from"@dropins/tools/i18n.js";import{c as Ee}from"../chunks/removeCustomerAddress.js";import"@dropins/tools/preact.js";import"@dropins/tools/fetch-graphql.js";const ye=e=>V.createElement("svg",{id:"Icon_Warning_Base",width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},V.createElement("g",{clipPath:"url(#clip0_841_1324)"},V.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.9949 2.30237L0.802734 21.6977H23.1977L11.9949 2.30237Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),V.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M12.4336 10.5504L12.3373 14.4766H11.6632L11.5669 10.5504V9.51273H12.4336V10.5504ZM11.5883 18.2636V17.2687H12.4229V18.2636H11.5883Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),V.createElement("defs",null,V.createElement("clipPath",{id:"clip0_841_1324"},V.createElement("rect",{width:24,height:21,fill:"white",transform:"translate(0 1.5)"})))),Ve=e=>V.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},V.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),V.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.75 12.762L10.2385 15.75L17.25 9",stroke:"currentColor"})),Ie=e=>V.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},V.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),V.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),Le=()=>{const[e,n]=f(null);return B(()=>{const o=sessionStorage.getItem("accountStoreConfig"),r=o?JSON.parse(o):null;if(r){const{minLength:d,requiredCharacterClasses:s}=r;n({minLength:d,requiredCharacterClasses:s})}else Ce().then(d=>{if(d){const{minLength:s,requiredCharacterClasses:p}=d;sessionStorage.setItem("accountStoreConfig",JSON.stringify(d)),n({minLength:s,requiredCharacterClasses:p})}})},[]),{passwordConfigs:e}},te=(e,n)=>{if(n<=1)return!0;const o=/[0-9]/.test(e)?1:0,r=/[a-z]/.test(e)?1:0,d=/[A-Z]/.test(e)?1:0,s=/[^a-zA-Z0-9\s]/.test(e)?1:0;return o+r+d+s>=n},J={currentPassword:"",newPassword:"",confirmPassword:""},Fe=({passwordConfigs:e,handleSetInLineAlert:n,handleHideChangePassword:o})=>{const r=N({requiredFieldError:"Account.FormText.requiredFieldError",passwordMismatch:"Account.minifiedView.CustomerInformation.changePassword.passwordValidationMessage.passwordMismatch",incorrectCurrentPassword:"Account.minifiedView.CustomerInformation.changePassword.passwordValidationMessage.incorrectCurrentPassword",passwordUpdateMessage:"Account.minifiedView.CustomerInformation.changePassword.passwordValidationMessage.passwordUpdateMessage"}),[d,s]=f(!1),[p,l]=f(!1),[i,b]=f(""),[u,m]=f(""),[I,L]=f(""),[F,w]=f({currentPassword:"",newPassword:"",confirmPassword:""}),a=C(()=>{o(()=>{n({}),w(J)})},[o,n]),M=C(h=>{b(h),w(y=>({...y,currentPassword:h?"":r.requiredFieldError}))},[r]),g=C(h=>{m(h),w(y=>({...y,newPassword:h?"":r.requiredFieldError}))},[r]),U=C(h=>{L(h),h&&w(y=>({...y,confirmPassword:h?"":r.requiredFieldError}))},[r]),S=C(h=>{const{name:y,value:E}=h==null?void 0:h.target;w(v=>({...v,[y]:E?"":r.requiredFieldError}))},[r]),k=C(()=>{w(J);const h=!i.length&&!u.length&&!I.length,y=i.length&&u!==I;return h?(w(E=>({...E,currentPassword:r.requiredFieldError,newPassword:r.requiredFieldError,confirmPassword:r.requiredFieldError})),!1):i.length?u.length?I.length?y?(w(E=>({...E,currentPassword:"",newPassword:"",confirmPassword:r.passwordMismatch})),!1):!0:(w(E=>({...E,confirmPassword:r.requiredFieldError})),!1):(w(E=>({...E,newPassword:r.requiredFieldError})),!1):(w(E=>({...E,currentPassword:r.requiredFieldError})),!1)},[I,i,u,r]),O=C(h=>{h.preventDefault(),l(!0);const y=(e==null?void 0:e.requiredCharacterClasses)||0,E=(e==null?void 0:e.minLength)||1;if(!k()){s(!0),l(!1);return}if(!te(u,y)||E>(u==null?void 0:u.length)){s(!0),l(!1);return}Pe({currentPassword:i,newPassword:u}).then(v=>{v!=null&&v.length&&(b(""),m(""),L(""),w(J),s(!1),n({type:"success",text:r.passwordUpdateMessage}))}).catch(v=>{v.message==="Invalid login or password."&&n({type:"error",text:r.incorrectCurrentPassword}),v.message==="The account is locked."&&n({type:"error",text:v.message})}),l(!1)},[e==null?void 0:e.requiredCharacterClasses,e==null?void 0:e.minLength,k,u,i,n,r]);return{hideChangePassword:a,handleOnBlurPassword:S,handleConfirmPasswordChange:U,handleNewPasswordChange:g,handleCurrentPasswordChange:M,mutationChangePassword:O,currentPassword:i,newPassword:u,confirmPassword:I,passwordErrors:F,submitLoading:p,isClickSubmit:d}},ve=({passwordConfigs:e,isClickSubmit:n,password:o})=>{const r=N({messageLengthPassword:"Account.minifiedView.CustomerInformation.changePassword.passwordValidationMessage.messageLengthPassword"}),[d,s]=f("pending");B(()=>{if(!e)return;const l=te(o,e.requiredCharacterClasses);n&&o.length>0?s(l?"success":"error"):n&&o.length===0?s("pending"):s(l?"success":"pending")},[n,e,o]);const p=G(()=>{var i;if(!e)return;const l={status:"pending",icon:"pending",message:(i=r.messageLengthPassword)==null?void 0:i.replace("{minLength}",`${e.minLength}`)};return o.length&&o.length>=e.minLength?{...l,icon:"success",status:"success"}:o.length&&o.length<e.minLength?n?{...l,icon:"error",status:"error"}:{...l,icon:"pending",status:"pending"}:l},[e,r.messageLengthPassword,o==null?void 0:o.length,n]);return{isValidUniqueSymbols:d,defaultLengthMessage:p}},_e=({handleHideChangePassword:e,handleSetInLineAlert:n,inLineAlertProps:o})=>{const{passwordConfigs:r}=Le(),{hideChangePassword:d,handleOnBlurPassword:s,handleConfirmPasswordChange:p,handleNewPasswordChange:l,handleCurrentPasswordChange:i,mutationChangePassword:b,currentPassword:u,newPassword:m,confirmPassword:I,passwordErrors:L,submitLoading:F,isClickSubmit:w}=Fe({passwordConfigs:r,handleSetInLineAlert:n,handleHideChangePassword:e}),{isValidUniqueSymbols:a,defaultLengthMessage:M}=ve({password:m,isClickSubmit:w,passwordConfigs:r}),g=N({containerTitle:"Account.minifiedView.CustomerInformation.changePassword.containerTitle",currentPasswordPlaceholder:"Account.minifiedView.CustomerInformation.changePassword.currentPassword.placeholder",currentPasswordFloatingLabel:"Account.minifiedView.CustomerInformation.changePassword.currentPassword.floatingLabel",newPasswordPlaceholder:"Account.minifiedView.CustomerInformation.changePassword.newPassword.placeholder",newPasswordFloatingLabel:"Account.minifiedView.CustomerInformation.changePassword.newPassword.floatingLabel",confirmPasswordPlaceholder:"Account.minifiedView.CustomerInformation.changePassword.confirmPassword.placeholder",confirmPasswordFloatingLabel:"Account.minifiedView.CustomerInformation.changePassword.confirmPassword.floatingLabel",buttonSecondary:"Account.minifiedView.CustomerInformation.changePassword.buttonSecondary",buttonPrimary:"Account.minifiedView.CustomerInformation.changePassword.buttonPrimary"});return A(K,{className:"change-password",variant:"secondary",children:[c(Q,{title:g.containerTitle,divider:!1,className:"change-password__title"}),o.text?c(re,{className:"change-password__notification",type:o.type,variant:"secondary",heading:o.text,icon:o.icon,"data-testid":"changePasswordInLineAlert"}):null,A("div",{className:"change-password__fields",children:[c(j,{className:"change-password__fields-item",autoComplete:"currentPassword",name:"currentPassword",placeholder:g.currentPasswordPlaceholder,floatingLabel:g.currentPasswordFloatingLabel,errorMessage:L.currentPassword,defaultValue:u,onValue:i,onBlur:s}),c(j,{className:"change-password__fields-item",autoComplete:"newPassword",name:"newPassword",placeholder:g.newPasswordPlaceholder,floatingLabel:g.newPasswordFloatingLabel,minLength:r==null?void 0:r.minLength,validateLengthConfig:M,uniqueSymbolsStatus:a,requiredCharacterClasses:r==null?void 0:r.requiredCharacterClasses,errorMessage:a==="error"||(M==null?void 0:M.status)==="error"||w&&m.length<=0?L.newPassword:void 0,defaultValue:m,onValue:l,onBlur:s}),c(j,{className:"change-password__fields-item",autoComplete:"confirmPassword",name:"confirmPassword",placeholder:g.confirmPasswordPlaceholder,floatingLabel:g.confirmPasswordFloatingLabel,errorMessage:L.confirmPassword,defaultValue:I,onValue:p,onBlur:s})]}),A("div",{className:"change-password__actions",children:[c(H,{type:"button",disabled:F,onClick:d,variant:"secondary",children:g.buttonSecondary}),c(H,{variant:"primary",type:"button",disabled:F,onClick:b,children:g.buttonPrimary})]})]})},Ae=({inLineAlertProps:e,errorPasswordEmpty:n,passwordValue:o,showPasswordOnEmailChange:r,submitLoading:d,formFieldsList:s,handleHideEditForm:p,handleUpdateCustomerInformation:l,handleInputChange:i,handleSetPassword:b,handleOnBlurPassword:u})=>{const m=N({buttonSecondary:"Account.minifiedView.CustomerInformation.editCustomerInformation.buttonSecondary",buttonPrimary:"Account.minifiedView.CustomerInformation.editCustomerInformation.buttonPrimary",placeholder:"Account.minifiedView.CustomerInformation.editCustomerInformation.passwordField.placeholder",floatingLabel:"Account.minifiedView.CustomerInformation.editCustomerInformation.passwordField.floatingLabel",containerTitle:"Account.minifiedView.CustomerInformation.editCustomerInformation.containerTitle",requiredFieldError:"Account.FormText.requiredFieldError"});return A(K,{variant:"secondary",className:"edit-customer-information",children:[c(Q,{title:m.containerTitle}),e.text?c(re,{className:"edit-customer-information__notification",type:e.type,variant:"secondary",heading:e.text,icon:e.icon,"data-testid":"editCustomerInLineAlert"}):null,A(he,{loading:d,fieldsConfig:s||[],name:"editCustomerInformation",className:"edit-customer-information-form",onSubmit:l,setInputChange:i,children:[r?c("div",{className:"edit-customer-information__password",children:c(j,{autoComplete:"password",name:"password",placeholder:m.placeholder,floatingLabel:m.floatingLabel,errorMessage:n?m.requiredFieldError:void 0,defaultValue:o,onValue:b,onBlur:u})}):null,A("div",{className:"edit-customer-information__actions",children:[c(H,{disabled:d,type:"button",variant:"secondary",onClick:()=>p(),children:m.buttonSecondary}),c(H,{disabled:d,type:"submit",variant:"primary",children:m.buttonPrimary})]})]})]})},Me=({createdAt:e,slots:n,orderedCustomerData:o,showEditForm:r,showChangePassword:d,handleShowChangePassword:s,handleShowEditForm:p})=>{const l=N({buttonSecondary:"Account.minifiedView.CustomerInformation.customerInformationCard.buttonSecondary",buttonPrimary:"Account.minifiedView.CustomerInformation.customerInformationCard.buttonPrimary",accountCreation:"Account.minifiedView.CustomerInformation.customerInformationCard.accountCreation"});return c(K,{variant:"secondary",className:ee(["customer-information-card",["customer-information-card-short",d||r]]),children:A("div",{className:"customer-information-card__wrapper",children:[c("div",{className:"customer-information-card__content",children:n!=null&&n.CustomerData?c(me,{name:"CustomerData",slot:n==null?void 0:n.CustomerData,context:{customerData:o}}):A(ue,{children:[o.map((i,b)=>{const u=i!=null&&i.label?`${i.label}: ${i==null?void 0:i.value}`:i==null?void 0:i.value;return c("p",{"data-testid":`${i.name}_${b}`,children:u},b)}),A("p",{children:[l.accountCreation,": ",e]})]})}),A("div",{className:"customer-information-card__actions",children:[c(H,{type:"button",variant:"tertiary",onClick:s,children:l.buttonSecondary}),c(H,{type:"button",variant:"tertiary",onClick:p,children:l.buttonPrimary})]})]})})},Se=({handleSetInLineAlert:e})=>{const n=N({accountSuccess:"Account.minifiedView.CustomerInformation.editCustomerInformation.accountSuccess",accountError:"Account.minifiedView.CustomerInformation.editCustomerInformation.accountError",genderMale:"Account.minifiedView.CustomerInformation.genderMale",genderFemale:"Account.minifiedView.CustomerInformation.genderFemale"}),[o,r]=f(!0),[d,s]=f(!1),[p,l]=f(!1),[i,b]=f(!1),[u,m]=f(!1),[I,L]=f(!1),[F,w]=f([]),[a,M]=f(null),[g,U]=f([]),[S,k]=f({}),[O,h]=f(""),[y,E]=f(""),v=C(t=>{const{value:P}=t==null?void 0:t.target;P.length&&m(!1),P.length||m(!0)},[]),x=C(t=>{h(t)},[]),ne=C(t=>{k(t)},[]),oe=C(()=>{l(!0),b(!1),e(),x("")},[e,x]),ae=C(t=>{t==null||t(),l(!1)},[]),se=C(()=>{b(!0),l(!1),e(),x("")},[e,x]),ie=C(t=>{t==null||t(),b(!1)},[]),T=C(t=>{t==="success"?e({type:"success",text:n.accountSuccess}):t==="error"?e({type:"error",text:n.accountError}):e(),s(!1)},[e,n]),z=C(()=>{pe().then(t=>{var _;const P=(_=t==null?void 0:t.createdAt)==null?void 0:_.split(" ")[0],Z={...t,gender:t.gender===1?n.genderMale:n.genderFemale};M(Z),E(P)})},[n.genderFemale,n.genderMale]);B(()=>{z()},[]),B(()=>{Ee("customer_account_edit").then(t=>{U(t);const P=t.map(({name:Z,customUpperCode:_,orderNumber:q,label:$})=>({name:_,orderNumber:q,label:fe.includes(Z)?null:$}));w(P)})},[]),B(()=>{S.email&&S.email!==(a==null?void 0:a.email)?L(!0):S.email&&S.email===(a==null?void 0:a.email)&&L(!1)},[a==null?void 0:a.email,S]);const W=G(()=>!F||!a?[]:F.filter(({name:P})=>P!==void 0&&a[P]).map(P=>({name:P.name,orderNumber:P.orderNumber,value:a[P.name],label:P.label})),[a,F]);B(()=>{W&&W.length&&r(!1)},[W]);const ce=G(()=>g==null?void 0:g.map(t=>({...t,defaultValue:t!=null&&t.customUpperCode&&a?a[t==null?void 0:t.customUpperCode]??"":""})).map(t=>t.customUpperCode==="gender"?{...t,defaultValue:t.defaultValue==="Male"?1:2}:t),[g,a]),de=C(async(t,P)=>{const Z=we(t.target),{email:_,password:q,...$}=Z,X=_!==(a==null?void 0:a.email)&&q.length===0;if(!P){X&&m(!0);return}if(m(!1),s(!0),_===(a==null?void 0:a.email)){x(""),D(Y($,"account")).then(R=>{R&&(z(),T("success"))}).catch(()=>{T("error")});return}if(X){m(!0),s(!1);return}_!=null&&_.length&&(q!=null&&q.length)&&be({email:_,password:q}).then(R=>{R&&D(Y($,"account")).then(le=>{le&&(z(),T("success"))}).catch(()=>{T("error")})}).catch(()=>{T("error")})},[a==null?void 0:a.email,T,z]);return{createdAt:y,errorPasswordEmpty:u,passwordValue:O,showPasswordOnEmailChange:I,orderedCustomerData:W,loading:o,normalizeFieldsConfig:ce,submitLoading:d,showEditForm:i,showChangePassword:p,handleShowChangePassword:oe,handleHideChangePassword:ae,handleShowEditForm:se,handleHideEditForm:ie,handleUpdateCustomerInformation:de,handleInputChange:ne,handleSetPassword:x,handleOnBlurPassword:v}},qe={success:c(Ve,{}),warning:c(ye,{}),error:c(Ie,{})},Ne=()=>{const[e,n]=f({}),o=C(r=>{if(!r||!r.type){n({});return}const d=qe[r.type];n({...r,icon:d})},[]);return{inLineAlertProps:e,handleSetInLineAlert:o}},je=({className:e,withHeader:n=!0,slots:o})=>{const r=N({containerTitle:"Account.minifiedView.CustomerInformation.containerTitle"}),{inLineAlertProps:d,handleSetInLineAlert:s}=Ne(),{createdAt:p,errorPasswordEmpty:l,passwordValue:i,showPasswordOnEmailChange:b,orderedCustomerData:u,loading:m,normalizeFieldsConfig:I,submitLoading:L,showEditForm:F,showChangePassword:w,handleShowChangePassword:a,handleHideChangePassword:M,handleShowEditForm:g,handleHideEditForm:U,handleUpdateCustomerInformation:S,handleInputChange:k,handleSetPassword:O,handleOnBlurPassword:h}=Se({handleSetInLineAlert:s});return m?c("div",{children:c(ge,{withCard:!0})}):A("div",{className:ee(["customer-information",e]),children:[n?c(Q,{title:r.containerTitle,divider:!1,className:"customer-information__title"}):null,c(Me,{createdAt:p,slots:o,orderedCustomerData:u,showEditForm:F,showChangePassword:w,handleShowChangePassword:a,handleShowEditForm:g}),w?c(_e,{inLineAlertProps:d,handleSetInLineAlert:s,handleHideChangePassword:M}):null,F?c(Ae,{inLineAlertProps:d,submitLoading:L,formFieldsList:I,errorPasswordEmpty:l,passwordValue:i,showPasswordOnEmailChange:b,handleSetPassword:O,handleOnBlurPassword:h,handleUpdateCustomerInformation:S,handleHideEditForm:U,handleInputChange:k}):null]})};export{je as CustomerInformation,je as default};
