import{jsx as i,jsxs as h}from"@dropins/tools/preact-jsx-runtime.js";import{Card as T,Header as I}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{classes as S}from"@dropins/tools/lib.js";import{useState as C,useEffect as x,useMemo as N}from"@dropins/tools/preact-hooks.js";import{events as b}from"@dropins/tools/event-bus.js";import{s as k}from"../chunks/setTaxStatus.js";import{g as v}from"../chunks/getStoreConfig.js";import{Fragment as G}from"@dropins/tools/preact.js";import"@dropins/tools/preact-compat.js";import{e as j}from"../chunks/returnOrdersHelper.js";import{O as q}from"../chunks/OrderLoaders.js";import{C as w}from"../chunks/CartSummaryItem.js";import{useText as E}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/form.types.js";const F=({orderData:a})=>{const[u,t]=C(!0),[c,m]=C(a),[f,d]=C({taxIncluded:!1,taxExcluded:!1});return x(()=>{v().then(e=>{if(e){const r=k(e==null?void 0:e.shoppingCartDisplayPrice);d(r)}}).finally(()=>{t(!1)})},[]),x(()=>{const e=b.on("order/data",r=>{m(r)},{eager:!0});return()=>{e==null||e.off()}},[]),{loading:u,taxConfig:f,order:c}},_=({loading:a,taxConfig:u,order:t=null,withHeader:c=!0,showConfigurableOptions:m,routeProductDetails:f})=>{const d=!!(t!=null&&t.returnNumber),e=t==null?void 0:t.returnNumber,r=E({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.returnedTitle",refunded:"Order.OrderProductListContent.refundedTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),g=N(()=>{var p;if(!t)return[];if(!d){const{modifyOrder:s,returnedList:l}=j(t),O=s==null?void 0:s.filter(o=>o.quantityCanceled),y=(p=s??[])==null?void 0:p.filter(o=>!o.quantityCanceled);return[{type:"returned",list:l??[],title:r.returned},{type:"cancelled",list:O,title:r.cancelled},{type:"allItems",list:y,title:r.allOrders}].filter(o=>{var P;return((P=o==null?void 0:o.list)==null?void 0:P.length)>0})}const n=t.returns.find(s=>s.returnNumber===e);return[{type:"returned",list:(n==null?void 0:n.items)??[],title:r.returned}]},[t,d,r,e]);return t?g.every(n=>n.list.length===0)?null:i(T,{variant:"secondary",className:"order-order-product-list-content",children:g.map((n,L)=>{var s;const p=n.list.reduce((l,{totalQuantity:O})=>O+l,0);return h(G,{children:[c?i(I,{title:`${n.title} (${p})`}):null,i("ul",{className:"order-order-product-list-content__items",children:(s=n.list)==null?void 0:s.map(l=>i("li",{"data-testid":"order-product-list-content-item",children:i(w,{loading:a,product:l,itemType:n.type,taxConfig:u,translations:r,showConfigurableOptions:m,routeProductDetails:f})},l.id))})]},L)})}):i(q,{})},tt=({className:a,orderData:u,withHeader:t,showConfigurableOptions:c,routeProductDetails:m})=>{const{loading:f,taxConfig:d,order:e}=F({orderData:u});return i("div",{className:S(["order-order-product-list",a]),children:i(_,{loading:f,taxConfig:d,order:e,withHeader:t,showConfigurableOptions:c,routeProductDetails:m})})};export{tt as OrderProductList,tt as default};
