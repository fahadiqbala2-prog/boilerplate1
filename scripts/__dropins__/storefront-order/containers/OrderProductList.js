import{jsx as s,jsxs as h}from"@dropins/tools/preact-jsx-runtime.js";import{Card as y,Header as T}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{classes as I}from"@dropins/tools/lib.js";import{useState as g,useEffect as x,useMemo as S}from"@dropins/tools/preact-hooks.js";import{events as N}from"@dropins/tools/event-bus.js";import{s as b}from"../chunks/setTaxStatus.js";import{g as k}from"../chunks/getStoreConfig.js";import{Fragment as v}from"@dropins/tools/preact.js";import"@dropins/tools/preact-compat.js";import{e as G}from"../chunks/returnOrdersHelper.js";import{O as j}from"../chunks/OrderLoaders.js";import{C as q}from"../chunks/CartSummaryItem.js";import{useText as w}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/form.types.js";const E=({orderData:d})=>{const[a,t]=g(!0),[u,c]=g(d),[m,l]=g({taxIncluded:!1,taxExcluded:!1});return x(()=>{k().then(e=>{if(e){const n=b(e==null?void 0:e.shoppingCartDisplayPrice);l(n)}}).finally(()=>{t(!1)})},[]),x(()=>{const e=N.on("order/data",n=>{c(n)},{eager:!0});return()=>{e==null||e.off()}},[]),{loading:a,taxConfig:m,order:u}},F=({loading:d,taxConfig:a,order:t=null,withHeader:u=!0,showConfigurableOptions:c,routeProductDetails:m})=>{const l=!!(t!=null&&t.returnNumber),e=t==null?void 0:t.returnNumber,n=w({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.returnedTitle",refunded:"Order.OrderProductListContent.refundedTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),L=S(()=>{if(!t)return[];const{modifyOrder:r,returnedList:f}=G(t);if(!l){console.log("1 ---- returnedList ---- 1",f);const o=r==null?void 0:r.filter(i=>i.quantityCanceled),O=r==null?void 0:r.filter(i=>!i.quantityCanceled);return[{type:"returned",list:f,title:n.returned},{type:"cancelled",list:o,title:n.cancelled},{type:"allItems",list:O,title:n.allOrders}].filter(i=>{var P;return((P=i==null?void 0:i.list)==null?void 0:P.length)>0})}const p=t.returns.find(o=>o.returnNumber===e),C=p==null?void 0:p.items;return console.log("2 ---- returnItems ---- 2",C),[{type:"returned",list:f,title:n.returned}]},[t,l,n,e]);return t?L.every(r=>r.list.length===0)?null:s(y,{variant:"secondary",className:"order-order-product-list-content",children:L.map((r,f)=>{var C;const p=r.list.reduce((o,{totalQuantity:O})=>O+o,0);return h(v,{children:[u?s(T,{title:`${r.title} (${p})`}):null,s("ul",{className:"order-order-product-list-content__items",children:(C=r.list)==null?void 0:C.map(o=>s("li",{"data-testid":"order-product-list-content-item",children:s(q,{loading:d,product:o,itemType:r.type,taxConfig:a,translations:n,showConfigurableOptions:c,routeProductDetails:m})},o.id))})]},f)})}):s(j,{})},Z=({className:d,orderData:a,withHeader:t,showConfigurableOptions:u,routeProductDetails:c})=>{const{loading:m,taxConfig:l,order:e}=E({orderData:a});return s("div",{className:I(["order-order-product-list",d]),children:s(F,{loading:m,taxConfig:l,order:e,withHeader:t,showConfigurableOptions:u,routeProductDetails:c})})};export{Z as OrderProductList,Z as default};
