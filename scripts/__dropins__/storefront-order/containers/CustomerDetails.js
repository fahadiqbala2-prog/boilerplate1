import{jsx as s,jsxs as h,Fragment as Z}from"@dropins/tools/preact-jsx-runtime.js";import{classes as b}from"@dropins/tools/lib.js";import{useMemo as H,useCallback as L,useState as k,useEffect as O}from"@dropins/tools/preact-hooks.js";import{events as z}from"@dropins/tools/event-bus.js";import{e as B}from"../chunks/fetch-graphql.js";import{g as F}from"../chunks/getAttributesForm.js";import{Card as R,Header as $,Price as q,Icon as K}from"@dropins/tools/components.js";import"../chunks/CustomerDetailsContent.js";import*as d from"@dropins/tools/preact-compat.js";import{D as G}from"../chunks/OrderLoaders.js";import{useText as I}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const J=r=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),Q=r=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.00718 5H22.1507C22.7047 5 23.1579 5.45323 23.1579 6.00718V7.51794C23.1579 7.51794 1.01007 7.58844 1 7.55823V6.00718C1 5.45323 1.45323 5 2.00718 5Z",stroke:"currentColor",strokeWidth:1}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M23.1579 9.78409V18.3451C23.1579 18.899 22.7047 19.3523 22.1507 19.3523H2.00718C1.45323 19.3523 1 18.899 1 18.3451V9.78409H23.1579Z",stroke:"currentColor",strokeWidth:1}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3.01465 15.9682H8.40305",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.6192 17.5897C18.4535 17.5897 19.1299 16.9133 19.1299 16.0789C19.1299 15.2446 18.4535 14.5682 17.6192 14.5682C16.7848 14.5682 16.1084 15.2446 16.1084 16.0789C16.1084 16.9133 16.7848 17.5897 17.6192 17.5897Z",stroke:"currentColor",strokeWidth:1}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8848 17.5897C20.7192 17.5897 21.3956 16.9133 21.3956 16.0789C21.3956 15.2446 20.7192 14.5682 19.8848 14.5682C19.0504 14.5682 18.374 15.2446 18.374 16.0789C18.374 16.9133 19.0504 17.5897 19.8848 17.5897Z",stroke:"currentColor",strokeWidth:1})),U=({loading:r,order:t,withHeader:c=!0,title:o,paymentIconsMap:e={},normalizeAddress:i})=>{var A,E,y,T,D;const a=I({emailTitle:"Order.CustomerDetails.email.title",shippingAddressTitle:"Order.CustomerDetails.shippingAddress.title",shippingMethodsTitle:"Order.CustomerDetails.shippingMethods.title",billingAddressTitle:"Order.CustomerDetails.billingAddress.title",billingMethodsTitle:"Order.CustomerDetails.billingMethods.title",headerText:"Order.CustomerDetails.headerText",freeShipping:"Order.CustomerDetails.freeShipping"}),u=H(()=>({checkmo:J,card:Q,...e}),[e]),C=L(W=>{var V;return(V=i[W])==null?void 0:V.map((v,j)=>s("div",{className:"dropin-details__container-description--row",children:v==null?void 0:v.map((m,P)=>{const w=Array.isArray(m.value)?m.value.join(" "):m==null?void 0:m.value;return s("p",{children:m.label?`${m.label}: ${w}`:w},P)})},j))},[i]);if(!t||r)return s(G,{});const l=(t==null?void 0:t.email)??"",p=(A=t==null?void 0:t.shipping)==null?void 0:A.code,n=(E=t==null?void 0:t.shipping)==null?void 0:E.amount,_=(y=t==null?void 0:t.shipping)==null?void 0:y.currency,g=t==null?void 0:t.payments,f=g&&g.length>0,N=f?(T=g[0])==null?void 0:T.name:"",M=f?(D=g[0])==null?void 0:D.code:"",S=f&&N!=="";return h(R,{"data-testid":"order-details",variant:"secondary",className:b(["dropin-details"]),children:[c?s($,{title:o??a.headerText}):null,h("div",{className:"dropin-details__container",children:[h("div",{className:"dropin-details__container-email",children:[s("div",{className:"dropin-details__container-title",children:a.emailTitle}),s("p",{children:l})]}),h("div",{className:"dropin-details__container-shipping_address",children:[s("div",{className:"dropin-details__container-title",children:a.shippingAddressTitle}),s("div",{className:"dropin-details__container-description",children:C("shippingAddress")})]}),h("div",{className:"dropin-details__container-billing_address",children:[s("div",{className:"dropin-details__container-title",children:a.billingAddressTitle}),s("div",{className:"dropin-details__container-description",children:C("billingAddress")})]}),h("div",{className:"dropin-details__container-shipping_methods",children:[s("div",{className:"dropin-details__container-title",children:a.shippingMethodsTitle}),p?s(Z,{children:n?h("p",{"data-testid":"shipping_methods_price",children:[s(q,{amount:n,currency:_})," ",p]}):s("p",{"data-testid":"shipping_methods_placeholder",children:a.freeShipping})}):null]}),h("div",{className:"dropin-details__container-billing_methods",children:[s("div",{className:"dropin-details__container-title",children:a.billingMethodsTitle}),S&&h("p",{"data-testid":"billing_methods_description",className:b([["dropin-details__container-billing_methods--icon",!!u[M]]]),children:[s(K,{source:u[M]}),N]})]})]})]})},X=["firstname","lastname","city","company","country_code","region","region_code","region_id","telephone","id","vat_id","postcode","street","street_2","default_shipping","default_billing"],x=r=>{r.sort((e,i)=>e.orderNumber-i.orderNumber);const t=[];let c=[];const o=e=>e.value!==void 0&&e.value!==null&&e.value!=="";for(let e=0;e<r.length;e++){const i=r[e];o(i)&&(e===0||e===1||e===3||e===4||e===5||e===6?(c.push(i),(e===1||e===4||e===6)&&(t.push(c),c=[])):t.push([i]))}return t},Y=({orderData:r})=>{const[t,c]=k(!0),[o,e]=k(r),[i,a]=k([]);O(()=>{const l=z.on("order/data",p=>{e(p)},{eager:!0});return()=>{l==null||l.off()}},[]),O(()=>{F("shortRequest").then(l=>{if(l){const p=l.map(({name:n,orderNumber:_,label:g})=>({name:B(n),orderNumber:_,label:X.includes(n)?null:g}));a(p)}}).finally(()=>{c(!1)})},[]);const u=L(l=>{if(!i.length||!o||!o[l])return[];const p=Object.fromEntries(Object.entries(o[l]).map(([n,_])=>[n.toLowerCase(),_]));return i.filter(({name:n})=>p[n.toLowerCase()]).map(n=>({name:n.name,orderNumber:n.orderNumber,value:p[n.name],label:n.label}))},[i,o]),C=H(()=>({billingAddress:x(u("billingAddress")),shippingAddress:x(u("shippingAddress"))}),[u]);return{order:o,normalizeAddress:C,loading:t}},pe=({paymentIconsMap:r,orderData:t,title:c,className:o})=>{const{order:e,normalizeAddress:i,loading:a}=Y({orderData:t});return s("div",{className:b(["dropin-customer-details",o]),children:s(U,{loading:a,order:e,title:c,paymentIconsMap:r,normalizeAddress:i})})};export{pe as CustomerDetails,pe as default};
