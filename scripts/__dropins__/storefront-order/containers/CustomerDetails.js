import{jsx as t,jsxs as d}from"@dropins/tools/preact-jsx-runtime.js";import{classes as g}from"@dropins/tools/lib.js";import{useMemo as x,useCallback as H,useState as A,useEffect as O}from"@dropins/tools/preact-hooks.js";import{events as W}from"@dropins/tools/event-bus.js";import{c as P}from"../chunks/convertCase.js";import{g as Z}from"../chunks/getAttributesForm.js";import{Card as z,Header as B,Price as $,Icon as q}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import*as a from"@dropins/tools/preact-compat.js";import{D as K}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact.js";import{useText as R}from"@dropins/tools/i18n.js";import"../chunks/network-error.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const F=l=>a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...l},a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),G=l=>a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...l},a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.00718 5H22.1507C22.7047 5 23.1579 5.45323 23.1579 6.00718V7.51794C23.1579 7.51794 1.01007 7.58844 1 7.55823V6.00718C1 5.45323 1.45323 5 2.00718 5Z",stroke:"currentColor",strokeWidth:1}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M23.1579 9.78409V18.3451C23.1579 18.899 22.7047 19.3523 22.1507 19.3523H2.00718C1.45323 19.3523 1 18.899 1 18.3451V9.78409H23.1579Z",stroke:"currentColor",strokeWidth:1}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3.01465 15.9682H8.40305",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.6192 17.5897C18.4535 17.5897 19.1299 16.9133 19.1299 16.0789C19.1299 15.2446 18.4535 14.5682 17.6192 14.5682C16.7848 14.5682 16.1084 15.2446 16.1084 16.0789C16.1084 16.9133 16.7848 17.5897 17.6192 17.5897Z",stroke:"currentColor",strokeWidth:1}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8848 17.5897C20.7192 17.5897 21.3956 16.9133 21.3956 16.0789C21.3956 15.2446 20.7192 14.5682 19.8848 14.5682C19.0504 14.5682 18.374 15.2446 18.374 16.0789C18.374 16.9133 19.0504 17.5897 19.8848 17.5897Z",stroke:"currentColor",strokeWidth:1})),I=({loading:l,order:e,withHeader:_=!0,title:c,paymentIconsMap:h={},normalizeAddress:m})=>{var E,N,w,T,D;const n=R({emailTitle:"Order.CustomerDetails.email.title",shippingAddressTitle:"Order.CustomerDetails.shippingAddress.title",shippingMethodsTitle:"Order.CustomerDetails.shippingMethods.title",billingAddressTitle:"Order.CustomerDetails.billingAddress.title",billingMethodsTitle:"Order.CustomerDetails.billingMethods.title",headerText:"Order.CustomerDetails.headerText",freeShipping:"Order.CustomerDetails.freeShipping"}),p=x(()=>({checkmo:F,card:G,...h}),[h]),v=H(j=>{var L;return(L=m[j])==null?void 0:L.map((r,S)=>t("p",{children:r.label?`${r.label}: ${Array.isArray(r.value)?r.value.join(" "):r==null?void 0:r.value}`:Array.isArray(r.value)?r.value.join(" "):r==null?void 0:r.value},S))},[m]);if(!e||l)return t(K,{});const o=(e==null?void 0:e.email)??"",i=(E=e==null?void 0:e.shipping)==null?void 0:E.code,s=(N=e==null?void 0:e.shipping)==null?void 0:N.amount,C=(w=e==null?void 0:e.shipping)==null?void 0:w.currency,u=e==null?void 0:e.payments,f=u&&u.length>0,y=f?(T=u[0])==null?void 0:T.name:"",M=f?(D=u[0])==null?void 0:D.code:"",V=f&&y!=="",k=v("shippingAddress")??[],b=v("billingAddress")??[];return d(z,{"data-testid":"order-details",variant:"secondary",className:g(["order-customer-details-content"]),children:[_?t(B,{title:c??n.headerText}):null,d("div",{className:g(["order-customer-details-content__container",["order-customer-details-content__container--no-margin",k.length||b.length]]),children:[d("div",{className:"order-customer-details-content__container-email",children:[t("div",{className:"order-customer-details-content__container-title",children:n.emailTitle}),t("p",{children:o})]}),k.length?d("div",{className:"order-customer-details-content__container-shipping_address",children:[t("div",{className:"order-customer-details-content__container-title",children:n.shippingAddressTitle}),t("div",{className:"order-customer-details-content__container-description",children:k})]}):null,b.length?d("div",{className:g(["order-customer-details-content__container-billing_address",["order-customer-details-content__container-billing_address--fullwidth",!k.length]]),children:[t("div",{className:"order-customer-details-content__container-title",children:n.billingAddressTitle}),t("div",{className:"order-customer-details-content__container-description",children:b})]}):null,i?d("div",{className:"order-customer-details-content__container-shipping_methods",children:[t("div",{className:"order-customer-details-content__container-title",children:n.shippingMethodsTitle}),s?d("p",{"data-testid":"shipping_methods_price",children:[t($,{amount:s,currency:C})," ",i]}):t("p",{"data-testid":"shipping_methods_placeholder",children:n.freeShipping})]}):null,V?d("div",{className:g(["order-customer-details-content__container-payment_methods",["order-customer-details-content__container-payment_methods--fullwidth",!i]]),children:[t("div",{className:"order-customer-details-content__container-title",children:n.billingMethodsTitle}),d("p",{"data-testid":"billing_methods_description",className:g([["order-customer-details-content__container-payment_methods--icon",!!p[M]]]),children:[t(q,{source:p[M]}),y]})]}):null]})]})},J=["firstname","lastname","city","company","country_code","region","region_code","region_id","telephone","id","vat_id","postcode","street","street_2","default_shipping","default_billing"],Q=({orderData:l})=>{const[e,_]=A(!0),[c,h]=A(l),[m,n]=A([]);O(()=>{const o=W.on("order/data",i=>{h(i)},{eager:!0});return()=>{o==null||o.off()}},[]),O(()=>{Z("shortRequest").then(o=>{if(o){const i=o.map(({name:s,orderNumber:C,label:u})=>({name:P(s),orderNumber:C,label:J.includes(s)?null:u}));n(i)}}).finally(()=>{_(!1)})},[]);const p=H(o=>{if(!m.length||!c||!c[o])return[];const i=Object.fromEntries(Object.entries(c[o]).map(([s,C])=>[s.toLowerCase(),C]));return m.filter(({name:s})=>i[s.toLowerCase()]).map(s=>({name:s.name,orderNumber:s.orderNumber,value:i[s.name.toLowerCase()],label:s.label}))},[m,c]),v=x(()=>({billingAddress:p("billingAddress"),shippingAddress:p("shippingAddress")}),[p]);return{order:c,normalizeAddress:v,loading:e}},me=({paymentIconsMap:l,orderData:e,title:_,className:c})=>{const{order:h,normalizeAddress:m,loading:n}=Q({orderData:e});return t("div",{className:g(["order-customer-details",c]),children:t(I,{loading:n,order:h,title:_,paymentIconsMap:l,normalizeAddress:m})})};export{me as CustomerDetails,me as default};
