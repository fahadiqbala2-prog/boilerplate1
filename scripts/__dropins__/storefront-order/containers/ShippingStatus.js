import{jsx as i,jsxs as S,Fragment as _}from"@dropins/tools/preact-jsx-runtime.js";import{classes as $,VComponent as A,Slot as E}from"@dropins/tools/lib.js";import{Card as L,Header as w,Accordion as R,AccordionSection as V,ContentGrid as G,Image as q}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{useState as x,useEffect as k}from"@dropins/tools/preact-hooks.js";import{events as D}from"@dropins/tools/event-bus.js";import"@dropins/tools/preact.js";import{u as nn}from"../chunks/useIsMobile.js";import{Text as B,useText as en}from"@dropins/tools/i18n.js";import{C as pn}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";var M=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(M||{});const tn=({orderData:e})=>{const[s,n]=x(!0),[t,m]=x(e),[h,o]=x(!1);return k(()=>{const d=D.on("order/data",u=>{m(u),o(u==null?void 0:u.isVirtual),n(!1)},{eager:!0});return()=>{d==null||d.off()}},[]),{loading:s,order:t,isVirtualProduct:h}},Z=({value:e,variant:s="primary",size:n="medium",icon:t,className:m,children:h,disabled:o=!1,active:d=!1,activeChildren:u,activeIcon:p,href:C,...a})=>{let g="dropin-button";(t&&!h||t&&d&&!u||!t&&d&&p)&&(g="dropin-iconButton"),d&&u&&(g="dropin-button"),m=$([g,`${g}--${n}`,`${g}--${s}`,[`${g}--${s}--disabled`,o],h&&t&&`${g}--with-icon`,!h&&u&&t&&`${g}--with-icon`,d&&p&&`${g}--with-icon`,m]);const c=$(["dropin-button-icon",`dropin-button-icon--${s}`,[`dropin-button-icon--${s}--disabled`,o],t==null?void 0:t.props.className]),b=C?{node:i("a",{}),role:"link",href:C,...a,disabled:o,active:d,onKeyDown:I=>{o&&I.preventDefault()},tabIndex:o?-1:0}:{node:i("button",{}),role:"button",...a,value:e,disabled:o,active:d};return S(A,{...b,className:m,children:[t&&!d&&i(A,{node:t,className:c}),p&&d&&i(A,{node:p,className:c}),h&&!d&&(typeof h=="string"?i("span",{children:h}):h),d&&u&&(typeof u=="string"?i("span",{children:u}):u)]})},ln=({slots:e,collapseThreshold:s,translations:n,returnData:t,routeTracking:m,routeProductDetails:h})=>{var u;const o=nn(),d=h?"a":"span";return S(L,{variant:"secondary",className:$(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[i(w,{title:n.returnOrderCardTitle}),S("div",{children:[(u=t==null?void 0:t.tracking)==null?void 0:u.map((p,C)=>{var b,I;const a={title:"",number:(p==null?void 0:p.trackingNumber)??"",carrier:((b=p==null?void 0:p.carrier)==null?void 0:b.label)??""},g=m==null?void 0:m(a),c=g?()=>{window.open(g,"_blank","noreferrer")}:null;return S("div",{className:"order-shipping-status-card__header",children:[S("div",{children:[`${n.carrier} `,`${(I=a.carrier)==null?void 0:I.toLocaleUpperCase()} | `,a.number]}),c?i(Z,{onClick:c,children:n.trackButton}):null]},`${a.number}_${C}`)}),e!=null&&e.ReturnItemsDetails?i(E,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:t.items}}):null,i(R,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(V,{defaultOpen:s>=t.items.length,title:i(B,{id:"Order.ShippingStatusCard.itemText",plural:t.items.reduce((p,C)=>p+C.totalQuantity,0),fields:{count:t.items.reduce((p,C)=>p+C.totalQuantity,0)}}),children:i(G,{maxColumns:o?3:9,emptyGridContent:i(_,{}),className:$(["order-shipping-status-card__images",["order-shipping-status-card__images-3",o]]),children:t.items.map((p,C)=>{var c,b;const a=(c=p.thumbnail)==null?void 0:c.label,g=(b=p.thumbnail)==null?void 0:b.url;return i(d,{href:(h==null?void 0:h(p))??"#","data-testid":`${C}${p.uid}`,children:i(q,{alt:a,src:g,width:85,height:114})},`${C}${p.uid}`)})})})})]})]})},sn=({translations:e,slots:s,orderData:n,collapseThreshold:t=10,routeProductDetails:m,routeTracking:h})=>{var I,U,H,j,v,F,Q;const o=!!(n!=null&&n.returnNumber),d=n==null?void 0:n.returnNumber,u=m?"a":"span",p=(I=n==null?void 0:n.status)==null?void 0:I.toLocaleLowerCase(),a=((U=n==null?void 0:n.shipments)==null?void 0:U.length)===1&&(p==null?void 0:p.includes(M.COMPLETE)),g=(H=n==null?void 0:n.shipments)==null?void 0:H.every(l=>l.tracking.length===0),c=(j=n==null?void 0:n.items)==null?void 0:j.filter(l=>(l==null?void 0:l.quantityShipped)===0||(l==null?void 0:l.quantityShipped)<(l==null?void 0:l.quantityOrdered)),b=(v=n==null?void 0:n.items)==null?void 0:v.reduce((l,f)=>{const O=f.quantityOrdered-f.quantityShipped;return l+(O>0?O:0)},0);if(o&&(n!=null&&n.returns.length)){const l=n.returns.find(f=>f.returnNumber===d);return!l||l.tracking.length===0?null:i(ln,{slots:s,collapseThreshold:t,translations:e,returnData:l,routeTracking:h,routeProductDetails:m})}return!n||p!=null&&p.includes(M.CANCELED)?null:(F=n==null?void 0:n.shipments)!=null&&F.length?g&&!(c!=null&&c.length)&&a?null:S(_,{children:[(Q=n==null?void 0:n.shipments)==null?void 0:Q.map(({tracking:l,items:f,id:O},P)=>{const K=f.reduce((r,N)=>{var y;return(r??0)+(((y=N.orderItem)==null?void 0:y.quantityShipped)??0)},0);return S(L,{variant:"secondary",className:"order-shipping-status-card",children:[i(w,{title:e.shippingCardTitle}),l==null?void 0:l.map(r=>{var y;const N=h==null?void 0:h(r),T=N?()=>{window.open(N,"_blank","noreferrer")}:null;return S("div",{className:"order-shipping-status-card__header",role:"status",children:[S("div",{className:"order-shipping-status-card__header--content",children:[S("p",{children:[e.carrier," ",(y=r==null?void 0:r.carrier)==null?void 0:y.toLocaleUpperCase()," | ",r==null?void 0:r.number]}),i("p",{children:r==null?void 0:r.title})]}),s!=null&&s.DeliveryTrackActions?i(E,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:s==null?void 0:s.DeliveryTrackActions,context:{trackInformation:r}}):T?i(Z,{onClick:T,children:e.trackButton}):null]},r.number)}),a?null:i(R,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(V,{"data-position":P+1,defaultOpen:t>=(f==null?void 0:f.length),title:i(_,{children:i(B,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:K,fields:{count:K}})}),children:i(G,{maxColumns:6,emptyGridContent:i(_,{}),className:"order-shipping-status-card__images",children:f==null?void 0:f.map(r=>{var y,W,Y,z,J,X;const N=(Y=(W=(y=r==null?void 0:r.orderItem)==null?void 0:y.product)==null?void 0:W.thumbnail)==null?void 0:Y.label,T=(X=(J=(z=r==null?void 0:r.orderItem)==null?void 0:z.product)==null?void 0:J.thumbnail)==null?void 0:X.url;return i(u,{href:(m==null?void 0:m(r))??"#",children:i(q,{alt:N,src:T||"",width:85,height:114})},r.id)})})})}),s!=null&&s.DeliveryTimeLine?i(E,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:s==null?void 0:s.DeliveryTimeLine,context:{}}):null]},O)}),c!=null&&c.length?S(L,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[i(w,{title:e.notYetShippedTitle}),i(R,{actionIconPosition:"right",children:i(V,{defaultOpen:t>=(c==null?void 0:c.length),title:i(B,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:b,fields:{count:b}}),children:i(G,{maxColumns:6,emptyGridContent:i(_,{}),className:"order-shipping-status-card__images",children:c==null?void 0:c.map(l=>{var f,O;return i(u,{href:(m==null?void 0:m(l))??"#",children:i(q,{alt:(f=l.thumbnail)==null?void 0:f.label,src:((O=l.thumbnail)==null?void 0:O.url)||"",width:85,height:114})},l.id)})})})})]}):null]}):S(L,{variant:"secondary",className:"order-shipping-status-card",children:[i(w,{title:e.shippingInfoTitle}),i("div",{className:"order-shipping-status-card__header",children:S("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?i("p",{children:n==null?void 0:n.carrier}):null,i("p",{children:e.noInfoTitle})]})})]})},an=({slots:e,className:s,collapseThreshold:n,orderData:t,routeOrderDetails:m,routeTracking:h,routeProductDetails:o})=>{const{loading:d,order:u,isVirtualProduct:p}=tn({orderData:t}),C=en({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber",trackButton:"Order.ShippingStatusCard.trackButton"});return!d&&p?null:i("div",{className:$(["order-shipping-status",s]),children:!d&&u?i(sn,{translations:C,routeOrderDetails:m,routeTracking:h,slots:e,orderData:u,collapseThreshold:n,routeProductDetails:o}):i(pn,{withCard:!1})})};export{an as ShippingStatus,an as default};
