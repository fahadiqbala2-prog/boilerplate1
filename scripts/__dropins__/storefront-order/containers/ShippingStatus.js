import{jsxs as d,jsx as e,Fragment as S}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as V,classes as q}from"@dropins/tools/lib.js";import{Card as m,Header as T,Accordion as $,AccordionSection as H,ContentGrid as W,Image as M}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{useText as z,Text as R}from"@dropins/tools/i18n.js";import{C as B}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import{useState as I,useEffect as J}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/preact.js";import{events as K}from"@dropins/tools/event-bus.js";var v=(i=>(i.PENDING="pending",i.SHIPPING="shipping",i.COMPLETE="complete",i.PROCESSING="processing",i.HOLD="on hold",i.CANCELED="Canceled",i.SUSPECTED_FRAUD="suspected fraud",i.PAYMENT_REVIEW="payment review",i))(v||{});const Q=({slots:i,orderData:n,collapseThreshold:g=10,routeProductDetails:c})=>{var O,L,y,_,A;const t=z({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",notYetShippedImagesTitle:"Order.ShippingStatusCard.notYetShippedImagesTitle",noInfoTitle:"Order.OrderStatusContent.noInfoTitle"}),a=c?"a":"span",r=(O=n==null?void 0:n.status)==null?void 0:O.toLocaleLowerCase(),f=((L=n==null?void 0:n.shipments)==null?void 0:L.length)===1&&(r==null?void 0:r.includes(v.COMPLETE)),p=(y=n==null?void 0:n.items)==null?void 0:y.filter(s=>(s==null?void 0:s.quantityShipped)===0);if(!n||r!=null&&r.includes(v.CANCELED))return null;if(!((_=n==null?void 0:n.shipments)!=null&&_.length))return d(m,{variant:"secondary",className:"order-shipping-status-card",children:[e(T,{title:t.shippingInfoTitle}),e("div",{className:"order-shipping-status-card__header",children:d("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?e("p",{children:n==null?void 0:n.carrier}):null,e("p",{children:t.noInfoTitle})]})})]});const U=e(R,{id:"Order.ShippingStatusCard.notYetShippedItem",plural:p==null?void 0:p.length});return d(S,{children:[(A=n==null?void 0:n.shipments)==null?void 0:A.map(({tracking:s,items:h,id:u},Y)=>{const j=e(R,{id:"Order.ShippingStatusCard.notYetShippedItem",plural:h==null?void 0:h.length});return d(m,{variant:"secondary",className:"order-shipping-status-card",children:[e(T,{title:t.shippingCardTitle}),s==null?void 0:s.map(l=>{var C;return d("div",{className:"order-shipping-status-card__header",role:"status",children:[d("div",{className:"order-shipping-status-card__header--content",children:[d("p",{children:[t.carrier," ",(C=l==null?void 0:l.carrier)==null?void 0:C.toLocaleUpperCase()," | ",l==null?void 0:l.number]}),e("p",{children:l==null?void 0:l.title})]}),i!=null&&i.DeliveryTrackActions?e(V,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:i==null?void 0:i.DeliveryTrackActions,context:{trackInformation:l}}):null]},l.number)}),f?null:e($,{actionIconPosition:"right","data-testid":"dropinAccordion",children:e(H,{"data-position":Y+1,defaultOpen:g>=(h==null?void 0:h.length),title:d(S,{children:[`${t.notYetShippedImagesTitle} (${h==null?void 0:h.length} `,j,")"]}),children:e(W,{maxColumns:6,emptyGridContent:e(S,{}),className:"order-shipping-status-card__images",children:h==null?void 0:h.map(l=>{var b,E,N,x,w,G;const C=(N=(E=(b=l==null?void 0:l.orderItem)==null?void 0:b.product)==null?void 0:E.thumbnail)==null?void 0:N.label,F=(G=(w=(x=l==null?void 0:l.orderItem)==null?void 0:x.product)==null?void 0:w.thumbnail)==null?void 0:G.url;return e(a,{href:(c==null?void 0:c(l))??"#",children:e(M,{alt:C,src:F||"",width:85,height:114})},l.id)})})})}),i!=null&&i.DeliveryTimeLine?e(V,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:i==null?void 0:i.DeliveryTimeLine,context:{}}):null]},u)}),p!=null&&p.length?d(m,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[e(T,{title:t.notYetShippedTitle}),e($,{actionIconPosition:"right",children:e(H,{defaultOpen:g>=(p==null?void 0:p.length),title:d(S,{children:[`${t.notYetShippedImagesTitle} (${p==null?void 0:p.length} `,U,")"]}),children:e("div",{className:"order-shipping-status-card__images",children:p==null?void 0:p.map(s=>{var h,u;return e(a,{href:(c==null?void 0:c(s))??"#",children:e(M,{alt:(h=s.thumbnail)==null?void 0:h.label,src:((u=s.thumbnail)==null?void 0:u.url)||"",width:85,height:114})},s.id)})})})})]}):null]})},X=({orderData:i})=>{const[n,g]=I(!0),[c,t]=I(i),[a,r]=I(!1);return J(()=>{const o=K.on("order/data",f=>{t(f),r(f==null?void 0:f.isVirtual),g(!1)},{eager:!0});return()=>{o==null||o.off()}},[]),{loading:n,order:c,isVirtualProduct:a}},si=({slots:i,className:n,collapseThreshold:g,orderData:c,routeProductDetails:t})=>{const{loading:a,order:r,isVirtualProduct:o}=X({orderData:c});return!a&&o?null:e("div",{className:q(["order-shipping-status",n]),children:!a&&r?e(Q,{slots:i,orderData:r,collapseThreshold:g,routeProductDetails:t}):e(B,{withCard:!1})})};export{si as ShippingStatus,si as default};
